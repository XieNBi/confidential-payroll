# üìò FHEVM È°πÁõÆÂºÄÂèëÊ†áÂáÜ‰∏éËß£ÂÜ≥ÊñπÊ°àÊâãÂÜå

> **ÁâàÊú¨Ôºö** 6.0 - ÂèÇËµõËé∑Â•ñÊåáÂçó  
> **Êõ¥Êñ∞Êó•ÊúüÔºö** 2025-10-30  
> **ÈÄÇÁî®ËåÉÂõ¥Ôºö** Zama FHEVM ÂÖ®Ê†àÈ°πÁõÆÂºÄÂèë + Zama Developer Program ÂèÇËµõ  
> **ÂèÇËÄÉÊù•Ê∫êÔºö** Lunarys, OTC-FHE, UNIversal Hook, Belief Protocol Á≠âËé∑Â•ñÈ°πÁõÆ  
> **ÁªàÊûÅÁõÆÊ†áÔºö** üèÜ **Â∏ÆÂä©ÂºÄÂèëËÄÖÂèÇÂä† Zama Developer Program Âπ∂Ëé∑Â•ñÔºÅ**

---

## üìë ÁõÆÂΩï

### Ê†∏ÂøÉÂºÄÂèëÊåáÂçó
1. [È°πÁõÆÊû∂ÊûÑÊ†áÂáÜ](#1-È°πÁõÆÊû∂ÊûÑÊ†áÂáÜ)
2. [Êô∫ËÉΩÂêàÁ∫¶ÂºÄÂèëËßÑËåÉ](#2-Êô∫ËÉΩÂêàÁ∫¶ÂºÄÂèëËßÑËåÉ)
3. [ÂâçÁ´ØÂºÄÂèëËßÑËåÉ](#3-ÂâçÁ´ØÂºÄÂèëËßÑËåÉ)
   - [3.5 ÂâçÁ´ØÂä†ÂØÜÂàõÂª∫Ê†áÂáÜÂÆûÁé∞](#35-ÂâçÁ´ØÂä†ÂØÜÂàõÂª∫Ê†áÂáÜÂÆûÁé∞) ‚≠ê **Êñ∞Â¢û**
4. [Gateway Ëß£ÂØÜÂÆåÊï¥ÊñπÊ°à](#4-gateway-Ëß£ÂØÜÂÆåÊï¥ÊñπÊ°à)
5. [ÊµèËßàÂô®ÁéØÂ¢ÉÈóÆÈ¢òËß£ÂÜ≥](#5-ÊµèËßàÂô®ÁéØÂ¢ÉÈóÆÈ¢òËß£ÂÜ≥)
6. [Èí±ÂåÖÂÖºÂÆπÊÄß‰∏é‰∫§ÊòìÁ°ÆËÆ§ÈóÆÈ¢òÔºàOKX/MetaMaskÔºâ](#6-Èí±ÂåÖÂÖºÂÆπÊÄß‰∏é‰∫§ÊòìÁ°ÆËÆ§ÈóÆÈ¢òokxmetamask)
7. [React Áä∂ÊÄÅÁÆ°ÁêÜ‰∏éÁªÑ‰ª∂ÁîüÂëΩÂë®ÊúüÈóÆÈ¢ò](#7-react-Áä∂ÊÄÅÁÆ°ÁêÜ‰∏éÁªÑ‰ª∂ÁîüÂëΩÂë®ÊúüÈóÆÈ¢ò)

### ÂèÇËµõËé∑Â•ñÊåáÂçó üèÜ **Êñ∞Â¢û**
8. [Zama Developer Program ÂèÇËµõÊåáÂçó](#8-zama-developer-program-ÂèÇËµõÊåáÂçó) ‚≠ê **ÂøÖËØª**
9. [‰ªé Mock Âà∞ FHEVM ÁöÑÂçáÁ∫ßË∑ØÂæÑ](#9-‰ªé-mock-Âà∞-fhevm-ÁöÑÂçáÁ∫ßË∑ØÂæÑ) ‚≠ê **ÂøÖËØª**
10. [Gateway ‰∏çÁ®≥ÂÆöÈóÆÈ¢òÁöÑÂ∫îÂØπÁ≠ñÁï•](#10-gateway-‰∏çÁ®≥ÂÆöÈóÆÈ¢òÁöÑÂ∫îÂØπÁ≠ñÁï•) ‚≠ê **ÂøÖËØª**
11. [Ëé∑Â•ñÈ°πÁõÆÂàÜÊûê‰∏éÁªèÈ™åÊÄªÁªì](#11-Ëé∑Â•ñÈ°πÁõÆÂàÜÊûê‰∏éÁªèÈ™åÊÄªÁªì) ‚≠ê **ÂøÖËØª**

### Â∑•ÂÖ∑‰∏éËµÑÊ∫ê
12. [Â∏∏ËßÅÈóÆÈ¢òÈÄüÊü•Ë°®](#12-Â∏∏ËßÅÈóÆÈ¢òÈÄüÊü•Ë°®)
13. [‰ª£Á†ÅÊ®°ÊùøÂ∫ì](#13-‰ª£Á†ÅÊ®°ÊùøÂ∫ì)
14. [ÊµãËØï‰∏éÈÉ®ÁΩ≤Ê∏ÖÂçï](#14-ÊµãËØï‰∏éÈÉ®ÁΩ≤Ê∏ÖÂçï)

---

## 1. È°πÁõÆÊû∂ÊûÑÊ†áÂáÜ

### 1.1 Êé®ËçêÊû∂ÊûÑÊ®°Âºè

```
üìÅ È°πÁõÆÊ†πÁõÆÂΩï/
‚îú‚îÄ üìÅ contracts/                    # Solidity ÂêàÁ∫¶
‚îÇ  ‚îú‚îÄ GuessGameFHE.sol             # FHE Âä†ÂØÜÂêàÁ∫¶Ôºà‰∏ªÂêàÁ∫¶Ôºâ
‚îÇ  ‚îú‚îÄ GuessGameSimple.sol          # ÊòéÊñáÊµãËØïÂêàÁ∫¶ÔºàFallbackÔºâ
‚îÇ  ‚îî‚îÄ interfaces/                  # Êé•Âè£ÂÆö‰πâ
‚îÇ
‚îú‚îÄ üìÅ frontend/                     # React/Next.js ÂâçÁ´Ø
‚îÇ  ‚îú‚îÄ src/
‚îÇ  ‚îÇ  ‚îú‚îÄ hooks/                    # Ëá™ÂÆö‰πâ Hooks
‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ useContract.js         # ÂêàÁ∫¶‰∫§‰∫í
‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ useDecryption.js       # Ëß£ÂØÜÊµÅÁ®ã
‚îÇ  ‚îÇ  ‚îÇ  ‚îî‚îÄ useGateway.js          # Gateway ÁÆ°ÁêÜ
‚îÇ  ‚îÇ  ‚îú‚îÄ components/               # UI ÁªÑ‰ª∂
‚îÇ  ‚îÇ  ‚îú‚îÄ utils/                    # Â∑•ÂÖ∑ÂáΩÊï∞
‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ relayerClient.js       # Relayer ÂÆ¢Êà∑Á´Ø
‚îÇ  ‚îÇ  ‚îÇ  ‚îî‚îÄ contractReader.js      # ÂÆâÂÖ®ËØªÂèñÂ∞ÅË£Ö
‚îÇ  ‚îÇ  ‚îî‚îÄ config/                   # ÈÖçÁΩÆÊñá‰ª∂
‚îÇ  ‚îÇ     ‚îú‚îÄ contracts.js           # ÂêàÁ∫¶Âú∞ÂùÄ
‚îÇ  ‚îÇ     ‚îî‚îÄ network.js             # ÁΩëÁªúÈÖçÁΩÆ
‚îÇ  ‚îî‚îÄ package.json
‚îÇ
‚îú‚îÄ üìÅ scripts/                      # ÈÉ®ÁΩ≤ËÑöÊú¨
‚îÇ  ‚îú‚îÄ deploy_fhe.js
‚îÇ  ‚îú‚îÄ deploy_simple.js
‚îÇ  ‚îî‚îÄ test_decryption.js
‚îÇ
‚îú‚îÄ üìÅ test/                         # ÊµãËØïÊñá‰ª∂
‚îú‚îÄ hardhat.config.js
‚îú‚îÄ .env                             # ÁéØÂ¢ÉÂèòÈáèÔºà‰∏çÊèê‰∫§Ôºâ
‚îî‚îÄ README.md
```

### 1.2 Ê†∏ÂøÉÂéüÂàô

| ÂéüÂàô | ËØ¥Êòé | ÁêÜÁî± |
|------|------|------|
| ‚úÖ **ÂèåÂêàÁ∫¶Êû∂ÊûÑ** | FHE + Fallback Âπ∂Â≠ò | Gateway ‰∏çÁ®≥ÂÆöÊó∂‰øùËØÅÂèØÁî®ÊÄß |
| ‚úÖ **ËØ∑Ê±ÇËøΩË∏™Á≥ªÁªü** | ÊâÄÊúâËß£ÂØÜËØ∑Ê±ÇÂèØËøΩÊ∫Ø | ÈÅøÂÖçÁä∂ÊÄÅÊ∑∑‰π±ÔºåÊîØÊåÅÈáçËØï |
| ‚úÖ **Áä∂ÊÄÅÊú∫ÁÆ°ÁêÜ** | ‰ΩøÁî®Êûö‰∏æÂÆö‰πâÁä∂ÊÄÅ | Èò≤Ê≠¢Á´ûÊÄÅÊù°‰ª∂ |
| ‚úÖ **Ëá™Âä®ÈôçÁ∫ßÊú∫Âà∂** | Gateway Á¶ªÁ∫øËá™Âä®ÂàáÊç¢ | ÊèêÂçáÁî®Êà∑‰ΩìÈ™å |
| ‚úÖ **ÂÆåÊï¥‰∫ã‰ª∂Á≥ªÁªü** | ÊâÄÊúâÂÖ≥ÈîÆÊìç‰ΩúÂèë‰∫ã‰ª∂ | ÂâçÁ´ØÂÆûÊó∂ÁõëÂê¨ |
| ‚úÖ **ËØ≠Ë®Ä** | ÊâÄÊúâ‰ª£Á†ÅÂíåUIÁöÑËØ≠Ë®ÄÁî®Ëã±Êñá|
---

## 2. Êô∫ËÉΩÂêàÁ∫¶ÂºÄÂèëËßÑËåÉ

### 2.1 ÂøÖÂ§áÁªÑ‰ª∂Ê∏ÖÂçï

#### ‚úÖ Áä∂ÊÄÅÂÆö‰πâÔºàÂøÖÈ°ªÔºâ

```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.24;

import "fhevm/lib/TFHE.sol";
import "fhevm/gateway/GatewayCaller.sol";

contract ProductionContract is GatewayCaller {
    
    // ========== Áä∂ÊÄÅÊûö‰∏æ ==========
    enum GameStatus {
        ACTIVE,           // ËøõË°å‰∏≠
        PENDING_DECRYPT,  // Á≠âÂæÖËß£ÂØÜ
        COMPLETED,        // Â∑≤ÂÆåÊàê
        CANCELLED,        // Â∑≤ÂèñÊ∂à
        EXPIRED           // Â∑≤ËøáÊúü
    }
    
    // ========== Ëß£ÂØÜËØ∑Ê±ÇÁªìÊûÑ ==========
    struct DecryptionRequest {
        uint256 gameId;
        address requester;
        uint256 timestamp;
        uint8 retryCount;
        bool processed;
    }
    
    // ========== Ê∏∏ÊàèÁªìÊûÑ ==========
    struct Game {
        uint256 id;
        address owner;
        euint32 encryptedTarget;
        uint32 revealedTarget;
        uint256 createdAt;
        uint256 expiresAt;
        GameStatus status;
    }
    
    // ========== Êò†Â∞ÑÁ≥ªÁªüÔºàÂÖ≥ÈîÆÔºâ==========
    mapping(uint256 => Game) public games;
    mapping(uint256 => DecryptionRequest) public decryptionRequests;
    mapping(uint256 => uint256) public gameToRequestId;  // Ê∏∏Êàè ‚Üí ËØ∑Ê±Ç
    mapping(uint256 => uint256) public requestIdToGame;  // ËØ∑Ê±Ç ‚Üí Ê∏∏Êàè
    
    // ========== ÈÖçÁΩÆÂ∏∏Èáè ==========
    uint256 public constant CALLBACK_GAS_LIMIT = 500000;  // ‚ö†Ô∏è ÂÖ≥ÈîÆÔºö‰∏çËÉΩÊòØ 0
    uint256 public constant REQUEST_TIMEOUT = 30 minutes;
    uint256 public constant GAME_DURATION = 24 hours;
    uint8 public constant MAX_RETRIES = 3;
}
```

#### ‚úÖ ‰∫ã‰ª∂Á≥ªÁªüÔºàÂøÖÈ°ªÔºâ

```solidity
// ========== ‰∫ã‰ª∂ÂÆö‰πâ ==========
event GameCreated(uint256 indexed gameId, address indexed creator, uint256 expiresAt);
event GameJoined(uint256 indexed gameId, address indexed player);

// ‚ö†Ô∏è Ëß£ÂØÜÁõ∏ÂÖ≥‰∫ã‰ª∂ÔºàÂÖ≥ÈîÆÔºâ
event DecryptionRequested(
    uint256 indexed requestId, 
    uint256 indexed gameId, 
    uint256 timestamp
);

event DecryptionCompleted(
    uint256 indexed requestId,
    uint256 indexed gameId,
    uint32 decryptedValue
);

event DecryptionFailed(
    uint256 indexed requestId,
    uint256 indexed gameId,
    string reason
);

event DecryptionRetrying(
    uint256 indexed requestId,
    uint8 retryCount
);

event GameExpired(uint256 indexed gameId, uint256 timestamp);
event EmergencyResolved(uint256 indexed gameId, address resolver);
```

### 2.2 Ëß£ÂØÜËØ∑Ê±ÇÊ†áÂáÜÊµÅÁ®ã

```solidity
/**
 * Ê†áÂáÜËß£ÂØÜËØ∑Ê±ÇÊµÅÁ®ãÔºàÂ§çÂà∂Âç≥Áî®Ôºâ
 */
function requestDecryption(uint256 gameId) 
    external 
    returns (uint256 requestId) 
{
    Game storage game = games[gameId];
    
    // 1. È™åËØÅÊ∏∏ÊàèÁä∂ÊÄÅ
    require(game.status == GameStatus.ACTIVE, "Game not active");
    require(block.timestamp >= game.expiresAt, "Game not ended");
    require(
        block.timestamp < game.expiresAt + REQUEST_TIMEOUT,
        "Too late to request"
    );
    
    // 2. ÂáÜÂ§áÂä†ÂØÜÂÄºÔºàÊîØÊåÅÂ§ö‰∏™Ôºâ
    euint32[] memory values = new euint32[](2);
    values[0] = game.encryptedTarget;
    values[1] = game.encryptedGuess;
    
    // 3. ‚úÖ ÂÖ≥ÈîÆÊ≠•È™§ÔºöÊéàÊùÉÁªô Gateway
    for (uint256 i = 0; i < values.length; i++) {
        TFHE.allow(values[i], Gateway.GATEWAY_CONTRACT_ADDRESS);
    }
    
    // 4. ËΩ¨Êç¢‰∏∫ uint256 Êï∞ÁªÑ
    uint256[] memory cts = new uint256[](2);
    cts[0] = Gateway.toUint256(values[0]);
    cts[1] = Gateway.toUint256(values[1]);
    
    // 5. ‚úÖ ËØ∑Ê±ÇËß£ÂØÜÔºàÂÖ≥ÈîÆÂèÇÊï∞Ôºâ
    requestId = Gateway.requestDecryption(
        cts,
        this._handleDecryptionCallback.selector,  // ÂõûË∞ÉÂáΩÊï∞
        CALLBACK_GAS_LIMIT,                       // ‚úÖ Ë∂≥Â§üÁöÑ Gas
        block.timestamp + REQUEST_TIMEOUT,        // ‚úÖ ÂêàÁêÜÁöÑË∂ÖÊó∂
        false                                     // ‰∏çÊòØÂçïÁî®Êà∑Ëß£ÂØÜ
    );
    
    // 6. ‚úÖ ËÆ∞ÂΩïËØ∑Ê±ÇÊò†Â∞Ñ
    decryptionRequests[requestId] = DecryptionRequest({
        gameId: gameId,
        requester: msg.sender,
        timestamp: block.timestamp,
        retryCount: 0,
        processed: false
    });
    
    gameToRequestId[gameId] = requestId;
    requestIdToGame[requestId] = gameId;
    
    // 7. Êõ¥Êñ∞Áä∂ÊÄÅÂπ∂ÂèëÈÄÅ‰∫ã‰ª∂
    game.status = GameStatus.PENDING_DECRYPT;
    emit DecryptionRequested(requestId, gameId, block.timestamp);
}
```

### 2.3 ÂõûË∞ÉÂáΩÊï∞Ê†áÂáÜÊ®°Êùø

```solidity
/**
 * Gateway ÂõûË∞ÉÂ§ÑÁêÜÔºàÂøÖÈ°ªÂÆûÁé∞Ôºâ
 */
function _handleDecryptionCallback(
    uint256 requestId,
    uint32 decryptedValue1,
    uint32 decryptedValue2
) public onlyGateway {
    DecryptionRequest storage request = decryptionRequests[requestId];
    
    // ‚úÖ ÂÆåÊï¥È™åËØÅÔºàÈò≤Ê≠¢ÈáçÊîæÊîªÂáªÔºâ
    require(request.timestamp > 0, "Invalid request ID");
    require(!request.processed, "Request already processed");
    require(
        block.timestamp <= request.timestamp + REQUEST_TIMEOUT,
        "Request expired"
    );
    
    uint256 gameId = request.gameId;
    Game storage game = games[gameId];
    
    require(game.status == GameStatus.PENDING_DECRYPT, "Invalid game state");
    
    // Êõ¥Êñ∞Ëß£ÂØÜÁªìÊûú
    game.revealedTarget = decryptedValue1;
    game.revealedGuess = decryptedValue2;
    game.status = GameStatus.COMPLETED;
    
    // ÊâßË°å‰∏öÂä°ÈÄªËæë
    _determineWinner(gameId);
    
    // ‚úÖ Ê†áËÆ∞Â∑≤Â§ÑÁêÜ
    request.processed = true;
    
    emit DecryptionCompleted(requestId, gameId, decryptedValue1);
}
```

### 2.4 ÂÆπÈîôÊú∫Âà∂ÔºàÂøÖÈ°ªÂÆûÁé∞Ôºâ

```solidity
/**
 * ÈáçËØïÊú∫Âà∂
 */
function retryDecryption(uint256 gameId) external returns (uint256 newRequestId) {
    uint256 oldRequestId = gameToRequestId[gameId];
    DecryptionRequest storage request = decryptionRequests[oldRequestId];
    Game storage game = games[gameId];
    
    require(game.status == GameStatus.PENDING_DECRYPT, "Not retriable");
    require(!request.processed, "Already processed");
    require(request.retryCount < MAX_RETRIES, "Max retries exceeded");
    require(
        block.timestamp > request.timestamp + 5 minutes,
        "Too soon to retry"
    );
    
    request.retryCount++;
    emit DecryptionRetrying(oldRequestId, request.retryCount);
    
    // ÈáçÊñ∞Êèê‰∫§ËØ∑Ê±Ç
    newRequestId = _resubmitDecryptionRequest(gameId);
    return newRequestId;
}

/**
 * Ë∂ÖÊó∂ÂèñÊ∂à
 */
function cancelExpiredGame(uint256 gameId) external {
    Game storage game = games[gameId];
    
    require(
        game.status == GameStatus.PENDING_DECRYPT || 
        game.status == GameStatus.ACTIVE,
        "Cannot cancel"
    );
    
    require(
        block.timestamp > game.expiresAt + REQUEST_TIMEOUT,
        "Not expired yet"
    );
    
    // ÈÄÄÊ¨æ
    _refundParticipants(gameId);
    
    game.status = GameStatus.EXPIRED;
    emit GameExpired(gameId, block.timestamp);
}

/**
 * Â∫îÊÄ•Â§ÑÁêÜÔºàÁÆ°ÁêÜÂëòÔºâ
 */
function emergencyResolve(
    uint256 gameId,
    uint32 target,
    uint32 guess
) external onlyOwner {
    Game storage game = games[gameId];
    
    require(game.status == GameStatus.PENDING_DECRYPT, "Invalid state");
    require(
        block.timestamp > game.expiresAt + 1 days,
        "Too early for emergency"
    );
    
    game.revealedTarget = target;
    game.revealedGuess = guess;
    game.status = GameStatus.COMPLETED;
    
    _determineWinner(gameId);
    
    emit EmergencyResolved(gameId, msg.sender);
}
```

---

## 3. ÂâçÁ´ØÂºÄÂèëËßÑËåÉ

### 3.1 È°πÁõÆ‰æùËµñÊ†áÂáÜ

```json
{
  "dependencies": {
    "@zama-fhe/relayer-sdk": "^0.5.0",
    "ethers": "^6.10.0",
    "react": "^18.2.0",
    "react-dom": "^18.2.0"
  },
  "devDependencies": {
    "vite": "^5.4.21",
    "@vitejs/plugin-react": "^4.0.0",
    "typescript": "^5.2.2"
  }
}
```

### 3.2 Vite ÈÖçÁΩÆÊ†áÂáÜ

```typescript
// vite.config.ts
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';

export default defineConfig({
  plugins: [react()],
  
  // ‚úÖ ÈáçË¶ÅÔºöÂ§ÑÁêÜ SDK ‰æùËµñ
  optimizeDeps: {
    include: [
      "@zama-fhe/relayer-sdk",
      "ethers"
    ]
  },
  
  resolve: {
    alias: {
      '@': '/src'
    }
  },
  
  server: {
    port: 3000,
    // ‚úÖ ÂºÄÂèëÊó∂Á¶ÅÁî®ÁºìÂ≠ò
    headers: {
      'Cache-Control': 'no-store',
    }
  }
});
```

### 3.3 Relayer ÂÆ¢Êà∑Á´ØÊ†áÂáÜÂÆûÁé∞

```javascript
// utils/relayerClient.js

const RELAYER_CONFIG = {
  sepolia: {
    url: 'https://gateway.sepolia.zama.ai/v1/public-decrypt',
    chainId: 11155111
  },
  local: {
    url: 'http://localhost:8545',
    chainId: 31337
  }
};

export class RelayerClient {
  constructor(network = 'sepolia') {
    this.config = RELAYER_CONFIG[network];
  }
  
  /**
   * ‚úÖ Ê†∏ÂøÉÂäüËÉΩÔºöËΩÆËØ¢ Gateway Ëß£ÂØÜÁªìÊûú
   */
  async pollDecryption(requestId, contractAddress, options = {}) {
    const {
      maxAttempts = 60,      // 5ÂàÜÈíüÔºà60Ê¨° * 5ÁßíÔºâ
      interval = 5000,       // 5Áßí‰∏ÄÊ¨°
      onProgress = null
    } = options;
    
    console.log('üîê ÂºÄÂßãËΩÆËØ¢ Gateway Ëß£ÂØÜ...', {
      requestId: requestId.toString(),
      estimatedTime: `${(maxAttempts * interval) / 1000}Áßí`
    });
    
    for (let attempt = 1; attempt <= maxAttempts; attempt++) {
      try {
        // Ë∞ÉÁî®ËøõÂ∫¶ÂõûË∞É
        if (onProgress) {
          onProgress({
            current: attempt,
            total: maxAttempts,
            percentage: Math.round((attempt / maxAttempts) * 100)
          });
        }
        
        // ËØ∑Ê±Ç Gateway
        const response = await fetch(this.config.url, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            handle: requestId.toHexString ? requestId.toHexString() : `0x${requestId.toString(16)}`,
            contractAddress: contractAddress,
            chainId: this.config.chainId
          })
        });
        
        // ÊàêÂäü
        if (response.ok) {
          const data = await response.json();
          console.log(`‚úÖ Gateway Ëß£ÂØÜÂÆåÊàêÔºàÁ¨¨ ${attempt} Ê¨°Â∞ùËØïÔºâ`);
          return { success: true, data, attempts: attempt };
        }
        
        // 404 Ë°®Á§∫ËøòÊú™ÂáÜÂ§áÂ•Ω
        if (response.status === 404) {
          console.log(`‚è≥ Â∞ùËØï ${attempt}/${maxAttempts}...`);
        } else {
          console.warn(`‚ö†Ô∏è Gateway ËøîÂõûÂºÇÂ∏∏: ${response.status}`);
        }
        
      } catch (error) {
        console.warn(`‚ö†Ô∏è ËΩÆËØ¢Â∞ùËØï ${attempt} Â§±Ë¥•:`, error.message);
      }
      
      // Á≠âÂæÖ‰∏ã‰∏ÄÊ¨°Â∞ùËØï
      if (attempt < maxAttempts) {
        await new Promise(resolve => setTimeout(resolve, interval));
      }
    }
    
    throw new Error(`Gateway Ëß£ÂØÜË∂ÖÊó∂Ôºà${maxAttempts} Ê¨°ÔºåÂÖ± ${(maxAttempts * interval) / 1000}ÁßíÔºâ`);
  }
  
  /**
   * Ê£ÄÊü• Gateway ÂÅ•Â∫∑Áä∂ÊÄÅ
   */
  async checkHealth() {
    try {
      const baseUrl = this.config.url.replace('/v1/public-decrypt', '');
      const response = await fetch(`${baseUrl}/health`, {
        method: 'GET',
        signal: AbortSignal.timeout(5000)
      });
      return response.ok;
    } catch (error) {
      console.warn('‚ö†Ô∏è Gateway ÂÅ•Â∫∑Ê£ÄÊü•Â§±Ë¥•:', error);
      return false;
    }
  }
}

export default RelayerClient;
```

### 3.4 Ëß£ÂØÜ Hook Ê†áÂáÜÂÆûÁé∞

```javascript
// hooks/useDecryption.js

import { useState, useCallback } from 'react';
import { ethers } from 'ethers';
import RelayerClient from '../utils/relayerClient';

export function useDecryption(contract) {
  const [status, setStatus] = useState('idle');
  const [progress, setProgress] = useState(0);
  const [error, setError] = useState(null);
  const [result, setResult] = useState(null);
  
  const relayerClient = new RelayerClient('sepolia');
  
  /**
   * ÂÆåÊï¥ÁöÑËß£ÂØÜÊµÅÁ®ãÔºà5‰∏™Ê≠•È™§Ôºâ
   */
  const requestDecryption = useCallback(async (gameId) => {
    try {
      setStatus('requesting');
      setProgress(0);
      setError(null);
      setResult(null);
      
      console.log('üéÆ ÂºÄÂßãËß£ÂØÜÊ∏∏Êàè:', gameId);
      
      // ===== Step 1: Êèê‰∫§Èìæ‰∏äËß£ÂØÜËØ∑Ê±Ç =====
      setProgress(10);
      const tx = await contract.requestDecryption(gameId);
      console.log('üìù ‰∫§ÊòìÂ∑≤Êèê‰∫§:', tx.hash);
      
      setProgress(20);
      const receipt = await tx.wait();
      console.log('‚úÖ ‰∫§ÊòìÂ∑≤Á°ÆËÆ§');
      
      // ===== Step 2: ‰ªé‰∫ã‰ª∂‰∏≠Ëé∑Âèñ requestId =====
      setProgress(30);
      const event = receipt.events?.find(
        (e) => e.event === 'DecryptionRequested'
      );
      
      if (!event) {
        throw new Error('Êú™ÊâæÂà∞ DecryptionRequested ‰∫ã‰ª∂');
      }
      
      const requestId = event.args.requestId;
      console.log('üîë Ëß£ÂØÜËØ∑Ê±ÇID:', requestId.toString());
      
      // ===== Step 3: ËΩÆËØ¢ GatewayÔºàÂÖ≥ÈîÆÊ≠•È™§Ôºâ=====
      setStatus('polling');
      console.log('‚è≥ ÂºÄÂßãËΩÆËØ¢ Gateway...');
      
      await relayerClient.pollDecryption(
        requestId,
        contract.address,
        {
          onProgress: (pollProgress) => {
            const percentage = 30 + (pollProgress.percentage * 0.5);
            setProgress(Math.round(percentage));
          }
        }
      );
      
      console.log('‚úÖ Gateway Ëß£ÂØÜÂÆåÊàê');
      
      // ===== Step 4: Á≠âÂæÖÈìæ‰∏äÂõûË∞ÉÂÆåÊàê =====
      setStatus('waiting');
      setProgress(85);
      console.log('‚è≥ Á≠âÂæÖÈìæ‰∏äÂõûË∞É...');
      
      await waitForCallbackCompletion(gameId, (waitProgress) => {
        const percentage = 85 + (waitProgress * 0.15);
        setProgress(Math.round(percentage));
      });
      
      // ===== Step 5: Ëé∑ÂèñÊúÄÁªàÁªìÊûú =====
      setProgress(95);
      const gameInfo = await contract.games(gameId);
      
      const decryptionResult = {
        gameId,
        target: gameInfo.revealedTarget,
        guess: gameInfo.revealedGuess,
        winner: gameInfo.winner,
        status: gameInfo.status
      };
      
      setProgress(100);
      setStatus('success');
      setResult(decryptionResult);
      
      console.log('üéâ Ëß£ÂØÜÊµÅÁ®ãÂÆåÊàê!', decryptionResult);
      
      return decryptionResult;
      
    } catch (err) {
      console.error('‚ùå Ëß£ÂØÜÂ§±Ë¥•:', err);
      setStatus('failed');
      setError(err.message);
      throw err;
    }
  }, [contract]);
  
  /**
   * Á≠âÂæÖÈìæ‰∏äÂõûË∞ÉÂÆåÊàê
   */
  const waitForCallbackCompletion = async (gameId, onProgress) => {
    const MAX_WAIT = 120; // 2ÂàÜÈíü
    const INTERVAL = 2000; // 2Áßí
    
    for (let i = 0; i < MAX_WAIT; i++) {
      onProgress(i / MAX_WAIT);
      
      const game = await contract.games(gameId);
      
      // status: 2 = COMPLETED
      if (game.status === 2) {
        console.log('‚úÖ ÂõûË∞ÉÂ∑≤Âú®Èìæ‰∏äÂÆåÊàê');
        return;
      }
      
      await new Promise(resolve => setTimeout(resolve, INTERVAL));
    }
    
    throw new Error('Á≠âÂæÖÂõûË∞ÉË∂ÖÊó∂ - ËØ∑Ê£ÄÊü•ÂêàÁ∫¶Áä∂ÊÄÅÊàñÈáçËØï');
  };
  
  return {
    requestDecryption,
    status,
    progress,
    error,
    result
  };
}
```

### 3.5 ÂâçÁ´ØÂä†ÂØÜÂàõÂª∫Ê†áÂáÜÂÆûÁé∞ ‚≠ê **Êñ∞Â¢û**

> **ÈáçË¶ÅËØ¥Êòé**ÔºöËøôÊòØ FHE Â∫îÁî®ÁöÑ**ÂÖ≥ÈîÆÁªÑÊàêÈÉ®ÂàÜ**Ôºå‰ΩÜÊâãÂÜåÊ≠§ÂâçÈÅóÊºè‰∫ÜËøô‰∏™ÈáçË¶ÅÁéØËäÇ„ÄÇÊâÄÊúâËé∑Â•ñÈ°πÁõÆÈÉΩÂÆûÁé∞‰∫ÜÂÆåÊï¥ÁöÑÂâçÁ´ØÂä†ÂØÜÂàõÂª∫ÂäüËÉΩ„ÄÇ

#### 3.5.1 Ê†∏ÂøÉÊ¶ÇÂøµ

Âú® FHE Â∫îÁî®‰∏≠ÔºåÂâçÁ´ØÈúÄË¶Å**‰∏ªÂä®Âä†ÂØÜÊï∞ÊçÆ**ÔºåÁÑ∂Âêé‰º†ÈÄíÁªôÊô∫ËÉΩÂêàÁ∫¶Ôºö

```
Áî®Êà∑ËæìÂÖ•ÊòéÊñáÊï∞ÊçÆ
    ‚Üì
ÂâçÁ´Ø‰ΩøÁî® createEncryptedInput() Âä†ÂØÜ
    ‚Üì
ÁîüÊàê einput (Âä†ÂØÜÂè•ÊüÑ) Âíå bytes (ËØÅÊòé)
    ‚Üì
‰º†ÈÄíÁªôÊô∫ËÉΩÂêàÁ∫¶Â≠òÂÇ®
```

**‰∏∫‰ªÄ‰πàÈúÄË¶ÅÂâçÁ´ØÂä†ÂØÜÔºü**
- ‚úÖ Êï∞ÊçÆÂú®**Á¶ªÂºÄÁî®Êà∑ËÆæÂ§áÂâç**Â∞±Â∑≤ÁªèÂä†ÂØÜ
- ‚úÖ Êô∫ËÉΩÂêàÁ∫¶Âè™Êé•Êî∂ÂØÜÊñáÔºå‰∏çÂ§ÑÁêÜÊòéÊñá
- ‚úÖ Á¨¶Âêà FHE ÁöÑÈöêÁßÅ‰øùÊä§ÂéüÂàô

#### 3.5.2 Âä†ÂØÜÂ∑•ÂÖ∑ÂáΩÊï∞Ê†áÂáÜÂÆûÁé∞

```javascript
// utils/fheEncryption.js
import { createEncryptedInput } from '@zama-fhe/relayer-sdk';
import { ethers } from 'ethers';
import { PAYROLL_FHE_ADDRESS } from '../constants/contracts';

/**
 * ‚úÖ Ê†∏ÂøÉÂäüËÉΩÔºöÂàõÂª∫Âä†ÂØÜËæìÂÖ•Êï∞ÁªÑ
 * @param signerAddress Á≠æÂêçËÄÖÂú∞ÂùÄÔºàÈõá‰∏ªÔºâ
 * @param salaries Ëñ™ËµÑÊï∞ÁªÑÔºàETH Â≠óÁ¨¶‰∏≤Ôºâ
 * @returns { encryptedInputs, inputProofs, totalAmount }
 */
export async function createEncryptedSalaries(
  signerAddress,
  salaries
) {
  const encryptedInputs = [];
  const inputProofs = [];
  let totalAmount = 0n;

  console.log('üîê ÂºÄÂßãÂä†ÂØÜËñ™ËµÑ...', {
    count: salaries.length,
    signerAddress,
    contractAddress: PAYROLL_FHE_ADDRESS
  });

  // ‰∏∫ÊØè‰∏™Ëñ™ËµÑÂàõÂª∫Âä†ÂØÜËæìÂÖ•
  for (let i = 0; i < salaries.length; i++) {
    const salaryEth = salaries[i];
    const salaryInWei = ethers.parseEther(salaryEth);

    console.log(`üìù Âä†ÂØÜËñ™ËµÑ ${i + 1}/${salaries.length}: ${salaryEth} ETH`);

    try {
      // ‚ö†Ô∏è Ê≠•È™§ 1: ÂàõÂª∫Âä†ÂØÜ‰∏ä‰∏ãÊñá
      const input = createEncryptedInput(
        PAYROLL_FHE_ADDRESS,  // ÂêàÁ∫¶Âú∞ÂùÄ
        signerAddress          // Á≠æÂêçËÄÖÂú∞ÂùÄ
      );

      // ‚ö†Ô∏è Ê≠•È™§ 2: Ê∑ªÂä†Êï∞ÊçÆÔºà64‰ΩçÊó†Á¨¶Âè∑Êï¥Êï∞Ôºâ
      const salaryBigInt = BigInt(salaryInWei.toString());
      input.add64(salaryBigInt);

      // ‚ö†Ô∏è Ê≠•È™§ 3: Âä†ÂØÜÂπ∂ÁîüÊàêËØÅÊòé
      const { handles, inputProof } = await input.encrypt();

      if (!handles || handles.length === 0) {
        throw new Error(`Âä†ÂØÜÂ§±Ë¥•: Ëñ™ËµÑ ${i + 1} Êú™ËøîÂõû handles`);
      }

      if (!inputProof) {
        throw new Error(`Âä†ÂØÜÂ§±Ë¥•: Ëñ™ËµÑ ${i + 1} Êú™ËøîÂõûËØÅÊòé`);
      }

      // ‚ö†Ô∏è Ê≠•È™§ 4: Â≠òÂÇ®Âä†ÂØÜÂè•ÊüÑÂíåËØÅÊòé
      encryptedInputs.push(handles[0]);  // einput
      inputProofs.push(inputProof);       // bytes (attestation)

      // ‚ö†Ô∏è Ê≠•È™§ 5: Á¥ØÂä†ÊÄªÈáëÈ¢ù
      totalAmount += salaryInWei;

      console.log(`‚úÖ Ëñ™ËµÑ ${i + 1} Âä†ÂØÜÊàêÂäü`);
    } catch (error) {
      console.error(`‚ùå Ëñ™ËµÑ ${i + 1} Âä†ÂØÜÂ§±Ë¥•:`, error);
      throw new Error(`Âä†ÂØÜÂ§±Ë¥•: ${error.message}`);
    }
  }

  console.log('‚úÖ ÊâÄÊúâËñ™ËµÑÂä†ÂØÜÂÆåÊàê', {
    count: encryptedInputs.length,
    totalAmount: ethers.formatEther(totalAmount)
  });

  return {
    encryptedInputs,  // string[] - einput Êï∞ÁªÑ
    inputProofs,      // string[] - bytes Êï∞ÁªÑ
    totalAmount       // bigint - ÊÄªÈáëÈ¢ùÔºàWeiÔºâ
  };
}
```

#### 3.5.3 Âú® React ÁªÑ‰ª∂‰∏≠‰ΩøÁî®

```javascript
// components/EmployerPanel.jsx
import { useState } from 'react';
import { createEncryptedSalaries } from '../utils/fheEncryption';
import { useWallet } from '../contexts/WalletContext';
import { useContract } from '../contexts/ContractContext';
import { usePayroll } from '../hooks/usePayroll';

export default function EmployerPanel() {
  const { address, signer } = useWallet();
  const { contractType } = useContract();
  const { createPayrollSimple, createPayrollFHE, loading } = usePayroll();

  const [title, setTitle] = useState('');
  const [employees, setEmployees] = useState([
    { address: '', salary: '' }
  ]);

  // ‚úÖ FHE Ê®°ÂºèÂàõÂª∫ÊµÅÁ®ã
  const handleSubmit = async (e) => {
    e.preventDefault();

    // È™åËØÅËæìÂÖ•
    if (!title.trim() || employees.length === 0) {
      alert('ËØ∑Â°´ÂÜôÂÆåÊï¥‰ø°ÊÅØ');
      return;
    }

    // Ê£ÄÊü•Èí±ÂåÖËøûÊé•
    if (!address || !signer) {
      alert('ËØ∑ÂÖàËøûÊé•Èí±ÂåÖ');
      return;
    }

    const addresses = employees.map(e => e.address);
    const salaries = employees.map(e => e.salary);

    try {
      if (contractType === 'fhe') {
        // ===== FHE Ê®°ÂºèÔºöÂÖàÂä†ÂØÜÔºåÂÜçÂàõÂª∫ =====
        
        // 1. ÊòæÁ§∫Âä†ÂØÜËøõÂ∫¶
        setLoading(true);
        setResult({ type: 'success', message: 'üîê Ê≠£Âú®Âä†ÂØÜËñ™ËµÑ...' });

        // 2. ÂàõÂª∫Âä†ÂØÜËæìÂÖ•
        const { encryptedInputs, inputProofs, totalAmount } = 
          await createEncryptedSalaries(address, salaries);

        setResult({ type: 'success', message: 'üìù Ê≠£Âú®ÂàõÂª∫Âä†ÂØÜËñ™ÈÖ¨ËÆ°Âàí...' });

        // 3. Ë∞ÉÁî® FHE ÂêàÁ∫¶
        const res = await createPayrollFHE(
          title,
          addresses,
          encryptedInputs,
          inputProofs,
          totalAmount
        );

        if (res.success) {
          setResult({
            type: 'success',
            message: `‚úÖ Âä†ÂØÜËñ™ÈÖ¨ËÆ°ÂàíÂàõÂª∫ÊàêÂäüÔºÅ\nËÆ°Âàí ID: ${res.planId}`
          });
          
          // ÈáçÁΩÆË°®Âçï
          setTitle('');
          setEmployees([{ address: '', salary: '' }]);
        } else {
          setResult({
            type: 'error',
            message: `‚ùå ÂàõÂª∫Â§±Ë¥•: ${res.error}`
          });
        }
      } else {
        // ===== Simple Ê®°ÂºèÔºöÁõ¥Êé•ÂàõÂª∫ =====
        const res = await createPayrollSimple(title, addresses, salaries);
        
        if (res.success) {
          setResult({
            type: 'success',
            message: `‚úÖ Ëñ™ÈÖ¨ËÆ°ÂàíÂàõÂª∫ÊàêÂäüÔºÅ\nËÆ°Âàí ID: ${res.planId}`
          });
        }
      }
    } catch (err) {
      console.error('ÂàõÂª∫Â§±Ë¥•:', err);
      setResult({
        type: 'error',
        message: `‚ùå ÈîôËØØ: ${err.message}`
      });
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="employer-panel">
      <form onSubmit={handleSubmit}>
        {/* Ë°®ÂçïÂÜÖÂÆπ */}
      </form>
    </div>
  );
}
```

#### 3.5.4 ÂÆåÊï¥ÁöÑ FHE ÂàõÂª∫ÊµÅÁ®ã

```
Áî®Êà∑Êìç‰ΩúÊµÅÁ®ãÔºö

1. Áî®Êà∑Â°´ÂÜôË°®Âçï
   - ËæìÂÖ•ËÆ°ÂàíÂêçÁß∞
   - Ê∑ªÂä†ÂëòÂ∑•Âú∞ÂùÄÂíåËñ™ËµÑ

2. ÂâçÁ´ØÈ™åËØÅ
   - Ê£ÄÊü•Ë°®ÂçïÂÆåÊï¥ÊÄß
   - Ê£ÄÊü•Èí±ÂåÖËøûÊé•

3. ÂâçÁ´ØÂä†ÂØÜÔºàFHE Ê®°ÂºèÔºâ
   ‚îú‚îÄ createEncryptedInput(contractAddress, signerAddress)
   ‚îú‚îÄ input.add64(BigInt(amount))
   ‚îú‚îÄ input.encrypt() ‚Üí { handles, inputProof }
   ‚îî‚îÄ ÈáçÂ§çÂ§ÑÁêÜÊâÄÊúâËñ™ËµÑ

4. Èìæ‰∏äÂàõÂª∫
   ‚îú‚îÄ Ë∞ÉÁî® createPayroll(
   ‚îÇ     title,
   ‚îÇ     employees,
   ‚îÇ     encryptedInputs,  // einput[]
   ‚îÇ     inputProofs        // bytes[]
   ‚îÇ   )
   ‚îú‚îÄ ÊîØ‰ªòÊÄªÈáëÈ¢ù (msg.value)
   ‚îî‚îÄ ÂêàÁ∫¶Â≠òÂÇ®Âä†ÂØÜÊï∞ÊçÆ

5. ÂÆåÊàê
   ‚îî‚îÄ ÊòæÁ§∫ÂàõÂª∫ÊàêÂäü‰ø°ÊÅØ
```

#### 3.5.5 ÂÖ≥ÈîÆ API ËØ¥Êòé

##### `createEncryptedInput(contractAddress, signerAddress)`

ÂàõÂª∫Âä†ÂØÜËæìÂÖ•‰∏ä‰∏ãÊñá„ÄÇ

**ÂèÇÊï∞**Ôºö
- `contractAddress` (string): ÁõÆÊ†áÂêàÁ∫¶Âú∞ÂùÄ
- `signerAddress` (string): Á≠æÂêçËÄÖÂú∞ÂùÄÔºàÈÄöÂ∏∏ÊòØÁî®Êà∑Èí±ÂåÖÂú∞ÂùÄÔºâ

**ËøîÂõû**Ôºö`EncryptedInput` ÂØπË±°

**Á§∫‰æã**Ôºö
```javascript
const input = createEncryptedInput(
  '0x1234...',  // ÂêàÁ∫¶Âú∞ÂùÄ
  '0x5678...'   // Á≠æÂêçËÄÖÂú∞ÂùÄ
);
```

##### `input.add64(value)`

Ê∑ªÂä† 64 ‰ΩçÊó†Á¨¶Âè∑Êï¥Êï∞Âà∞Âä†ÂØÜËæìÂÖ•„ÄÇ

**ÂèÇÊï∞**Ôºö
- `value` (bigint): Ë¶ÅÂä†ÂØÜÁöÑÂÄºÔºàÂøÖÈ°ªÊòØ BigIntÔºâ

**Á§∫‰æã**Ôºö
```javascript
const amount = ethers.parseEther('0.1');  // 0.1 ETH
input.add64(BigInt(amount.toString()));
```

##### `input.add32(value)` / `input.add16(value)` / `input.add8(value)`

Ê†πÊçÆÊï∞ÊçÆÁ±ªÂûãÈÄâÊã©ÂêàÈÄÇÁöÑÊñπÊ≥ïÔºö
- `add64`: uint64ÔºàÈÄÇÁî®‰∫éÈáëÈ¢ù„ÄÅÂ§ßÊï∞Â≠óÔºâ
- `add32`: uint32ÔºàÈÄÇÁî®‰∫éËÆ°Êï∞„ÄÅ‰∏≠Á≠âÊï∞Â≠óÔºâ
- `add16`: uint16ÔºàÈÄÇÁî®‰∫éÂ∞èÊï∞Â≠óÔºâ
- `add8`: uint8ÔºàÈÄÇÁî®‰∫éÊ†áËÆ∞„ÄÅÁä∂ÊÄÅÔºâ

**Á§∫‰æã**Ôºö
```javascript
// ÈáëÈ¢ùÔºàÊé®Ëçê‰ΩøÁî® 64 ‰ΩçÔºâ
input.add64(BigInt(amountInWei.toString()));

// ËÆ°Êï∞Ôºà32 ‰ΩçË∂≥Â§üÔºâ
input.add32(42n);

// Ê†áËÆ∞Ôºà8 ‰ΩçË∂≥Â§üÔºâ
input.add8(1n);  // 1 = true, 0 = false
```

##### `input.encrypt()`

ÊâßË°åÂä†ÂØÜÂπ∂ÁîüÊàêËØÅÊòé„ÄÇ

**ËøîÂõû**Ôºö`Promise<{ handles: string[], inputProof: string }>`

**Á§∫‰æã**Ôºö
```javascript
const { handles, inputProof } = await input.encrypt();

// handles[0] ÊòØ einputÔºàÂä†ÂØÜÂè•ÊüÑÔºâ
// inputProof ÊòØ bytesÔºàËØÅÊòé/attestationÔºâ
```

#### 3.5.6 Â∏∏ËßÅÈóÆÈ¢ò‰∏éËß£ÂÜ≥ÊñπÊ°à

##### ÈóÆÈ¢ò 1: `createEncryptedInput is not a function`

**ÂéüÂõ†**ÔºöSDK Êú™Ê≠£Á°ÆÂØºÂÖ•ÊàñÁâàÊú¨‰∏çÂÖºÂÆπ„ÄÇ

**Ëß£ÂÜ≥ÊñπÊ°à**Ôºö
```javascript
// ‚úÖ Ê≠£Á°ÆÂØºÂÖ•
import { createEncryptedInput } from '@zama-fhe/relayer-sdk';

// ‚ùå ÈîôËØØÂØºÂÖ•
// import { createEncryptedInput } from 'fhevmjs';
```

Ê£ÄÊü• `package.json`Ôºö
```json
{
  "dependencies": {
    "@zama-fhe/relayer-sdk": "^0.5.0"
  }
}
```

##### ÈóÆÈ¢ò 2: `input.add64() expects BigInt`

**ÂéüÂõ†**Ôºö‰º†ÈÄí‰∫Ü Number Á±ªÂûã„ÄÇ

**Ëß£ÂÜ≥ÊñπÊ°à**Ôºö
```javascript
// ‚ùå ÈîôËØØ
input.add64(1000000000000000000);

// ‚úÖ Ê≠£Á°Æ
input.add64(BigInt(1000000000000000000));
input.add64(1000000000000000000n);  // Áõ¥Êé•‰ΩøÁî® BigInt Â≠óÈù¢Èáè
```

##### ÈóÆÈ¢ò 3: `handles is empty`

**ÂéüÂõ†**ÔºöÂä†ÂØÜÂ§±Ë¥•Êàñ SDK ÁâàÊú¨ÈóÆÈ¢ò„ÄÇ

**Ëß£ÂÜ≥ÊñπÊ°à**Ôºö
```javascript
const { handles, inputProof } = await input.encrypt();

if (!handles || handles.length === 0) {
  throw new Error('Âä†ÂØÜÂ§±Ë¥•: handles ‰∏∫Á©∫');
}

if (!inputProof) {
  throw new Error('Âä†ÂØÜÂ§±Ë¥•: inputProof ‰∏∫Á©∫');
}

// ‚úÖ ‰ΩøÁî®Á¨¨‰∏Ä‰∏™ handle
const encryptedInput = handles[0];
```

##### ÈóÆÈ¢ò 4: ÂêàÁ∫¶Ë∞ÉÁî®Â§±Ë¥• `Invalid einput`

**ÂéüÂõ†**Ôºö`handles` Âíå `inputProofs` Êï∞ÁªÑÈïøÂ∫¶‰∏çÂåπÈÖç„ÄÇ

**Ëß£ÂÜ≥ÊñπÊ°à**Ôºö
```javascript
// ‚úÖ Á°Æ‰øùÈïøÂ∫¶‰∏ÄËá¥
if (encryptedInputs.length !== inputProofs.length) {
  throw new Error('Âä†ÂØÜËæìÂÖ•ÂíåËØÅÊòéÈïøÂ∫¶‰∏çÂåπÈÖç');
}

if (encryptedInputs.length !== employees.length) {
  throw new Error('Âä†ÂØÜËæìÂÖ•ÂíåÂëòÂ∑•Êï∞Èáè‰∏çÂåπÈÖç');
}
```

#### 3.5.7 ÂÆåÊï¥Á§∫‰æãÔºöËñ™ÈÖ¨Á≥ªÁªüÂä†ÂØÜÂàõÂª∫

```javascript
// utils/fheEncryption.js - ÂÆåÊï¥ÂÆûÁé∞
import { createEncryptedInput } from '@zama-fhe/relayer-sdk';
import { ethers } from 'ethers';

export async function createEncryptedPayroll(
  contractAddress,
  signerAddress,
  employees,
  salaries  // ETH Â≠óÁ¨¶‰∏≤Êï∞ÁªÑ
) {
  const encryptedInputs = [];
  const inputProofs = [];
  let totalAmount = 0n;

  // È™åËØÅËæìÂÖ•
  if (employees.length !== salaries.length) {
    throw new Error('ÂëòÂ∑•Êï∞ÈáèÂíåËñ™ËµÑÊï∞Èáè‰∏çÂåπÈÖç');
  }

  // Âä†ÂØÜÊØè‰∏™Ëñ™ËµÑ
  for (let i = 0; i < salaries.length; i++) {
    try {
      // 1. ÂàõÂª∫Âä†ÂØÜ‰∏ä‰∏ãÊñá
      const input = createEncryptedInput(contractAddress, signerAddress);

      // 2. ËΩ¨Êç¢‰∏∫ Wei Âπ∂Ê∑ªÂä†
      const salaryInWei = ethers.parseEther(salaries[i]);
      input.add64(BigInt(salaryInWei.toString()));

      // 3. Âä†ÂØÜ
      const { handles, inputProof } = await input.encrypt();

      // 4. È™åËØÅÁªìÊûú
      if (!handles || handles.length === 0) {
        throw new Error(`Ëñ™ËµÑ ${i + 1} Âä†ÂØÜÂ§±Ë¥•: handles ‰∏∫Á©∫`);
      }

      // 5. Â≠òÂÇ®
      encryptedInputs.push(handles[0]);
      inputProofs.push(inputProof);
      totalAmount += salaryInWei;

    } catch (error) {
      throw new Error(`Ëñ™ËµÑ ${i + 1} Âä†ÂØÜÂ§±Ë¥•: ${error.message}`);
    }
  }

  return {
    encryptedInputs,  // ‰º†ÈÄíÁªôÂêàÁ∫¶ÁöÑ einput[]
    inputProofs,      // ‰º†ÈÄíÁªôÂêàÁ∫¶ÁöÑ bytes[]
    totalAmount       // Áî®‰∫é msg.value
  };
}
```

#### 3.5.8 ‰∏éÂÖ∂‰ªñÁ´†ËäÇÁöÑÂÖ≥ËÅî

- **ÂêàÁ∫¶Á´Ø**ÔºöÂèÇËÄÉÁ¨¨2.2ËäÇÔºàÂêàÁ∫¶Â¶Ç‰ΩïÊé•Êî∂ `einput[]` Âíå `bytes[]`Ôºâ
- **Ëß£ÂØÜÊµÅÁ®ã**ÔºöÂèÇËÄÉÁ¨¨3.4ËäÇÔºàÂëòÂ∑•Â¶Ç‰ΩïËß£ÂØÜÊü•ÁúãËñ™ËµÑÔºâ
- **Gateway ÈõÜÊàê**ÔºöÂèÇËÄÉÁ¨¨4Á´†ÔºàËß£ÂØÜÂÆåÊàêÂêéÂ¶Ç‰Ωï‰ΩøÁî® GatewayÔºâ

#### 3.5.9 ÊúÄ‰Ω≥ÂÆûË∑µ

1. **ÈîôËØØÂ§ÑÁêÜ**Ôºö
   - ‚úÖ ÊØè‰∏™Âä†ÂØÜÊ≠•È™§ÈÉΩË¶Å try-catch
   - ‚úÖ Êèê‰æõÊ∏ÖÊô∞ÁöÑÈîôËØØ‰ø°ÊÅØ
   - ‚úÖ ÊòæÁ§∫ËøõÂ∫¶ÁªôÁî®Êà∑

2. **ÊÄßËÉΩ‰ºòÂåñ**Ôºö
   - ‚úÖ ÊâπÈáèÂä†ÂØÜÊó∂ÊòæÁ§∫ËøõÂ∫¶Êù°
   - ‚úÖ ÂèØ‰ª•ËÄÉËôëÂπ∂Ë°åÂä†ÂØÜÔºàÂ¶ÇÊûúÊúâÂ§ö‰∏™Áã¨Á´ãËæìÂÖ•Ôºâ

3. **Áî®Êà∑‰ΩìÈ™å**Ôºö
   - ‚úÖ ÊòæÁ§∫Âä†ÂØÜËøõÂ∫¶Ôºö"Ê≠£Âú®Âä†ÂØÜËñ™ËµÑ 1/5..."
   - ‚úÖ ÊòæÁ§∫ÊÄªÈáëÈ¢ùÈ¢ÑËßà
   - ‚úÖ Âä†ÂØÜÂÆåÊàêÂêéÁ´ãÂç≥Êèê‰∫§

4. **ÂÆâÂÖ®ÊÄß**Ôºö
   - ‚úÖ Âä†ÂØÜÂú®ÂÆ¢Êà∑Á´ØÂÆåÊàêÔºàÊï∞ÊçÆ‰∏çÂá∫Êú¨Âú∞Ôºâ
   - ‚úÖ È™åËØÅÂä†ÂØÜÁªìÊûúÂÜçÊèê‰∫§
   - ‚úÖ ËÆ∞ÂΩïÂä†ÂØÜÊó•ÂøóÁî®‰∫éË∞ÉËØï

---

## 4. Gateway Ëß£ÂØÜÂÆåÊï¥ÊñπÊ°à

### 4.1 Ëß£ÂØÜÊµÅÁ®ãÂõæ

```
Áî®Êà∑Êìç‰Ωú
    ‚Üì
„Äê1„ÄëÊèê‰∫§Ëß£ÂØÜËØ∑Ê±Ç (requestDecryption)
    ‚Üì
„Äê2„ÄëÂêàÁ∫¶ÂèëÈÄÅÂà∞ Gateway (Gateway.requestDecryption)
    ‚Üì (ËøîÂõû requestId)
„Äê3„ÄëÂâçÁ´ØËΩÆËØ¢ Gateway (/v1/public-decrypt)
    ‚Üì (30-60Áßí)
„Äê4„ÄëGateway ÂÆåÊàêËß£ÂØÜ (ËøîÂõûÊòéÊñá)
    ‚Üì
„Äê5„ÄëGateway Ë∞ÉÁî®ÂêàÁ∫¶ÂõûË∞É (_handleDecryptionCallback)
    ‚Üì
„Äê6„ÄëÂâçÁ´ØÁõëÂê¨‰∫ã‰ª∂ (DecryptionCompleted)
    ‚Üì
„Äê7„ÄëÊòæÁ§∫Ëß£ÂØÜÁªìÊûú
```

### 4.2 ÂÖ≥ÈîÆÂèÇÊï∞ÈÖçÁΩÆ

```solidity
// ÂêàÁ∫¶Á´Ø
uint256 public constant CALLBACK_GAS_LIMIT = 500000;  // ‚ö†Ô∏è Ê†πÊçÆ‰∏öÂä°Ë∞ÉÊï¥
uint256 public constant REQUEST_TIMEOUT = 30 minutes;
uint8 public constant MAX_RETRIES = 3;
```

```javascript
// ÂâçÁ´Ø
const RELAYER_CONFIG = {
  maxAttempts: 60,      // 5ÂàÜÈíü
  interval: 5000,       // 5Áßí‰∏ÄÊ¨°
  timeout: 300000       // ÊÄªË∂ÖÊó∂ 5ÂàÜÈíü
};
```

### 4.3 ÈîôËØØÂ§ÑÁêÜÁü©Èòµ

| ÈîôËØØÁ±ªÂûã | Ë°®Áé∞ | ÂéüÂõ† | Ëß£ÂÜ≥ÊñπÊ°à |
|---------|------|------|---------|
| Gateway Unavailable | ËΩÆËØ¢‰∏ÄÁõ¥ 404 | Gateway ÊúçÂä°Á¶ªÁ∫ø | Á≠âÂæÖÊÅ¢Â§çÊàñ‰ΩøÁî® Fallback ÂêàÁ∫¶ |
| Callback Timeout | ‰∫ã‰ª∂Êú™Ëß¶Âèë | Gas ‰∏çË∂≥ÊàñÈÄªËæëÈîôËØØ | Â¢ûÂä† CALLBACK_GAS_LIMIT |
| Request Already Processed | ÈáçÂ§çÂõûË∞É | Êú™Ê†áËÆ∞ processed | Ê∑ªÂä† `require(!request.processed)` |
| Expired Request | Ë∂ÖÊó∂ÊãíÁªù | Ë∂ÖËøá REQUEST_TIMEOUT | ÂÖÅËÆ∏ÈáçËØïÊàñÂ¢ûÂä†Ë∂ÖÊó∂Êó∂Èó¥ |
| Polling Timeout | ÂâçÁ´ØË∂ÖÊó∂ | Gateway ÂìçÂ∫îÊÖ¢ | Â¢ûÂä† maxAttempts |

---

## 5. ÊµèËßàÂô®ÁéØÂ¢ÉÈóÆÈ¢òËß£ÂÜ≥

### 5.1 eth_call Êó†ÂìçÂ∫îÈóÆÈ¢ò

#### ÈóÆÈ¢òËØäÊñ≠

```javascript
// Ê£ÄÊµã 1: MetaMask ÈÄöÈÅì
const netVersion = await window.ethereum.request({ method: 'net_version' });
console.log('ÁΩëÁªú ID:', netVersion);
// ‚úÖ ÊúâËæìÂá∫ ‚Üí MetaMask Ê≠£Â∏∏
// ‚ùå Êó†ËæìÂá∫ ‚Üí MetaMask ÂÜªÁªìÔºåÈúÄÈáçÂêØÊµèËßàÂô®

// Ê£ÄÊµã 2: Gateway Áä∂ÊÄÅ
const response = await fetch('https://gateway.sepolia.zama.ai/health');
console.log('Gateway Áä∂ÊÄÅ:', response.ok);
// ‚úÖ true ‚Üí Gateway Âú®Á∫ø
// ‚ùå false ‚Üí Gateway Á¶ªÁ∫ø
```

#### Ê†áÂáÜËß£ÂÜ≥ÊñπÊ°à

```javascript
// utils/safeContractCall.js

import { ethers } from 'ethers';

const FALLBACK_RPCS = [
  'https://ethereum-sepolia-rpc.publicnode.com',
  'https://sepolia.gateway.tenderly.co',
  'https://eth-sepolia.public.blastapi.io'
];

/**
 * ÂÆâÂÖ®ÁöÑÂêàÁ∫¶Ë∞ÉÁî®ÔºàËá™Âä® FallbackÔºâ
 */
export async function safeContractCall(
  contractAddress,
  abi,
  functionName,
  args = []
) {
  const iface = new ethers.Interface(abi);
  const data = iface.encodeFunctionData(functionName, args);
  
  // ÊñπÊ°à 1: Â∞ùËØï MetaMask
  if (window.ethereum) {
    try {
      const from = (await window.ethereum.request({ 
        method: 'eth_accounts' 
      }))?.[0] ?? ethers.ZeroAddress;
      
      const callPromise = window.ethereum.request({
        method: 'eth_call',
        params: [{ from, to: contractAddress, data }, 'latest']
      });
      
      // ‚úÖ Ë∂ÖÊó∂‰øùÊä§Ôºà5ÁßíÔºâ
      const timeoutPromise = new Promise((_, reject) =>
        setTimeout(() => reject(new Error('eth_call Ë∂ÖÊó∂')), 5000)
      );
      
      const result = await Promise.race([callPromise, timeoutPromise]);
      const decoded = iface.decodeFunctionResult(functionName, result);
      
      console.log('‚úÖ MetaMask Ë∞ÉÁî®ÊàêÂäü');
      return decoded[0];
      
    } catch (error) {
      console.warn('‚ö†Ô∏è MetaMask Ë∞ÉÁî®Â§±Ë¥•:', error.message);
    }
  }
  
  // ÊñπÊ°à 2: Â∞ùËØïÂÖ¨ÂÖ± RPCÔºàÈ°∫Â∫èÂ∞ùËØïÔºâ
  for (const rpcUrl of FALLBACK_RPCS) {
    try {
      console.log(`üîÅ Â∞ùËØïÂ§áÁî® RPC: ${rpcUrl}`);
      
      const provider = new ethers.JsonRpcProvider(rpcUrl);
      const contract = new ethers.Contract(contractAddress, abi, provider);
      const result = await contract[functionName](...args);
      
      console.log('‚úÖ Â§áÁî® RPC Ë∞ÉÁî®ÊàêÂäü');
      return result;
      
    } catch (error) {
      console.warn(`‚ùå RPC Â§±Ë¥•: ${rpcUrl}`, error.message);
    }
  }
  
  throw new Error('ÊâÄÊúâ RPC Ë∞ÉÁî®ÂùáÂ§±Ë¥•');
}

// ‰ΩøÁî®Á§∫‰æã
const total = await safeContractCall(
  CONTRACT_ADDRESS,
  abi,
  'getTotalGames'
);
```

### 5.2 VPN/‰ª£ÁêÜÈóÆÈ¢ò

```javascript
// Ê£ÄÊµã‰ª£ÁêÜÂπ≤Êâ∞
async function checkProxyInterference() {
  const tests = [
    { name: 'MetaMask RPC', test: () => window.ethereum.request({ method: 'eth_chainId' }) },
    { name: 'Public RPC', test: () => fetch('https://eth-sepolia.public.blastapi.io') },
    { name: 'Gateway', test: () => fetch('https://gateway.sepolia.zama.ai/health') }
  ];
  
  for (const { name, test } of tests) {
    try {
      await Promise.race([
        test(),
        new Promise((_, reject) => setTimeout(() => reject('timeout'), 3000))
      ]);
      console.log(`‚úÖ ${name} Ê≠£Â∏∏`);
    } catch (error) {
      console.error(`‚ùå ${name} Â§±Ë¥•:`, error);
    }
  }
}
```

**Ëß£ÂÜ≥ÊñπÊ°àÔºö**
1. ‰∏¥Êó∂ÂÖ≥Èó≠ VPN
2. Âú®‰ª£ÁêÜËßÑÂàô‰∏≠Ê∑ªÂä†Áõ¥ËøûÔºö`*.sepolia.*, *.blastapi.io, *.publicnode.com`
3. ‰ΩøÁî®ÂÖ®Â±Ä‰ª£ÁêÜÊ®°ÂºèÔºà‰∏çÊé®ËçêÔºâ

### 5.3 CORS ÈóÆÈ¢ò

```javascript
// ‚ùå ÈîôËØØÔºöÁõ¥Êé• fetch RPC
const response = await fetch('https://eth-sepolia.public.blastapi.io', {
  method: 'POST',
  body: JSON.stringify({
    jsonrpc: '2.0',
    method: 'eth_call',
    params: [...]
  })
});
// ÁªìÊûúÔºöCORS ÈîôËØØ

// ‚úÖ Ê≠£Á°ÆÔºö‰ΩøÁî® window.ethereum Êàñ ethers.JsonRpcProvider
const provider = new ethers.JsonRpcProvider('https://eth-sepolia.public.blastapi.io');
const result = await provider.call({ to, data });
```

---

## 6. Èí±ÂåÖÂÖºÂÆπÊÄß‰∏é‰∫§ÊòìÁ°ÆËÆ§ÈóÆÈ¢òÔºàOKX/MetaMaskÔºâ

### 6.1 ÈóÆÈ¢òËÉåÊôØ

Âú®ÂºÄÂèëÂü∫‰∫é FHEVM ÁöÑ dApp Êó∂Ôºå**Èí±ÂåÖÂÖºÂÆπÊÄß**Âíå**‰∫§ÊòìÁ°ÆËÆ§Êú∫Âà∂**ÊòØÊúÄÂÆπÊòìÂá∫Áé∞ÈóÆÈ¢òÁöÑÁéØËäÇ„ÄÇ‰∏çÂêåÈí±ÂåÖÔºàMetaMask„ÄÅOKX Wallet Á≠âÔºâÂØπ‰ª•Â§™Âùä API ÁöÑÂÆûÁé∞Â≠òÂú®Â∑ÆÂºÇÔºåÂØºËá¥Áõ∏ÂêåÁöÑ‰ª£Á†ÅÂú®‰∏çÂêåÈí±ÂåÖ‰∏≠Ë°®Áé∞‰∏ç‰∏ÄËá¥„ÄÇ

**Ê†∏ÂøÉÈóÆÈ¢òÊ∏ÖÂçïÔºö**

| ÈóÆÈ¢òÁ±ªÂûã | ÁóáÁä∂ | ÂΩ±ÂìçÈí±ÂåÖ |
|---------|------|---------|
| üö´ Èí±ÂåÖÂºπÁ™ó‰∏çÂá∫Áé∞ | ÁÇπÂáªÊèê‰∫§ÂêéÊó†ÂèçÂ∫î | OKX„ÄÅÈÉ®ÂàÜËá™ÂÆö‰πâÈí±ÂåÖ |
| ‚è≥ ‰∫§ÊòìÁ°ÆËÆ§Ë∂ÖÊó∂ | `provider.waitForTransaction()` Ê∞∏‰∏çËøîÂõû | OKX„ÄÅRabby |
| üîÑ `eth_call` Ë∂ÖÊó∂ | ËØªÂèñÂêàÁ∫¶Êï∞ÊçÆÂç°‰ΩèÔºà5Áßí+Ôºâ | OKX„ÄÅCoinbase Wallet |
| üî¢ BigInt Ëß£ÊûêÈîôËØØ | Dataset ID = 0ÔºåÂÆûÈôÖÂ∫î‰∏∫Ê≠£Êï¥Êï∞ | ÊâÄÊúâÈí±ÂåÖ |
| üìã Êï∞ÊçÆÊò†Â∞ÑÈîôËØØ | ÂêàÁ∫¶ËøîÂõûÊï∞ÁªÑÔºåÂâçÁ´ØÂ≠óÊÆµÈîô‰Ωç | ‰∏éÈí±ÂåÖÊó†ÂÖ≥Ôºà‰ª£Á†ÅÈÄªËæëÔºâ |

---

### 6.2 ÈóÆÈ¢ò #1ÔºöÈí±ÂåÖÂºπÁ™ó‰∏çÂá∫Áé∞ÔºàOKX WalletÔºâ

#### ÁóáÁä∂

```javascript
// ‚ùå ‰ª£Á†ÅÊâßË°åÂà∞ËøôÈáåÂêéÊó†ÂèçÂ∫îÔºåOKX Èí±ÂåÖ‰∏çÂºπÂá∫
const tx = await contract.uploadDataset(name, description, data, price);
console.log('ËøôË°åÊ∞∏Ëøú‰∏ç‰ºöÊâìÂç∞');
```

- ÂâçÁ´ØÊòæÁ§∫ "Uploading to blockchain..." Ê∞∏‰πÖ loading
- ÊµèËßàÂô®ÊéßÂà∂Âè∞Êó†‰ªª‰ΩïÈîôËØØ
- MetaMask Ê≠£Â∏∏ÂºπÂá∫ÔºåOKX ‰∏çÂºπÂá∫

#### Ê†πÊú¨ÂéüÂõ†

OKX Wallet ÂØπ `contract.methodName()` ÁöÑÂ§ÑÁêÜÊúâ bugÔºö
- **Áº∫Â∞ë `from` Â≠óÊÆµ**ÔºöOKX Ë¶ÅÊ±Ç‰∫§ÊòìÊòéÁ°ÆÊåáÂÆö `from` Âú∞ÂùÄ
- **Gas ‰º∞ÁÆóÂ§±Ë¥•**ÔºöOKX ÁöÑÂÜÖÈÉ® gas ‰º∞ÁÆóÂèØËÉΩÈùôÈªòÂ§±Ë¥•
- **Ethers.js Â∞ÅË£ÖÈóÆÈ¢ò**Ôºö`contract.method()` ‰ΩøÁî®ÁöÑÈ´òÂ±ÇÂ∞ÅË£Ö‰∏çÈÄÇÈÖç OKX

#### ‚úÖ Ëß£ÂÜ≥ÊñπÊ°àÔºö‰ΩøÁî®‰ΩéÂ±Ç API `window.ethereum.request`

```javascript
import { ethers } from 'ethers';

// ‚ùå ÈîôËØØÊñπÂºèÔºàOKX ‰∏çÊîØÊåÅÔºâ
const tx = await contract.uploadDataset(name, description, data, price);

// ‚úÖ Ê≠£Á°ÆÊñπÂºèÔºàOKX ÂÖºÂÆπÔºâ
const signer = await provider.getSigner();
const fromAddress = await signer.getAddress();

// 1. ÊâãÂä®ÁºñÁ†Å‰∫§ÊòìÊï∞ÊçÆ
const data = contract.interface.encodeFunctionData('uploadDataset', [
  name,
  description,
  dataArray,
  priceWei
]);

// 2. ‰ΩøÁî® window.ethereum.request ÂèëÈÄÅ‰∫§ÊòìÔºàÊòæÂºèÊåáÂÆö fromÔºâ
const txHash = await window.ethereum.request({
  method: 'eth_sendTransaction',
  params: [{
    from: fromAddress,    // ‚ö†Ô∏è ÂøÖÈ°ªÊòæÂºèÊåáÂÆö
    to: contract.target,  // ÂêàÁ∫¶Âú∞ÂùÄ
    data: data,           // ÁºñÁ†ÅÂêéÁöÑÂáΩÊï∞Ë∞ÉÁî®
    value: '0x0'          // ‰∫§ÊòìÈáëÈ¢ùÔºàÂ¶ÇÊûúÈúÄË¶ÅÔºâ
  }]
});

console.log('‚úÖ Transaction sent:', txHash);
```

#### ÂÖ≥ÈîÆË¶ÅÁÇπ

1. **ÂøÖÈ°ª‰ΩøÁî® `window.ethereum.request`**Ôºå‰∏çË¶ÅÁî® `contract.method()`
2. **ÂøÖÈ°ªÊòæÂºèÊåáÂÆö `from` Âú∞ÂùÄ**
3. **ÊâãÂä®ÁºñÁ†ÅÂáΩÊï∞Ë∞ÉÁî®Êï∞ÊçÆ**Ôºö`contract.interface.encodeFunctionData()`
4. **ËøîÂõûÂÄºÊòØ `txHash` Â≠óÁ¨¶‰∏≤**Ôºå‰∏çÊòØ‰∫§ÊòìÂØπË±°

---

### 6.3 ÈóÆÈ¢ò #2Ôºö‰∫§ÊòìÁ°ÆËÆ§Ë∂ÖÊó∂ÔºàOKX/RabbyÔºâ

#### ÁóáÁä∂

```javascript
// ‚ùå OKX Èí±ÂåÖ‰∏≠‰∫§ÊòìÂ∑≤Á°ÆËÆ§Ôºå‰ΩÜËøôË°å‰ª£Á†ÅÊ∞∏‰∏çËøîÂõû
const receipt = await provider.waitForTransaction(txHash);
console.log('ËøôË°åÊ∞∏Ëøú‰∏ç‰ºöÊâìÂç∞');
```

- Âå∫ÂùóÈìæÊµèËßàÂô®ÊòæÁ§∫‰∫§ÊòìÂ∑≤Á°ÆËÆ§Ôºà‚úÖ SuccessÔºâ
- ÂâçÁ´Ø‰ªçÁÑ∂ÊòæÁ§∫ "Waiting for confirmation..."
- `provider.waitForTransaction()` Ë∂ÖÊó∂ÊàñÊ∞∏‰πÖÊåÇËµ∑

#### Ê†πÊú¨ÂéüÂõ†

OKX Wallet ÁöÑ `eth_getTransactionReceipt` ÊñπÊ≥ïÂÆûÁé∞ÊúâÈóÆÈ¢òÔºö
- **Âª∂ËøüËøîÂõû**ÔºöÂç≥‰Ωø‰∫§ÊòìÂ∑≤Á°ÆËÆ§Ôºå‰πü‰∏çÁ´ãÂç≥ËøîÂõû receipt
- **CORS ÈôêÂà∂**ÔºöÊüê‰∫õËØ∑Ê±ÇË¢´Èí±ÂåÖÂÜÖÈÉ®Êã¶Êà™
- **ÁºìÂ≠òÈóÆÈ¢ò**ÔºöOKX ÂèØËÉΩÁºìÂ≠òÊóßÁä∂ÊÄÅ

#### ‚úÖ Ëß£ÂÜ≥ÊñπÊ°àÔºö‰ΩøÁî®ÂÖ¨ÂÖ± RPC ËΩÆËØ¢

```javascript
import { ethers } from 'ethers';

// ‚ùå ÈîôËØØÊñπÂºèÔºàOKX ‰∏çÂèØÈù†Ôºâ
const receipt = await provider.waitForTransaction(txHash);

// ‚úÖ Ê≠£Á°ÆÊñπÂºèÔºö‰ΩøÁî®ÂÖ¨ÂÖ± RPC ÊâãÂä®ËΩÆËØ¢
async function waitForTransactionWithPublicRpc(txHash, maxAttempts = 60) {
  // 1. ÂàõÂª∫Áã¨Á´ãÁöÑÂÖ¨ÂÖ± RPC providerÔºà‰∏ç‰æùËµñÈí±ÂåÖÔºâ
  const publicProvider = new ethers.JsonRpcProvider(
    'https://ethereum-sepolia-rpc.publicnode.com'  // ÊàñÂÖ∂‰ªñÂèØÈù†ÁöÑÂÖ¨ÂÖ±ËäÇÁÇπ
  );
  
  // 2. ÊâãÂä®ËΩÆËØ¢‰∫§ÊòìÁä∂ÊÄÅ
  for (let i = 0; i < maxAttempts; i++) {
    try {
      const receipt = await publicProvider.getTransactionReceipt(txHash);
      
      if (receipt && receipt.blockNumber) {
        console.log('‚úÖ Transaction confirmed!');
        return receipt;
      }
    } catch (error) {
      console.error(`‚ö†Ô∏è Polling attempt ${i + 1} failed:`, error);
    }
    
    // ÊØè 2 ÁßíËΩÆËØ¢‰∏ÄÊ¨°
    await new Promise(resolve => setTimeout(resolve, 2000));
  }
  
  throw new Error('Transaction confirmation timeout after 120 seconds');
}

// ‰ΩøÁî®Á§∫‰æã
try {
  const txHash = await window.ethereum.request({ /* ... */ });
  console.log('üì§ Transaction sent:', txHash);
  
  const receipt = await waitForTransactionWithPublicRpc(txHash);
  console.log('‚úÖ Transaction confirmed:', receipt);
} catch (error) {
  console.error('‚ùå Transaction failed:', error);
}
```

#### ÂÖ≥ÈîÆË¶ÅÁÇπ

1. **‰∏ç‰æùËµñÈí±ÂåÖ provider**ÔºåÂàõÂª∫Áã¨Á´ãÁöÑ `JsonRpcProvider`
2. **‰ΩøÁî®ÂÖ¨ÂÖ± RPC**Ôºö`publicnode.com`„ÄÅ`ankr.com`„ÄÅ`infura.io` Á≠â
3. **ÊâãÂä®ËΩÆËØ¢**ÔºöÊØè 2 ÁßíÊü•ËØ¢‰∏ÄÊ¨°ÔºåÊúÄÂ§ö 60 Ê¨°Ôºà2 ÂàÜÈíüÔºâ
4. **Ê£ÄÊü• `receipt.blockNumber`**ÔºöÁ°Æ‰øù‰∏çÊòØ pending Áä∂ÊÄÅ

---

### 6.4 ÈóÆÈ¢ò #3Ôºö`eth_call` Ë∂ÖÊó∂ÔºàËØªÂèñÊï∞ÊçÆÂç°‰ΩèÔºâ

#### ÁóáÁä∂

```javascript
// ‚ùå Ë∞ÉÁî®ÂêàÁ∫¶ËØªÊñπÊ≥ïÊó∂ÔºåOKX Èí±ÂåÖÂç°‰Ωè 5 Áßí+
const dataset = await contract.getDataset(id);  // Ê∞∏‰πÖ loading
const datasets = await contract.getActiveDatasets();  // ÂêåÊ†∑Âç°‰Ωè
```

- Marketplace È°µÈù¢ÊòæÁ§∫ "Loading datasets..." Ê∞∏‰πÖ loading
- Dataset Detail È°µÈù¢Á©∫ÁôΩÊàñ loading
- Êó†ÈîôËØØÊèêÁ§∫ÔºåÂè™ÊòØÂç°‰Ωè

#### Ê†πÊú¨ÂéüÂõ†

OKX Wallet ÁöÑ `eth_call` ÊñπÊ≥ïÔºö
- **ÊÄßËÉΩÈóÆÈ¢ò**ÔºöÂ§ÑÁêÜÈÄüÂ∫¶ÊÖ¢ÔºåÂ∞§ÂÖ∂ÊòØÂ§çÊùÇÊü•ËØ¢
- **Ë∂ÖÊó∂ËÆæÁΩÆÁü≠**ÔºöÂÜÖÈÉ®Ë∂ÖÊó∂Êó∂Èó¥ÂèØËÉΩÂè™Êúâ 3-5 Áßí
- **ÁΩëÁªúÈóÆÈ¢ò**ÔºöOKX ‰ΩøÁî®ÁöÑÂÜÖÈÉ® RPC ËäÇÁÇπÂèØËÉΩ‰∏çÁ®≥ÂÆö

#### ‚úÖ Ëß£ÂÜ≥ÊñπÊ°àÔºöÂØπÊâÄÊúâËØªÊìç‰Ωú‰ΩøÁî®ÂÖ¨ÂÖ± RPC

```javascript
import { ethers } from 'ethers';
import { CONTRACT_ADDRESS, CONTRACT_ABI } from './config';

// ‚ùå ÈîôËØØÊñπÂºèÔºà‰æùËµñÈí±ÂåÖ providerÔºâ
async function loadDatasets() {
  const signer = await provider.getSigner();
  const contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);
  const datasets = await contract.getActiveDatasets();  // ‚ùå ‰ΩøÁî® OKX ÁöÑ eth_call
}

// ‚úÖ Ê≠£Á°ÆÊñπÂºèÔºöÂàÜÁ¶ªËØªÂÜôÊìç‰Ωú
async function loadDatasets() {
  // 1. ËØªÊìç‰ΩúÔºö‰ΩøÁî®ÂÖ¨ÂÖ± RPC
  const publicProvider = new ethers.JsonRpcProvider(
    'https://ethereum-sepolia-rpc.publicnode.com'
  );
  const readContract = new ethers.Contract(
    CONTRACT_ADDRESS,
    CONTRACT_ABI,
    publicProvider  // ‚ö†Ô∏è ‰ΩøÁî®ÂÖ¨ÂÖ± providerÔºå‰∏çÊòØÈí±ÂåÖ provider
  );
  
  // 2. Âø´ÈÄüËØªÂèñÊï∞ÊçÆ
  const datasetIds = await readContract.getActiveDatasets();
  
  // 3. ÈÄê‰∏™Ëé∑ÂèñËØ¶ÁªÜ‰ø°ÊÅØ
  const datasets = [];
  for (const id of datasetIds) {
    const result = await readContract.getDataset(id);
    datasets.push({
      id: Number(result[0].toString()),
      owner: result[1],
      name: result[2],
      description: result[3],
      // ... ÂÖ∂‰ªñÂ≠óÊÆµ
    });
  }
  
  return datasets;
}

// ÂÜôÊìç‰ΩúÔºö‰ªçÁÑ∂‰ΩøÁî®Èí±ÂåÖ provider
async function uploadDataset(name, description, data, price) {
  const signer = await provider.getSigner();
  const writeContract = new ethers.Contract(
    CONTRACT_ADDRESS,
    CONTRACT_ABI,
    signer  // ‚ö†Ô∏è ÂÜôÊìç‰ΩúÂøÖÈ°ªÁî®Èí±ÂåÖ signer
  );
  
  // ‰ΩøÁî®ÂâçÈù¢ÊèêÂà∞ÁöÑ window.ethereum.request ÊñπÊ≥ï
  // ...
}
```

#### ÂÖ≥ÈîÆË¶ÅÁÇπ

1. **ËØªÂÜôÂàÜÁ¶ª**ÔºöËØªÊìç‰ΩúÁî®ÂÖ¨ÂÖ± RPCÔºåÂÜôÊìç‰ΩúÁî®Èí±ÂåÖ signer
2. **ÂàõÂª∫Áã¨Á´ã contract ÂÆû‰æã**Ôºö`readContract` vs `writeContract`
3. **ÈÄâÊã©ÂèØÈù†ÁöÑÂÖ¨ÂÖ± RPC**Ôºö
   - ‚úÖ `https://ethereum-sepolia-rpc.publicnode.com`
   - ‚úÖ `https://rpc.ankr.com/eth_sepolia`
   - ‚úÖ `https://eth-sepolia.g.alchemy.com/v2/YOUR_KEY`
4. **‰∏çÂΩ±ÂìçÂÜôÊìç‰Ωú**ÔºöÂÜôÊìç‰Ωú‰ªçÈúÄÈí±ÂåÖÊéàÊùÉ

---

### 6.5 ÈóÆÈ¢ò #4ÔºöBigInt Ëß£ÊûêÈîôËØØÔºàDataset ID = 0Ôºâ

#### ÁóáÁä∂

```javascript
// ÂêàÁ∫¶ËøîÂõû datasetId = 15Ôºå‰ΩÜÂâçÁ´ØËß£Êûê‰∏∫ 0
const parsedLog = contractInterface.parseLog(log);
console.log(parsedLog.args.datasetId);  // ËæìÂá∫Ôºö15n (BigInt)
console.log(Number(parsedLog.args.datasetId));  // ËæìÂá∫Ôºö0 ‚ùå
```

- ‰∏ä‰º†ÊàêÂäüÂêéË∑≥ËΩ¨Âà∞ `/dataset/0`ÔºàÈîôËØØÔºâ
- Â∫îËØ•Ë∑≥ËΩ¨Âà∞ `/dataset/15`ÔºàÊ≠£Á°ÆÔºâ
- `getDataset(0)` Ë∞ÉÁî®Â§±Ë¥•ÔºåËøîÂõûÁ©∫Êï∞ÊçÆ

#### Ê†πÊú¨ÂéüÂõ†

Ethers.js v6 ‰∏≠Ôºå**ÊâÄÊúâ `uint256` Á±ªÂûãÈÉΩËøîÂõû `BigInt`**Ôºö
- Áõ¥Êé•‰ΩøÁî® `Number(bigIntValue)` ÂèØËÉΩ‰∏¢Â§±Á≤æÂ∫¶
- `BigInt` ‰∏é React Ë∑ØÁî±ÁöÑ URL ÂèÇÊï∞‰∏çÂÖºÂÆπ
- ÈúÄË¶ÅÊòæÂºèËΩ¨Êç¢‰∏∫Â≠óÁ¨¶‰∏≤ÂÜçËΩ¨Êï∞Â≠ó

#### ‚úÖ Ëß£ÂÜ≥ÊñπÊ°àÔºöÂÆâÂÖ®ÁöÑ BigInt ËΩ¨Êç¢

```javascript
// ‚ùå ÈîôËØØÊñπÂºèÔºàÂèØËÉΩ‰∏¢Â§±Êï∞ÊçÆÔºâ
const id = Number(parsedLog.args.datasetId);  // ÂèØËÉΩËøîÂõû 0

// ‚úÖ Ê≠£Á°ÆÊñπÂºèÔºöÂÖàËΩ¨Â≠óÁ¨¶‰∏≤ÔºåÂÜçËΩ¨Êï∞Â≠ó
const rawId = parsedLog.args.datasetId;
console.log('Raw ID type:', typeof rawId);           // bigint
console.log('Raw ID value:', rawId.toString());      // "15"

const id = Number(rawId.toString());                 // 15 ‚úÖ
console.log('Converted ID:', id, typeof id);         // 15 'number'
```

#### ÂÆåÊï¥‰∫ã‰ª∂Ëß£ÊûêÁ§∫‰æã

```javascript
async function parseDatasetCreatedEvent(txReceipt) {
  const contractInterface = new ethers.Interface(CONTRACT_ABI);
  
  for (const log of txReceipt.logs) {
    try {
      const parsedLog = contractInterface.parseLog({
        topics: log.topics,
        data: log.data
      });
      
      if (parsedLog.name === 'DatasetCreated') {
        // ‚ö†Ô∏è ÂÖ≥ÈîÆÔºöÊ≠£Á°ÆÂ§ÑÁêÜ BigInt
        const datasetId = Number(parsedLog.args.datasetId.toString());
        const owner = parsedLog.args.owner;
        const name = parsedLog.args.name;
        const pricePerQuery = parsedLog.args.pricePerQuery;  // ‰øùÊåÅ BigIntÔºàÁî®‰∫é‰ª∑Ê†ºËÆ°ÁÆóÔºâ
        
        console.log('‚úÖ Dataset Created:', {
          datasetId,      // number
          owner,          // string
          name,           // string
          pricePerQuery   // BigInt
        });
        
        return { datasetId, owner, name, pricePerQuery };
      }
    } catch (e) {
      // Ë∑≥Ëøá‰∏çÁõ∏ÂÖ≥ÁöÑÊó•Âøó
    }
  }
  
  throw new Error('DatasetCreated event not found');
}
```

#### ÂÖ≥ÈîÆË¶ÅÁÇπ

1. **ÂÖà `.toString()` ÂÜç `Number()`**ÔºöÈÅøÂÖçÁ≤æÂ∫¶‰∏¢Â§±
2. **‰ª∑Ê†ºÂ≠óÊÆµ‰øùÊåÅ BigInt**ÔºöÁî®‰∫é `ethers.formatEther()` Á≠âÂáΩÊï∞
3. **ID Â≠óÊÆµËΩ¨‰∏∫ Number**ÔºöÁî®‰∫é URL Ë∑ØÁî±Âíå UI ÊòæÁ§∫
4. **Ê∑ªÂä†Êó•Âøó**ÔºöÊâìÂç∞‰∏≠Èó¥ÂÄºÔºåÊñπ‰æøË∞ÉËØï

---

### 6.6 ÈóÆÈ¢ò #5ÔºöÂêàÁ∫¶Êï∞ÊçÆÊò†Â∞ÑÈ°∫Â∫èÈîôËØØ

#### ÁóáÁä∂

```javascript
// ‚ùå È°µÈù¢ÊòæÁ§∫ÈîôËØØÁöÑÊï∞ÊçÆ
dataset.name       // ÊòæÁ§∫ÁöÑÊòØÊâÄÊúâËÄÖÂú∞ÂùÄ "0x1234..."
dataset.description // ÊòæÁ§∫ÁöÑÊòØÊï∞ÊçÆÈõÜÂêçÁß∞ "Sales Data 2024"
dataset.owner      // ÊòæÁ§∫ÁöÑÊòØÊï∞Â≠ó "15"
```

- Marketplace Âç°Áâá‰ø°ÊÅØÊ∑∑‰π±
- Dataset Detail È°µÈù¢Â¥©Ê∫ÉÔºö`Cannot read properties of undefined (reading 'isImported')`
- ÊòéÊòéÊúâÊï∞ÊçÆÔºå‰ΩÜÂ≠óÊÆµÂÖ®ÈÉ®Èîô‰Ωç

#### Ê†πÊú¨ÂéüÂõ†

ÂêàÁ∫¶ËøîÂõûÁöÑ**ÂÖÉÁªÑÈ°∫Â∫è**‰∏éÂâçÁ´Ø**ÂØπË±°Êò†Â∞Ñ**‰∏ç‰∏ÄËá¥Ôºö

```solidity
// ÂêàÁ∫¶ÂÆö‰πâ
function getDataset(uint256 datasetId) external view returns (
    uint256 id,           // [0]
    address owner,        // [1]
    string memory name,   // [2]
    string memory description,  // [3]
    uint256 dataSize,     // [4]
    uint256 pricePerQuery,      // [5]
    uint256 totalQueries,       // [6]
    uint256 totalRevenue,       // [7]
    uint256 createdAt,          // [8]
    bool active                 // [9]
) { ... }
```

```javascript
// ‚ùå ÈîôËØØÁöÑÂâçÁ´ØÊò†Â∞ÑÔºàÁº∫Â∞ë id Â≠óÊÆµÔºâ
const datasetObj = {
  id: Number(datasetId),  // ‚ùå ‰ΩøÁî®ÂèÇÊï∞Ôºå‰∏çÊòØËøîÂõûÂÄº
  owner: result[0],       // ‚ùå result[0] ÂÆûÈôÖÊòØ idÔºå‰∏çÊòØ owner
  name: result[1],        // ‚ùå result[1] ÊòØ ownerÔºå‰∏çÊòØ name
  description: result[2], // ‚ùå ‰ª•Ê≠§Á±ªÊé®ÔºåÂÖ®ÈÉ®Èîô‰Ωç
  // ...
};
```

#### ‚úÖ Ëß£ÂÜ≥ÊñπÊ°àÔºö‰∏•Ê†ºÊåâÂêàÁ∫¶ËøîÂõûÈ°∫Â∫èÊò†Â∞Ñ

```javascript
// ‚úÖ Ê≠£Á°ÆÁöÑÊò†Â∞ÑÔºà‰∏éÂêàÁ∫¶ËøîÂõûÈ°∫Â∫èÂÆåÂÖ®‰∏ÄËá¥Ôºâ
async function getDataset(datasetId) {
  const publicProvider = new ethers.JsonRpcProvider('...');
  const contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, publicProvider);
  
  const result = await contract.getDataset(datasetId);
  
  // ‚ö†Ô∏è ÈáçË¶ÅÔºöÊåâÁÖßÂêàÁ∫¶ËøîÂõûÁöÑÈ°∫Â∫è [0] ~ [9] Êò†Â∞Ñ
  const datasetObj = {
    id: Number(result[0].toString()),           // ‚úÖ uint256 id
    owner: result[1],                           // ‚úÖ address owner
    name: result[2],                            // ‚úÖ string name
    description: result[3],                     // ‚úÖ string description
    dataSize: Number(result[4].toString()),     // ‚úÖ uint256 dataSize
    pricePerQuery: result[5],                   // ‚úÖ uint256 (‰øùÊåÅ BigInt)
    totalQueries: Number(result[6].toString()), // ‚úÖ uint256 totalQueries
    totalRevenue: result[7],                    // ‚úÖ uint256 (‰øùÊåÅ BigInt)
    createdAt: Number(result[8].toString()),    // ‚úÖ uint256 createdAt
    active: result[9]                           // ‚úÖ bool active
  };
  
  return datasetObj;
}
```

#### ÊúÄ‰Ω≥ÂÆûË∑µÔºöÊâπÈáèÂä†ËΩΩÊó∂ÁöÑÁªü‰∏ÄÊò†Â∞Ñ

```javascript
// Marketplace È°µÈù¢ÔºöÊâπÈáèÂä†ËΩΩÊï∞ÊçÆÈõÜ
async function loadAllDatasets() {
  const publicProvider = new ethers.JsonRpcProvider('...');
  const contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, publicProvider);
  
  // 1. Ëé∑ÂèñÊâÄÊúâÊ¥ªË∑ÉÊï∞ÊçÆÈõÜ ID
  const datasetIds = await contract.getActiveDatasets();  // ËøîÂõû uint256[]
  
  // 2. ÈÄê‰∏™Ëé∑ÂèñÂÆåÊï¥‰ø°ÊÅØ
  const datasets = [];
  for (const id of datasetIds) {
    const idNumber = Number(id.toString());  // ‚ö†Ô∏è BigInt ËΩ¨Êç¢
    const result = await contract.getDataset(idNumber);
    
    // ‚ö†Ô∏è ‰ΩøÁî®Áªü‰∏ÄÁöÑÊò†Â∞ÑÂáΩÊï∞ÔºåÁ°Æ‰øù‰∏ÄËá¥ÊÄß
    const dataset = mapContractResultToDataset(result);
    datasets.push(dataset);
  }
  
  return datasets;
}

// Áªü‰∏ÄÁöÑÊò†Â∞ÑÂáΩÊï∞ÔºàÈÅøÂÖçÈáçÂ§ç‰ª£Á†ÅÔºâ
function mapContractResultToDataset(result) {
  return {
    id: Number(result[0].toString()),
    owner: result[1],
    name: result[2],
    description: result[3],
    dataSize: Number(result[4].toString()),
    pricePerQuery: result[5],
    totalQueries: Number(result[6].toString()),
    totalRevenue: result[7],
    createdAt: Number(result[8].toString()),
    active: result[9]
  };
}
```

#### ÂÖ≥ÈîÆË¶ÅÁÇπ

1. **‰∏•Ê†ºÊåâÈ°∫Â∫è**ÔºöÂêàÁ∫¶ËøîÂõû `[0] ~ [9]`ÔºåÂâçÁ´ØÂøÖÈ°ª‰∏•Ê†ºÂØπÂ∫î
2. **Áªü‰∏ÄÊò†Â∞ÑÂáΩÊï∞**ÔºöÈÅøÂÖç Marketplace Âíå Detail È°µÈù¢Êò†Â∞Ñ‰∏ç‰∏ÄËá¥
3. **BigInt Â§ÑÁêÜ**Ôºö
   - ËΩ¨ NumberÔºö`id`, `dataSize`, `totalQueries`, `createdAt`
   - ‰øùÊåÅ BigIntÔºö`pricePerQuery`, `totalRevenue`ÔºàÁî®‰∫é‰ª∑Ê†ºËÆ°ÁÆóÔºâ
4. **ÊµãËØïÈ™åËØÅ**Ôºö`console.log` ÊâìÂç∞ `result` Âíå `datasetObj`ÔºåÁ°Æ‰øùÂ≠óÊÆµÊ≠£Á°Æ

---

### 6.7 ÂÆåÊï¥Ëß£ÂÜ≥ÊñπÊ°àÊû∂ÊûÑ

#### ÂâçÁ´ØÊû∂ÊûÑÔºöËØªÂÜôÂàÜÁ¶ª + ÂÖ¨ÂÖ± RPC

```javascript
// config.js - ÈÖçÁΩÆÊñá‰ª∂
export const CONTRACT_ADDRESS = '0x9e138064d8B68E027c8Fe0C4da03325C91cecaeb';
export const CONTRACT_ABI = [ /* ... */ ];
export const PUBLIC_RPC_URL = 'https://ethereum-sepolia-rpc.publicnode.com';

// useContract.js - Ëá™ÂÆö‰πâ Hook
import { ethers } from 'ethers';
import { CONTRACT_ADDRESS, CONTRACT_ABI, PUBLIC_RPC_URL } from './config';

export function useContract() {
  const [walletProvider, setWalletProvider] = useState(null);
  const [publicProvider, setPublicProvider] = useState(null);
  const [account, setAccount] = useState(null);
  
  useEffect(() => {
    // ÂàùÂßãÂåñÂÖ¨ÂÖ± RPC providerÔºàËØªÊìç‰ΩúÔºâ
    const pubProvider = new ethers.JsonRpcProvider(PUBLIC_RPC_URL);
    setPublicProvider(pubProvider);
    
    // ÂàùÂßãÂåñÈí±ÂåÖ providerÔºàÂÜôÊìç‰ΩúÔºâ
    if (window.ethereum) {
      const walletProv = new ethers.BrowserProvider(window.ethereum);
      setWalletProvider(walletProv);
    }
  }, []);
  
  // ËØªÊìç‰ΩúÔºö‰ΩøÁî®ÂÖ¨ÂÖ± RPC
  const readContract = useMemo(() => {
    if (!publicProvider) return null;
    return new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, publicProvider);
  }, [publicProvider]);
  
  // ÂÜôÊìç‰ΩúÔºö‰ΩøÁî®Èí±ÂåÖ signer
  const getWriteContract = async () => {
    if (!walletProvider) throw new Error('Wallet not connected');
    const signer = await walletProvider.getSigner();
    return new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);
  };
  
  // Â∞ÅË£Ö‰∏ä‰º†ÊñπÊ≥ï
  const uploadDataset = async (name, description, data, price) => {
    const signer = await walletProvider.getSigner();
    const fromAddress = await signer.getAddress();
    const contract = await getWriteContract();
    
    // 1. ÁºñÁ†Å‰∫§ÊòìÊï∞ÊçÆ
    const txData = contract.interface.encodeFunctionData('uploadDataset', [
      name, description, data, ethers.parseEther(price)
    ]);
    
    // 2. ‰ΩøÁî® window.ethereum.request ÂèëÈÄÅÔºàOKX ÂÖºÂÆπÔºâ
    const txHash = await window.ethereum.request({
      method: 'eth_sendTransaction',
      params: [{
        from: fromAddress,
        to: CONTRACT_ADDRESS,
        data: txData,
        value: '0x0'
      }]
    });
    
    // 3. ‰ΩøÁî®ÂÖ¨ÂÖ± RPC Á≠âÂæÖÁ°ÆËÆ§
    const receipt = await waitForTransactionWithPublicRpc(txHash, publicProvider);
    
    // 4. Ëß£Êûê‰∫ã‰ª∂
    const event = parseDatasetCreatedEvent(receipt);
    
    return event;
  };
  
  // Â∞ÅË£ÖËØªÂèñÊñπÊ≥ï
  const getDataset = async (id) => {
    if (!readContract) throw new Error('Read contract not initialized');
    const result = await readContract.getDataset(id);
    return mapContractResultToDataset(result);
  };
  
  const getActiveDatasets = async () => {
    if (!readContract) throw new Error('Read contract not initialized');
    const ids = await readContract.getActiveDatasets();
    
    const datasets = [];
    for (const id of ids) {
      const dataset = await getDataset(Number(id.toString()));
      datasets.push(dataset);
    }
    
    return datasets;
  };
  
  return {
    readContract,
    getWriteContract,
    uploadDataset,
    getDataset,
    getActiveDatasets,
    account
  };
}

// ËæÖÂä©ÂáΩÊï∞
async function waitForTransactionWithPublicRpc(txHash, provider, maxAttempts = 60) {
  for (let i = 0; i < maxAttempts; i++) {
    try {
      const receipt = await provider.getTransactionReceipt(txHash);
      if (receipt && receipt.blockNumber) return receipt;
    } catch (e) {
      console.error(`Polling attempt ${i + 1} failed:`, e);
    }
    await new Promise(r => setTimeout(r, 2000));
  }
  throw new Error('Transaction confirmation timeout');
}

function parseDatasetCreatedEvent(receipt) {
  const iface = new ethers.Interface(CONTRACT_ABI);
  for (const log of receipt.logs) {
    try {
      const parsed = iface.parseLog({ topics: log.topics, data: log.data });
      if (parsed.name === 'DatasetCreated') {
        return {
          datasetId: Number(parsed.args.datasetId.toString()),
          owner: parsed.args.owner,
          name: parsed.args.name,
          pricePerQuery: parsed.args.pricePerQuery
        };
      }
    } catch (e) {}
  }
  throw new Error('Event not found');
}

function mapContractResultToDataset(result) {
  return {
    id: Number(result[0].toString()),
    owner: result[1],
    name: result[2],
    description: result[3],
    dataSize: Number(result[4].toString()),
    pricePerQuery: result[5],
    totalQueries: Number(result[6].toString()),
    totalRevenue: result[7],
    createdAt: Number(result[8].toString()),
    active: result[9]
  };
}
```

#### ÂÖ≥ÈîÆÊû∂ÊûÑË¶ÅÁÇπ

1. **Âèå Provider Ê®°Âºè**Ôºö
   - `publicProvider`ÔºöÁî®‰∫éÊâÄÊúâËØªÊìç‰ΩúÔºà`eth_call`Ôºâ
   - `walletProvider`ÔºöÁî®‰∫éÊâÄÊúâÂÜôÊìç‰ΩúÔºà`eth_sendTransaction`Ôºâ

2. **Âèå Contract ÂÆû‰æã**Ôºö
   - `readContract = new Contract(..., publicProvider)`
   - `writeContract = new Contract(..., signer)`

3. **OKX ÂÖºÂÆπÊñπÊ≥ï**Ôºö
   - ‰ΩøÁî® `window.ethereum.request` + ÊòæÂºè `from` Âú∞ÂùÄ
   - ‰ΩøÁî® `contract.interface.encodeFunctionData` ÊâãÂä®ÁºñÁ†Å

4. **ÂÖ¨ÂÖ± RPC ËΩÆËØ¢**Ôºö
   - ‰∏ç‰æùËµñÈí±ÂåÖÁöÑ `waitForTransaction`
   - ÊØè 2 ÁßíÊü•ËØ¢‰∏ÄÊ¨°ÔºåÊúÄÂ§ö 60 Ê¨°Ôºà2 ÂàÜÈíüÔºâ

5. **Áªü‰∏ÄÊï∞ÊçÆÊò†Â∞Ñ**Ôºö
   - Âçï‰∏Ä `mapContractResultToDataset` ÂáΩÊï∞
   - Á°Æ‰øùÊâÄÊúâÈ°µÈù¢‰ΩøÁî®Áõ∏ÂêåÁöÑÊò†Â∞ÑÈÄªËæë

---

### 6.8 ÈóÆÈ¢òÊéíÊü•Ê∏ÖÂçï

ÂΩìÈÅáÂà∞Èí±ÂåÖÁõ∏ÂÖ≥ÈóÆÈ¢òÊó∂ÔºåÊåâ‰ª•‰∏ãÈ°∫Â∫èÊéíÊü•Ôºö

#### ‚úÖ ÊéíÊü•Ê∏ÖÂçï

| # | Ê£ÄÊü•È°π | ÂëΩ‰ª§/‰ª£Á†Å | È¢ÑÊúüÁªìÊûú |
|---|-------|----------|---------|
| 1 | Èí±ÂåÖÊòØÂê¶Â∑≤ËøûÊé• | `await window.ethereum.request({ method: 'eth_accounts' })` | ËøîÂõûË¥¶Êà∑Êï∞ÁªÑ |
| 2 | Èí±ÂåÖÁΩëÁªúÊòØÂê¶Ê≠£Á°Æ | `await window.ethereum.request({ method: 'eth_chainId' })` | `0xaa36a7` (Sepolia) |
| 3 | Èí±ÂåÖÁ±ªÂûã | `window.ethereum.isMetaMask` / `window.ethereum.isOkxWallet` | ËØÜÂà´Èí±ÂåÖ |
| 4 | ÂÖ¨ÂÖ± RPC ÊòØÂê¶ÂèØÁî® | `await publicProvider.getBlockNumber()` | ËøîÂõûÊúÄÊñ∞Âå∫ÂùóÂè∑ |
| 5 | ÂêàÁ∫¶Âú∞ÂùÄÊòØÂê¶Ê≠£Á°Æ | `console.log(CONTRACT_ADDRESS)` | ‰∏éÈÉ®ÁΩ≤Âú∞ÂùÄ‰∏ÄËá¥ |
| 6 | ÂêàÁ∫¶ÊòØÂê¶Â∑≤ÈÉ®ÁΩ≤ | `await publicProvider.getCode(CONTRACT_ADDRESS)` | ËøîÂõûÂ≠óËäÇÁ†ÅÔºàÈùû '0x'Ôºâ |
| 7 | ‰∫§ÊòìÊòØÂê¶‰∏äÈìæ | `await publicProvider.getTransactionReceipt(txHash)` | ËøîÂõû receipt ÂØπË±° |
| 8 | ‰∫ã‰ª∂ÊòØÂê¶Ê≠£Á°ÆËß¶Âèë | Ê£ÄÊü• `receipt.logs` Êï∞ÁªÑ | ÂåÖÂê´ÁõÆÊ†á‰∫ã‰ª∂ |

#### üîç Ë∞ÉËØïÊäÄÂ∑ß

```javascript
// 1. Ê£ÄÊü•Èí±ÂåÖÁéØÂ¢É
console.log('üîç Wallet Check:', {
  hasEthereum: !!window.ethereum,
  isMetaMask: window.ethereum?.isMetaMask,
  isOkxWallet: window.ethereum?.isOkxWallet,
  selectedAddress: window.ethereum?.selectedAddress
});

// 2. ÁõëÊéß‰∫§ÊòìÂÖ®ÊµÅÁ®ã
async function debugTransaction() {
  try {
    console.log('1Ô∏è‚É£ Encoding transaction data...');
    const data = contract.interface.encodeFunctionData('uploadDataset', [...]);
    console.log('   Data:', data);
    
    console.log('2Ô∏è‚É£ Sending transaction...');
    const txHash = await window.ethereum.request({ /* ... */ });
    console.log('   TxHash:', txHash);
    
    console.log('3Ô∏è‚É£ Waiting for confirmation...');
    const receipt = await waitForTransactionWithPublicRpc(txHash);
    console.log('   Receipt:', receipt);
    
    console.log('4Ô∏è‚É£ Parsing events...');
    const event = parseDatasetCreatedEvent(receipt);
    console.log('   Event:', event);
    
    console.log('‚úÖ Complete!');
    return event;
  } catch (error) {
    console.error('‚ùå Failed at step:', error);
    throw error;
  }
}

// 3. ÊµãËØïÂÖ¨ÂÖ± RPC ËøûÊé•
async function testPublicRpc() {
  const urls = [
    'https://ethereum-sepolia-rpc.publicnode.com',
    'https://rpc.ankr.com/eth_sepolia',
    'https://eth-sepolia.g.alchemy.com/v2/demo'
  ];
  
  for (const url of urls) {
    try {
      const provider = new ethers.JsonRpcProvider(url);
      const blockNumber = await provider.getBlockNumber();
      console.log(`‚úÖ ${url}: Block ${blockNumber}`);
    } catch (error) {
      console.error(`‚ùå ${url}: Failed`, error.message);
    }
  }
}
```

---

### 6.9 ÊÄªÁªì‰∏éÊúÄ‰Ω≥ÂÆûË∑µ

#### üéØ Ê†∏ÂøÉÂéüÂàô

1. **ËØªÂÜôÂàÜÁ¶ª**ÔºöËØªÊìç‰ΩúÁî®ÂÖ¨ÂÖ± RPCÔºåÂÜôÊìç‰ΩúÁî®Èí±ÂåÖ signer
2. **OKX ÂÖºÂÆπ**Ôºö‰ΩøÁî® `window.ethereum.request` + ÊòæÂºè `from`
3. **ÂÖ¨ÂÖ± RPC ËΩÆËØ¢**Ôºö‰∏ç‰æùËµñÈí±ÂåÖÁöÑ `waitForTransaction`
4. **BigInt ÂÆâÂÖ®ËΩ¨Êç¢**Ôºö`Number(bigint.toString())`
5. **Áªü‰∏ÄÊï∞ÊçÆÊò†Â∞Ñ**ÔºöÂçï‰∏ÄÊò†Â∞ÑÂáΩÊï∞ÔºåÈÅøÂÖç‰∏ç‰∏ÄËá¥

#### ‚úÖ Êé®ËçêÊäÄÊúØÊ†à

```javascript
// package.json
{
  "dependencies": {
    "ethers": "^6.11.1",           // ‚ö†Ô∏è ‰ΩøÁî® v6Ôºå‰∏çÊòØ v5
    "react": "^18.2.0",
    "react-router-dom": "^6.20.0"
  }
}
```

#### üìù ‰ª£Á†ÅÊ£ÄÊü•Ê∏ÖÂçï

- [ ] ÊâÄÊúâËØªÊìç‰Ωú‰ΩøÁî® `publicProvider`
- [ ] ÊâÄÊúâÂÜôÊìç‰Ωú‰ΩøÁî® `window.ethereum.request`
- [ ] ‰∫§ÊòìÁ°ÆËÆ§‰ΩøÁî®ÂÖ¨ÂÖ± RPC ËΩÆËØ¢
- [ ] BigInt Â≠óÊÆµÊ≠£Á°ÆËΩ¨Êç¢Ôºà`toString()` ‚Üí `Number()`Ôºâ
- [ ] ÂêàÁ∫¶Êï∞ÊçÆÊò†Â∞ÑÈ°∫Â∫è‰∏éËøîÂõûÂÄº‰∏ÄËá¥
- [ ] Ê∑ªÂä†ËØ¶ÁªÜÁöÑ `console.log` Áî®‰∫éË∞ÉËØï
- [ ] Â§ÑÁêÜÊâÄÊúâÂèØËÉΩÁöÑÈîôËØØÊÉÖÂÜµÔºàtry-catchÔºâ
- [ ] Áî®Êà∑ÂèãÂ•ΩÁöÑÈîôËØØÊèêÁ§∫Ôºà‰∏çÊòæÁ§∫ÊäÄÊúØÈîôËØØÔºâ

#### üöÄ ÊµãËØïÈ™åËØÅ

```javascript
// ÂÆåÊï¥ÊµãËØïÊµÅÁ®ã
async function testFullWorkflow() {
  console.log('üß™ Starting full workflow test...');
  
  // 1. ÊµãËØïËøûÊé•
  const accounts = await window.ethereum.request({ method: 'eth_accounts' });
  console.log('‚úÖ Connected:', accounts[0]);
  
  // 2. ÊµãËØïËØªÂèñ
  const datasets = await getActiveDatasets();
  console.log('‚úÖ Loaded datasets:', datasets.length);
  
  // 3. ÊµãËØï‰∏ä‰º†
  const result = await uploadDataset('Test Dataset', 'Description', [1,2,3], '0.01');
  console.log('‚úÖ Uploaded dataset:', result.datasetId);
  
  // 4. ÊµãËØïËØ¶ÊÉÖ
  const dataset = await getDataset(result.datasetId);
  console.log('‚úÖ Dataset details:', dataset);
  
  console.log('üéâ All tests passed!');
}
```

---

## 7. Â∏∏ËßÅÈóÆÈ¢òÈÄüÊü•Ë°®

### 7.1 ÂêàÁ∫¶ÈóÆÈ¢ò

| ÈóÆÈ¢ò | ÁóáÁä∂ | Ê£ÄÊü• | ‰øÆÂ§ç |
|------|------|------|------|
| Gas Limit = 0 | ÂõûË∞ÉÂ§±Ë¥• | Êü•Áúã `CALLBACK_GAS_LIMIT` | ËÆæÁΩÆ‰∏∫ 500,000+ |
| Áº∫Â∞ëÊéàÊùÉ | `execution reverted` | Ê£ÄÊü• `TFHE.allow()` | Ê∑ªÂä†ÊéàÊùÉÁªô Gateway |
| Áä∂ÊÄÅÈîôËØØ | ÈáçÂ§çÂ§ÑÁêÜ | Ê£ÄÊü•Áä∂ÊÄÅÊûö‰∏æ | ‰ΩøÁî®Áä∂ÊÄÅÊú∫ÁÆ°ÁêÜ |
| Ë∂ÖÊó∂Êú™Â§ÑÁêÜ | ËµÑÈáëÈîÅÂÆö | Ê£ÄÊü•ËøáÊúüÈÄªËæë | ÂÆûÁé∞ `cancelExpiredGame` |
| Áº∫Â∞ëÊò†Â∞Ñ | Êó†Ê≥ïËøΩË∏™ | Ê£ÄÊü•ËØ∑Ê±ÇÊò†Â∞Ñ | Ê∑ªÂä†ÂèåÂêëÊò†Â∞Ñ |

### 7.2 ÂâçÁ´ØÈóÆÈ¢ò

| ÈóÆÈ¢ò | ÁóáÁä∂ | Ê£ÄÊü• | ‰øÆÂ§ç |
|------|------|------|------|
| Gateway Á¶ªÁ∫ø | Ëß£ÂØÜÂ§±Ë¥• | Ê£ÄÊü• Gateway ÂÅ•Â∫∑ | ÂàáÊç¢Âà∞ Fallback ÂêàÁ∫¶ |
| eth_call Ë∂ÖÊó∂ | 5ÁßíÊó†ÂìçÂ∫î | Ê£ÄÊü• VPN/‰ª£ÁêÜ | ‰ΩøÁî® Fallback RPC |
| ËΩÆËØ¢Ë∂ÖÊó∂ | Ê∞∏‰∏çÂÆåÊàê | Ê£ÄÊü• maxAttempts | Â¢ûÂä†Âà∞ 120 Ê¨° |
| ‰∫ã‰ª∂Êú™ÁõëÂê¨ | Êó†Ê≥ïÊõ¥Êñ∞ | Ê£ÄÊü•‰∫ã‰ª∂ËÆ¢ÈòÖ | Ê∑ªÂä† contract.on() |
| SDK ÁâàÊú¨ÈîôËØØ | ÂØºÂÖ•Â§±Ë¥• | Ê£ÄÊü• package.json | ‰ΩøÁî® `@zama-fhe/relayer-sdk` |

### 7.3 ÁéØÂ¢ÉÈóÆÈ¢ò

| ÈóÆÈ¢ò | ÁóáÁä∂ | Ê£ÄÊü• | ‰øÆÂ§ç |
|------|------|------|------|
| ÊµèËßàÂô®ÁºìÂ≠ò | ‰ª£Á†Å‰∏çÊõ¥Êñ∞ | Êü•ÁúãÁâàÊú¨Âè∑ | Ctrl+F5 Á°¨Âà∑Êñ∞ |
| Node ÁâàÊú¨ | ÁºñËØëÂ§±Ë¥• | `node -v` | ÂçáÁ∫ßÂà∞ 18+ |
| ‰æùËµñÂÜ≤Á™Å | ÂÆâË£ÖÊä•Èîô | package-lock.json | `npm install --legacy-peer-deps` |
| Èí±ÂåÖÊú™ËøûÊé• | Êó†Ê≥ïË∞ÉÁî® | MetaMask Áä∂ÊÄÅ | ÈáçÊñ∞ËøûÊé•Èí±ÂåÖ |

---

## 8. ‰ª£Á†ÅÊ®°ÊùøÂ∫ì

### 8.1 ÂêàÁ∫¶Ê®°Êùø

#### ÂÆåÊï¥ FHE ÂêàÁ∫¶Ê®°Êùø

```solidity
// contracts/TemplateGameFHE.sol
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.24;

import "fhevm/lib/TFHE.sol";
import "fhevm/gateway/GatewayCaller.sol";

contract TemplateGameFHE is GatewayCaller {
    
    enum GameStatus { ACTIVE, PENDING_DECRYPT, COMPLETED, EXPIRED }
    
    struct Game {
        uint256 id;
        address owner;
        euint32 encryptedValue;
        uint32 revealedValue;
        uint256 createdAt;
        uint256 expiresAt;
        GameStatus status;
    }
    
    struct DecryptionRequest {
        uint256 gameId;
        address requester;
        uint256 timestamp;
        uint8 retryCount;
        bool processed;
    }
    
    mapping(uint256 => Game) public games;
    mapping(uint256 => DecryptionRequest) public decryptionRequests;
    mapping(uint256 => uint256) public gameToRequestId;
    
    uint256 public gameCounter;
    uint256 public constant CALLBACK_GAS_LIMIT = 500000;
    uint256 public constant REQUEST_TIMEOUT = 30 minutes;
    uint8 public constant MAX_RETRIES = 3;
    
    event GameCreated(uint256 indexed gameId);
    event DecryptionRequested(uint256 indexed requestId, uint256 indexed gameId);
    event DecryptionCompleted(uint256 indexed requestId, uint32 value);
    
    function createGame(einput encryptedValue, bytes calldata inputProof) 
        external payable returns (uint256) 
    {
        uint256 gameId = gameCounter++;
        euint32 value = TFHE.asEuint32(encryptedValue, inputProof);
        TFHE.allowThis(value);
        
        games[gameId] = Game({
            id: gameId,
            owner: msg.sender,
            encryptedValue: value,
            revealedValue: 0,
            createdAt: block.timestamp,
            expiresAt: block.timestamp + 24 hours,
            status: GameStatus.ACTIVE
        });
        
        emit GameCreated(gameId);
        return gameId;
    }
    
    function requestDecryption(uint256 gameId) external returns (uint256) {
        // ÂèÇËÄÉÁ¨¨2ËäÇÊ†áÂáÜÊµÅÁ®ã
    }
    
    function _handleDecryptionCallback(uint256 requestId, uint32 decrypted) 
        public onlyGateway 
    {
        // ÂèÇËÄÉÁ¨¨2ËäÇÊ†áÂáÜÊµÅÁ®ã
    }
}
```

### 7.2 ÂâçÁ´ØÊ®°Êùø

#### React ÁªÑ‰ª∂Ê®°Êùø

```jsx
// components/GameDetail.jsx
import React, { useState, useEffect } from 'react';
import { useContract } from '../hooks/useContract';
import { useDecryption } from '../hooks/useDecryption';
import DecryptionProgress from './DecryptionProgress';

export default function GameDetail({ gameId }) {
  const { contract } = useContract();
  const [gameInfo, setGameInfo] = useState(null);
  const [showModal, setShowModal] = useState(false);
  
  const {
    requestDecryption,
    status,
    progress,
    error,
    result
  } = useDecryption(contract);
  
  useEffect(() => {
    loadGameInfo();
  }, [gameId]);
  
  const loadGameInfo = async () => {
    const game = await contract.games(gameId);
    setGameInfo({
      id: gameId,
      owner: game.owner,
      status: game.status,
      revealedValue: game.revealedValue
    });
  };
  
  const handleDecrypt = async () => {
    try {
      setShowModal(true);
      await requestDecryption(gameId);
      await loadGameInfo();
    } catch (err) {
      console.error('Ëß£ÂØÜÂ§±Ë¥•:', err);
    }
  };
  
  if (!gameInfo) return <div>Âä†ËΩΩ‰∏≠...</div>;
  
  return (
    <div className="p-6 bg-white rounded-lg shadow">
      <h2 className="text-2xl font-bold mb-4">Ê∏∏Êàè #{gameId}</h2>
      
      {gameInfo.status === 1 && ( // PENDING_DECRYPT
        <button 
          onClick={handleDecrypt}
          className="bg-blue-600 text-white px-4 py-2 rounded"
        >
          Ëß£ÂØÜÁªìÊûú
        </button>
      )}
      
      {gameInfo.status === 2 && ( // COMPLETED
        <div className="mt-4">
          <p className="text-lg">Ëß£ÂØÜÁªìÊûú: {gameInfo.revealedValue}</p>
        </div>
      )}
      
      {showModal && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
          <div className="bg-white p-8 rounded-lg max-w-md w-full">
            <DecryptionProgress 
              status={status}
              progress={progress}
              error={error}
            />
          </div>
        </div>
      )}
    </div>
  );
}
```

---

## 9. ÊµãËØï‰∏éÈÉ®ÁΩ≤Ê∏ÖÂçï

### 9.1 Êú¨Âú∞ÊµãËØïÊ∏ÖÂçï

```bash
# ‚úÖ ÁºñËØëÊµãËØï
cd contracts
npx hardhat compile
# Ê£ÄÊü•: Êó†ÁºñËØëÈîôËØØ

# ‚úÖ ÂçïÂÖÉÊµãËØï
npx hardhat test
# Ê£ÄÊü•: ÊâÄÊúâÊµãËØïÈÄöËøá

# ‚úÖ ÂêØÂä®Êú¨Âú∞ÁΩëÁªú
npx hardhat node
# Ê£ÄÊü•: 8545 Á´ØÂè£Ê≠£Â∏∏

# ‚úÖ ÈÉ®ÁΩ≤ÂêàÁ∫¶
npx hardhat run scripts/deploy_fhe.js --network localhost
# Ê£ÄÊü•: deployment.json Â∑≤ÁîüÊàê

# ‚úÖ ÂêØÂä®ÂâçÁ´Ø
cd frontend
npm install
npm run dev
# Ê£ÄÊü•: http://localhost:3000 ÂèØËÆøÈóÆ

# ‚úÖ ÂäüËÉΩÊµãËØï
# - ÂàõÂª∫Ê∏∏Êàè ‚úÖ
# - Âä†ÂÖ•Ê∏∏Êàè ‚úÖ
# - ËØ∑Ê±ÇËß£ÂØÜ ‚úÖ
# - Êü•ÁúãÁªìÊûú ‚úÖ
```

### 9.2 Sepolia ÈÉ®ÁΩ≤Ê∏ÖÂçï

```bash
# ‚úÖ ÁéØÂ¢ÉÂèòÈáèÈÖçÁΩÆ
export PRIVATE_KEY="your_private_key"
export INFURA_API_KEY="your_infura_key"

# ‚úÖ Ê£ÄÊü•‰ΩôÈ¢ù
npx hardhat run scripts/check_balance.js --network sepolia
# ÈúÄË¶ÅËá≥Â∞ë 0.1 ETH

# ‚úÖ ÈÉ®ÁΩ≤ÂêàÁ∫¶
npx hardhat run scripts/deploy_fhe.js --network sepolia
# ËÆ∞ÂΩïÂêàÁ∫¶Âú∞ÂùÄ

# ‚úÖ È™åËØÅÂêàÁ∫¶
npx hardhat verify --network sepolia DEPLOYED_ADDRESS
# Ê£ÄÊü• Etherscan È™åËØÅÊàêÂäü

# ‚úÖ Êõ¥Êñ∞ÂâçÁ´ØÈÖçÁΩÆ
# ‰øÆÊîπ frontend/src/config/contracts.js
# Êõ¥Êñ∞ÂêàÁ∫¶Âú∞ÂùÄ

# ‚úÖ Á´ØÂà∞Á´ØÊµãËØï
# - ‰ΩøÁî® Sepolia ÊµãËØïÁΩë
# - ÁúüÂÆû Gateway Ëß£ÂØÜ
# - ÂÆåÊï¥ÊµÅÁ®ãÈ™åËØÅ
```

### 9.3 ÂèÇËµõÂâçÊ£ÄÊü•

```markdown
## Êèê‰∫§ÂâçÊ£ÄÊü•Ê∏ÖÂçï

### ‰ª£Á†ÅË¥®Èáè
- [ ] Êó†ÁºñËØëÈîôËØØ
- [ ] Êó† Linter Ë≠¶Âëä
- [ ] ÊâÄÊúâÊµãËØïÈÄöËøá
- [ ] ‰ª£Á†ÅÊúâÂÆåÊï¥Ê≥®Èáä
- [ ] README Â∑≤ÂÆåÂñÑ

### ÂäüËÉΩÂÆåÊï¥ÊÄß
- [ ] FHE Âä†ÂØÜÂäüËÉΩÊ≠£Â∏∏
- [ ] Gateway Ëß£ÂØÜÊµÅÁ®ãÂÆåÊï¥
- [ ] ÈîôËØØÂ§ÑÁêÜÂÆåÂñÑ
- [ ] ÈáçËØïÊú∫Âà∂ÂèØÁî®
- [ ] Ë∂ÖÊó∂Â§ÑÁêÜÊ≠£Á°Æ

### Áî®Êà∑‰ΩìÈ™å
- [ ] ÁïåÈù¢ÁæéËßÇ
- [ ] ‰∫§‰∫íÊµÅÁïÖ
- [ ] Áä∂ÊÄÅÊèêÁ§∫Ê∏ÖÊô∞
- [ ] ËøõÂ∫¶Êù°ÊòæÁ§∫
- [ ] ÈîôËØØÊèêÁ§∫ÂèãÂ•Ω

### ÊñáÊ°£
- [ ] README ÂåÖÂê´ÈÉ®ÁΩ≤Ê≠•È™§
- [ ] ‰ª£Á†ÅÊúâÁ§∫‰æã
- [ ] Êû∂ÊûÑÂõæÊ∏ÖÊô∞
- [ ] Â∑≤Áü•ÈóÆÈ¢òÂ∑≤ËØ¥Êòé

### ÈÉ®ÁΩ≤
- [ ] Â∑≤ÈÉ®ÁΩ≤Âà∞ Sepolia
- [ ] ÂêàÁ∫¶Â∑≤È™åËØÅ
- [ ] ÂâçÁ´ØÂèØËÆøÈóÆ
- [ ] ÊºîÁ§∫ËßÜÈ¢ëÂ∑≤ÂΩïÂà∂
```

---

## 7. React Áä∂ÊÄÅÁÆ°ÁêÜ‰∏éÁªÑ‰ª∂ÁîüÂëΩÂë®ÊúüÈóÆÈ¢ò

### 7.1 ÈóÆÈ¢òÊ¶ÇËø∞ÔºöÊü•ËØ¢ÁªìÊûúÊó†Ê≥ïÊòæÁ§∫

#### ÈóÆÈ¢òÁé∞Ë±°
```
‚úÖ Êü•ËØ¢‰∫§ÊòìÊàêÂäü
‚úÖ Êü•ËØ¢ÁªìÊûúÊàêÂäüËé∑ÂèñÔºàÊéßÂà∂Âè∞ÊòæÁ§∫ result: 10Ôºâ
‚ùå È°µÈù¢‰∏äÊ≤°ÊúâÊòæÁ§∫ÁªìÊûúÔºàÁªøËâ≤ÁªìÊûúÊ°Ü‰∏çÂá∫Áé∞Ôºâ
```

#### ÂÖ∏ÂûãÂú∫ÊôØ
Áî®Êà∑ÊâßË°åÊü•ËØ¢Êìç‰ΩúÂêéÔºö
1. OKX/MetaMask ÂºπÁ™ó ‚Üí Á°ÆËÆ§‰∫§Êòì ‚úÖ
2. ‰∫§ÊòìÁ°ÆËÆ§ÊàêÂäü ‚úÖ
3. Êü•ËØ¢ÁªìÊûúËé∑ÂèñÊàêÂäü ‚úÖ
4. È°µÈù¢ UI ‰∏çÊõ¥Êñ∞ ‚ùå

---

### 7.2 Ê†πÊú¨ÂéüÂõ†ÔºöÁªÑ‰ª∂ÈáçÊñ∞ÊåÇËΩΩÂØºËá¥Áä∂ÊÄÅ‰∏¢Â§±

#### ÈóÆÈ¢òÊµÅÁ®ãÂõæ
```
1. setQueryResult(result) ‚úÖ
   ‚Üì
2. onComplete ÂõûË∞ÉË¢´Ë∞ÉÁî®
   ‚Üì
3. ÂõûË∞ÉÊâßË°å loadData()
   ‚Üì
4. Áà∂ÁªÑ‰ª∂Áä∂ÊÄÅÊõ¥Êñ∞
   ‚Üì
5. Áà∂ÁªÑ‰ª∂ÈáçÊñ∞Ê∏≤Êüì
   ‚Üì
6. Â≠êÁªÑ‰ª∂ÈáçÊñ∞ÊåÇËΩΩÔºàÊñ∞ÂÆû‰æãÔºâ
   ‚Üì
7. Â≠êÁªÑ‰ª∂Êú¨Âú∞Áä∂ÊÄÅ‰∏¢Â§± ‚ùå
   ‚Üì
8. queryResult ÂõûÂà∞ null
```

#### React Ê†∏ÂøÉÊ¶ÇÂøµ

| Ê¶ÇÂøµ | ËØ¥Êòé | Áä∂ÊÄÅ‰øùÁïô |
|------|------|---------|
| **ÈáçÊñ∞Ê∏≤Êüì** | ÁªÑ‰ª∂ÂÆû‰æã‰∏çÂèòÔºå‰ªÖÊõ¥Êñ∞ UI | ‚úÖ ‰øùÁïô |
| **ÈáçÊñ∞ÊåÇËΩΩ** | ÁªÑ‰ª∂ÂÆû‰æãÈîÄÊØÅÂπ∂ÈáçÂª∫ | ‚ùå ‰∏¢Â§± |

**Ëß¶ÂèëÈáçÊñ∞ÊåÇËΩΩÁöÑÊÉÖÂÜµ**Ôºö
- Áà∂ÁªÑ‰ª∂ÈáçÊñ∞Ê∏≤Êüì + Â≠êÁªÑ‰ª∂‰ΩçÁΩÆÊîπÂèò
- Áà∂ÁªÑ‰ª∂ÈáçÊñ∞Ê∏≤Êüì + Â≠êÁªÑ‰ª∂ key ÊîπÂèò
- Êù°‰ª∂Ê∏≤ÊüìÂàáÊç¢Ôºà`{condition && <Component />}`Ôºâ

---

### 7.3 Ë∞ÉËØïÊñπÊ≥ï

#### Ê≠•È™§ 1ÔºöÊ∑ªÂä†Áä∂ÊÄÅËøΩË∏™Êó•Âøó
```javascript
// Âú®Áä∂ÊÄÅËÆæÁΩÆÊó∂
console.log('üîß Setting state with:', value);
setState(value);
console.log('‚úÖ State has been set');

// Âú®ÊØèÊ¨°Ê∏≤ÊüìÊó∂
console.log('üîç Component render, state:', state);
```

#### Ê≠•È™§ 2ÔºöÊ∑ªÂä†ÁîüÂëΩÂë®ÊúüÊó•Âøó
```javascript
useEffect(() => {
  console.log('‚úÖ Component mounted');
  return () => console.log('‚ùå Component unmounted');
}, []);
```

#### Ê≠•È™§ 3ÔºöÊ£ÄÊü•ÂõûË∞ÉÂáΩÊï∞
```javascript
// Ê£ÄÊü•Áà∂ÁªÑ‰ª∂‰º†ÈÄíÁöÑÂõûË∞ÉÊòØÂê¶Ëß¶ÂèëÈáçÊñ∞Ê∏≤Êüì
<ChildComponent 
  onComplete={() => {
    console.log('‚ö†Ô∏è Callback triggered');
    loadData(); // ÂèØËÉΩËß¶ÂèëÁà∂ÁªÑ‰ª∂ÈáçÊñ∞Ê∏≤Êüì
  }}
/>
```

#### ÂÖ≥ÈîÆÊó•ÂøóÊ®°Âºè

**Ê≠£Â∏∏ÊÉÖÂÜµ**ÔºàÁä∂ÊÄÅ‰øùÁïôÔºâÔºö
```
üîß Setting state with: { result: 10 }
‚úÖ State has been set
üîç Component render, state: { result: 10 }  ‚Üê Áä∂ÊÄÅÊúâÂÄº
```

**ÂºÇÂ∏∏ÊÉÖÂÜµ**ÔºàÁªÑ‰ª∂ÈáçÊñ∞ÊåÇËΩΩÔºâÔºö
```
üîß Setting state with: { result: 10 }
‚úÖ State has been set
‚ùå Component unmounted  ‚Üê ÁªÑ‰ª∂Ë¢´ÈîÄÊØÅ
‚úÖ Component mounted    ‚Üê ÁªÑ‰ª∂ÈáçÊñ∞ÂàõÂª∫
üîç Component render, state: null  ‚Üê Áä∂ÊÄÅ‰∏¢Â§±
```

---

### 7.4 Ëß£ÂÜ≥ÊñπÊ°à

#### ÊñπÊ°à AÔºöÁßªÈô§ÂØºËá¥ÈáçÊñ∞ÊåÇËΩΩÁöÑÂõûË∞ÉÔºàÊé®ËçêÔºâ

**ÈóÆÈ¢ò‰ª£Á†Å**Ôºö
```javascript
// DatasetDetail.jsx
<QueryExecutor
  onQueryComplete={() => loadDataset()}  // ‚ùå Ëß¶ÂèëÈáçÊñ∞ÊåÇËΩΩ
/>
```

**‰øÆÂ§ç‰ª£Á†Å**Ôºö
```javascript
// DatasetDetail.jsx
<QueryExecutor
  onQueryComplete={null}  // ‚úÖ ‰∏çËß¶ÂèëÈáçÊñ∞ÊåÇËΩΩ
/>
```

**ÊùÉË°°ÂàÜÊûê**Ôºö
- **ÁßªÈô§ÁöÑ‰ª£‰ª∑**ÔºöÊï∞ÊçÆÈõÜÁªüËÆ°‰ø°ÊÅØÔºàtotalQueries, totalRevenueÔºâ‰∏ç‰ºöÂÆûÊó∂Êõ¥Êñ∞
- **ÁßªÈô§ÁöÑÂ•ΩÂ§Ñ**ÔºöÊü•ËØ¢ÁªìÊûúËÉΩÊ≠£Â∏∏ÊòæÁ§∫
- **ÁªìËÆ∫**ÔºöÁî®Êà∑Êõ¥ÂÖ≥ÂøÉÊü•ËØ¢ÁªìÊûúÔºåËÄå‰∏çÊòØÁªüËÆ°Êï∞Â≠óÁöÑÂÆûÊó∂ÊÄß

#### ÊñπÊ°à BÔºöÂª∂ËøüÂà∑Êñ∞ÔºàÂ¶ÇÊûúÈúÄË¶ÅÊõ¥Êñ∞ÁªüËÆ°Ôºâ

```javascript
<QueryExecutor
  onQueryComplete={(result) => {
    // Âª∂Ëøü 5 ÁßíÂà∑Êñ∞ÔºåÁ°Æ‰øùÁî®Êà∑ÂÖàÁúãÂà∞Êü•ËØ¢ÁªìÊûú
    setTimeout(() => {
      loadDataset();
    }, 5000);
  }}
/>
```

#### ÊñπÊ°à CÔºöÁä∂ÊÄÅÊèêÂçáÂà∞Áà∂ÁªÑ‰ª∂ÔºàÂ§çÊùÇÔºâ

```javascript
// Áà∂ÁªÑ‰ª∂
const [queryResult, setQueryResult] = useState(null);

<QueryExecutor
  queryResult={queryResult}
  onResultChange={setQueryResult}
  onQueryComplete={() => loadDataset()}
/>

// Â≠êÁªÑ‰ª∂‰∏ç‰ΩøÁî®Êú¨Âú∞Áä∂ÊÄÅÔºåËÄåÊòØ‰ΩøÁî® props
```

---

### 7.5 ÊúÄ‰Ω≥ÂÆûË∑µ

#### ÂéüÂàô 1ÔºöÈÅøÂÖç‰∏çÂøÖË¶ÅÁöÑÁªÑ‰ª∂ÈáçÊñ∞ÊåÇËΩΩ

**Ê£ÄÊü•Ê∏ÖÂçï**Ôºö
- ‚ùå ÂõûË∞ÉÂáΩÊï∞ÊòØÂê¶Ëß¶ÂèëÁà∂ÁªÑ‰ª∂Áä∂ÊÄÅÊõ¥Êñ∞Ôºü
- ‚ùå Áà∂ÁªÑ‰ª∂ÊòØÂê¶È¢ëÁπÅÈáçÊñ∞Ê∏≤ÊüìÔºü
- ‚ùå Â≠êÁªÑ‰ª∂ key ÊòØÂê¶È¢ëÁπÅÂèòÂåñÔºü

**Á§∫‰æã**Ôºö
```javascript
// ‚ùå ‰∏çÂ•ΩÁöÑÂÅöÊ≥ï
<ChildComponent 
  key={Math.random()}  // ÊØèÊ¨°Ê∏≤ÊüìÈÉΩÂèòÂåñ
  onComplete={() => setParentState(newValue)}
/>

// ‚úÖ Â•ΩÁöÑÂÅöÊ≥ï
<ChildComponent 
  key={item.id}  // Á®≥ÂÆöÁöÑ key
  onComplete={onCompleteCallback}
/>
```

#### ÂéüÂàô 2ÔºöÂêàÁêÜÈÄâÊã©Áä∂ÊÄÅÁÆ°ÁêÜÊñπÊ°à

| ÊñπÊ°à | ÈÄÇÁî®Âú∫ÊôØ | ‰ºòÁÇπ | Áº∫ÁÇπ |
|------|---------|------|------|
| **Êú¨Âú∞Áä∂ÊÄÅ** | UI ‰∏¥Êó∂Áä∂ÊÄÅ | ÁÆÄÂçïÁõ¥Êé• | ÁªÑ‰ª∂ÈáçÊñ∞ÊåÇËΩΩÊó∂‰∏¢Â§± |
| **ÊèêÂçáÁä∂ÊÄÅ** | Â§öÁªÑ‰ª∂ÂÖ±‰∫´ | Áä∂ÊÄÅÁ®≥ÂÆö | Props ‰º†ÈÄíÈìæÂèòÈïø |
| **ÂÖ®Â±ÄÁä∂ÊÄÅ** | Ë∑®È°µÈù¢Êï∞ÊçÆ | ÂÆåÂÖ®Ëß£ËÄ¶ | Â¢ûÂä†Â§çÊùÇÂ∫¶ |

**Êú¨È°πÁõÆÈÄâÊã©**ÔºöÊú¨Âú∞Áä∂ÊÄÅ + ÁßªÈô§‰∏çÂøÖË¶ÅÁöÑÂõûË∞É

#### ÂéüÂàô 3Ôºö‰ΩøÁî® React.memo Èò≤Ê≠¢‰∏çÂøÖË¶ÅÁöÑÈáçÊñ∞Ê∏≤Êüì

```javascript
const QueryExecutor = React.memo(({ dataset, contract }) => {
  // ...
}, (prevProps, nextProps) => {
  // Ëá™ÂÆö‰πâÊØîËæÉÈÄªËæë
  return prevProps.dataset.id === nextProps.dataset.id;
});
```

**Ê≥®ÊÑè**Ôºö
- `React.memo` Âè™Èò≤Ê≠¢ÈáçÊñ∞Ê∏≤ÊüìÔºå‰∏çÈò≤Ê≠¢ÈáçÊñ∞ÊåÇËΩΩ
- Â¶ÇÊûúÁà∂ÁªÑ‰ª∂ÁªìÊûÑÂèòÂåñÔºåÂ≠êÁªÑ‰ª∂‰ªç‰ºöÈáçÊñ∞ÊåÇËΩΩ

---

### 7.6 ÂÆåÊï¥Á§∫‰æã

#### ÈóÆÈ¢ò‰ª£Á†ÅÔºàÁä∂ÊÄÅ‰∏¢Â§±Ôºâ

```javascript
// DatasetDetail.jsx
export default function DatasetDetail({ contract, account }) {
  const [dataset, setDataset] = useState(null);
  
  const loadDataset = async () => {
    const data = await contract.getDataset(id);
    setDataset(data);  // ‚ö†Ô∏è Ëß¶ÂèëÈáçÊñ∞Ê∏≤Êüì
  };
  
  return (
    <div>
      <DatasetInfo dataset={dataset} />
      
      <QueryExecutor
        dataset={dataset}
        contract={contract}
        onQueryComplete={() => loadDataset()}  // ‚ùå Ëß¶ÂèëÈáçÊñ∞ÊåÇËΩΩ
      />
    </div>
  );
}

// QueryExecutor.jsx
export default function QueryExecutor({ dataset, contract, onQueryComplete }) {
  const [queryResult, setQueryResult] = useState(null);
  
  const handleExecute = async () => {
    const result = await executeQuery();
    setQueryResult(result);  // ‚úÖ ËÆæÁΩÆÁä∂ÊÄÅ
    
    if (onQueryComplete) {
      onQueryComplete(result);  // ‚ö†Ô∏è Ëß¶ÂèëÁà∂ÁªÑ‰ª∂Âà∑Êñ∞ ‚Üí Êú¨ÁªÑ‰ª∂ÈáçÊñ∞ÊåÇËΩΩ ‚Üí Áä∂ÊÄÅ‰∏¢Â§±
    }
  };
  
  return (
    <div>
      {queryResult && <ResultDisplay result={queryResult} />}
      {/* ‚ùå queryResult Ê∞∏Ëøú‰∏∫ nullÔºåÂõ†‰∏∫ÁªÑ‰ª∂Ë¢´ÈáçÊñ∞ÊåÇËΩΩ */}
    </div>
  );
}
```

#### ‰øÆÂ§ç‰ª£Á†ÅÔºàÁä∂ÊÄÅ‰øùÁïôÔºâ

```javascript
// DatasetDetail.jsx
export default function DatasetDetail({ contract, account }) {
  const [dataset, setDataset] = useState(null);
  
  const loadDataset = async () => {
    const data = await contract.getDataset(id);
    setDataset(data);
  };
  
  return (
    <div>
      <DatasetInfo dataset={dataset} />
      
      <QueryExecutor
        dataset={dataset}
        contract={contract}
        onQueryComplete={null}  // ‚úÖ ‰∏çËß¶ÂèëÈáçÊñ∞ÊåÇËΩΩ
      />
    </div>
  );
}

// QueryExecutor.jsx
export default function QueryExecutor({ dataset, contract, onQueryComplete }) {
  const [queryResult, setQueryResult] = useState(null);
  
  // Ê∑ªÂä†Ë∞ÉËØïÊó•Âøó
  useEffect(() => {
    console.log('‚úÖ QueryExecutor mounted');
    return () => console.log('‚ùå QueryExecutor unmounted');
  }, []);
  
  useEffect(() => {
    console.log('üîç QueryExecutor render, queryResult:', queryResult);
  });
  
  const handleExecute = async () => {
    setQueryResult(null);  // ÈáçÁΩÆ
    
    const result = await executeQuery();
    console.log('üîß Setting queryResult:', result);
    setQueryResult(result);  // ‚úÖ ËÆæÁΩÆÁä∂ÊÄÅ
    console.log('‚úÖ queryResult set');
    
    // ‚úÖ ‰∏çËß¶ÂèëÂØºËá¥ÈáçÊñ∞ÊåÇËΩΩÁöÑÂõûË∞É
    if (onQueryComplete) {
      onQueryComplete(result);
    }
  };
  
  return (
    <div>
      <button onClick={handleExecute}>Execute</button>
      
      {queryResult && (
        <ResultDisplay result={queryResult} />
        // ‚úÖ queryResult ‰ºöÊ≠£Â∏∏ÊòæÁ§∫
      )}
    </div>
  );
}
```

---

### 7.7 Ë∞ÉËØïÊ£ÄÊü•Ê∏ÖÂçï

ÂΩìÈÅáÂà∞"Áä∂ÊÄÅÊõ¥Êñ∞‰∫Ü‰ΩÜ UI Ê≤°ÂèòÂåñ"Êó∂Ôºö

- [ ] **Ê≠•È™§ 1**ÔºöÁ°ÆËÆ§ `setState` ÊòØÂê¶Ë¢´Ë∞ÉÁî®
  ```javascript
  console.log('Before setState:', state);
  setState(newValue);
  console.log('setState called with:', newValue);
  ```

- [ ] **Ê≠•È™§ 2**ÔºöÁ°ÆËÆ§ÁªÑ‰ª∂ÊòØÂê¶ÈáçÊñ∞Ê∏≤Êüì
  ```javascript
  console.log('Component render, state:', state);
  ```

- [ ] **Ê≠•È™§ 3**ÔºöÊ£ÄÊü•ÁªÑ‰ª∂ÊòØÂê¶Ë¢´ÈáçÊñ∞ÊåÇËΩΩ
  ```javascript
  useEffect(() => {
    console.log('Mounted');
    return () => console.log('Unmounted');
  }, []);
  ```

- [ ] **Ê≠•È™§ 4**ÔºöÊ£ÄÊü•Êù°‰ª∂Ê∏≤ÊüìÈÄªËæë
  ```javascript
  console.log('Render condition:', state !== null);
  {state !== null && <Component />}
  ```

- [ ] **Ê≠•È™§ 5**ÔºöÊ£ÄÊü•Áà∂ÁªÑ‰ª∂ÁöÑÂõûË∞É
  ```javascript
  onSomething={() => {
    console.log('Callback triggered');
    // ÊòØÂê¶Ë∞ÉÁî®‰∫Ü setStateÔºü
  }}
  ```

---

### 7.8 ÊÄªÁªì

#### ÂÖ≥ÈîÆË¶ÅÁÇπ
1. ‚úÖ ÁªÑ‰ª∂ÈáçÊñ∞ÊåÇËΩΩ‰ºöÂØºËá¥Êú¨Âú∞Áä∂ÊÄÅ‰∏¢Â§±
2. ‚úÖ Áà∂ÁªÑ‰ª∂ÁöÑÂõûË∞ÉÂèØËÉΩËß¶ÂèëÂ≠êÁªÑ‰ª∂ÈáçÊñ∞ÊåÇËΩΩ
3. ‚úÖ ‰ΩøÁî®Ë∞ÉËØïÊó•ÂøóËøΩË∏™ÁªÑ‰ª∂ÁîüÂëΩÂë®Êúü
4. ‚úÖ ÊùÉË°°ÂÆûÊó∂ÊÄß vs Áî®Êà∑‰ΩìÈ™å

#### ÁªèÈ™åÊïôËÆ≠
- ÁÆÄÂçïÈóÆÈ¢ò‰ºòÂÖà‰ΩøÁî®ÁÆÄÂçïÊñπÊ°àÔºàÊú¨Âú∞Áä∂ÊÄÅÔºâ
- ‰ΩøÁî®Ë∞ÉËØïÊó•ÂøóÂø´ÈÄüÂÆö‰ΩçÈóÆÈ¢ò
- ÁêÜËß£ React ÁöÑÊ∏≤ÊüìÊú∫Âà∂ÔºàÈáçÊñ∞Ê∏≤Êüì vs ÈáçÊñ∞ÊåÇËΩΩÔºâ
- ‰∏çË¶ÅËøáÂ∫¶‰ºòÂåñÔºàÁßªÈô§‰∏çÂøÖË¶ÅÁöÑÂÆûÊó∂Êõ¥Êñ∞Ôºâ

#### Â∫îÁî®Âú∫ÊôØ
Êú¨Ëß£ÂÜ≥ÊñπÊ°àÈÄÇÁî®‰∫éÊâÄÊúâÁ±ª‰ººÂú∫ÊôØÔºö
- Ë°®ÂçïÊèê‰∫§ÂêéÊòæÁ§∫ÁªìÊûú
- ÂºπÁ™ó‰∏≠ÁöÑÊìç‰ΩúÂÆåÊàêÂêéÊòæÁ§∫Áä∂ÊÄÅ
- ÂàóË°®È°πÊìç‰ΩúÂêéÊõ¥Êñ∞ UI
- ‰ªª‰Ωï"Êìç‰ΩúÂÆåÊàêÂêéÊòæÁ§∫ÂèçÈ¶à"ÁöÑÂú∫ÊôØ

---

## 8. Zama Developer Program ÂèÇËµõÊåáÂçó

### 8.1 ÊØîËµõÊ¶ÇÂÜµ

#### Âü∫Êú¨‰ø°ÊÅØ

| È°πÁõÆ | ËØ¶ÊÉÖ |
|-----|------|
| **ÊØîËµõÂêçÁß∞** | Zama Developer Program - Monthly Builder Track |
| **ÂÆòÁΩë** | https://www.zama.ai/programs/developer-program |
| **Â•ñÈáëÊ±†** | $10,000 / Êúà |
| **Ëé∑Â•ñÂêçÈ¢ù** | Ââç5ÂêçÔºàÊØè‰∫∫ $2,000Ôºâ |
| **Êèê‰∫§ÊñπÂºè** | Guild.xyz |
| **ËØÑÂÆ°Âë®Êúü** | ÊØèÊúà |

#### È¢ùÂ§ñÂ•ñÂä±

- üé´ **Golden Ticket**: ÊúÄ‰Ω≥È°πÁõÆËé∑Âæó DevConnect Argentina 2025 ÂÖ®Á®ãËµûÂä©
- üéÅ **Developer Perks**: Premium support, Â∏ÇÂú∫Êé®Âπø, ÊäïËµÑ‰∫∫ÂØπÊé•
- üí∞ **Revenue Share**: Zama Protocol ‰ΩøÁî®Ë¥πÂàÜÊàê

### 8.2 ÂèÇËµõË¶ÅÊ±ÇÂàÜÊûê

#### ÂøÖÈúÄÊù°‰ª∂ÔºàÁ°¨ÊÄßË¶ÅÊ±ÇÔºâ

Ê†πÊçÆËé∑Â•ñÈ°πÁõÆÂàÜÊûêÔºå‰ª•‰∏ãÊòØ**ÂøÖÈ°ªÊª°Ë∂≥**ÁöÑÊù°‰ª∂Ôºö

| Ë¶ÅÊ±Ç | ËØ¥Êòé | Ê£ÄÊü•ÁÇπ |
|-----|------|--------|
| **‰ΩøÁî® FHEVM** | ÂøÖÈ°ª‰ΩøÁî® Zama ÁöÑ FHE ÊäÄÊúØ | ‚úÖ `euint32/euint64` Á±ªÂûã |
| **ÁúüÊ≠£ÁöÑÂä†ÂØÜ** | Êï∞ÊçÆÂøÖÈ°ªÊòØÂä†ÂØÜÁöÑ | ‚úÖ `TFHE.asEuint32()` |
| **Gateway ÈõÜÊàê** | ÂÆûÁé∞Ëß£ÂØÜÊµÅÁ®ã | ‚úÖ `GatewayCaller` ÁªßÊâø |
| **ÈÉ®ÁΩ≤Âà∞ Zama** | Âú® Zama ÁΩëÁªúËøêË°å | ‚úÖ Devnet/Mainnet |
| **ÂºÄÊ∫ê‰ª£Á†Å** | GitHub ÂÖ¨ÂºÄ‰ªìÂ∫ì | ‚úÖ MIT/Apache License |

#### Âä†ÂàÜÈ°πÔºàËΩØÊÄßË¶ÅÊ±ÇÔºâ

| È°πÁõÆ | ÈáçË¶ÅÊÄß | ËØ¥Êòé |
|-----|--------|------|
| **ÂÆûÁî®ÊÄß** | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | Ëß£ÂÜ≥ÁúüÂÆûÈóÆÈ¢ò |
| **UI/UX** | ‚≠ê‚≠ê‚≠ê‚≠ê | ‰∏ì‰∏öÁæéËßÇÁöÑÁïåÈù¢ |
| **ÊñáÊ°£** | ‚≠ê‚≠ê‚≠ê‚≠ê | README, ÊºîÁ§∫ËßÜÈ¢ë |
| **ÂàõÊñ∞ÊÄß** | ‚≠ê‚≠ê‚≠ê | Áã¨ÁâπÁöÑÂ∫îÁî®Âú∫ÊôØ |
| **‰ª£Á†ÅË¥®Èáè** | ‚≠ê‚≠ê‚≠ê | Ê∏ÖÊô∞„ÄÅÂèØÁª¥Êä§ |

### 8.3 Ëé∑Â•ñÈ°πÁõÆÁªüËÆ°ÂàÜÊûê

#### 2024Âπ¥9ÊúàËé∑Â•ñÈ°πÁõÆ

| È°πÁõÆÂêçÁß∞ | Á±ªÂûã | ÊäÄÊúØ‰∫ÆÁÇπ | Â•ñÈáë |
|---------|------|---------|------|
| **Belief Protocol** | DeFi | FHE conviction markets | $2,000 |
| **CAMM** | DeFi | Confidential AMM | $2,000 |
| **OTC with FHE** | DeFi | Confidential OTC escrow | $2,000 |
| **Lunarys** | DeFi | Privacy-first AMM | $2,000 |
| **UNIversal Hook** | DeFi | Encrypted Uniswap V4 swaps | $2,000 |

**ÂÖ±ÂêåÁâπÂæÅ**Ôºö
- ‚úÖ 100% ‰ΩøÁî®ÁúüÊ≠£ÁöÑ FHEVMÔºà‰∏çÊòØ MockÔºâ
- ‚úÖ 100% ÈÉ®ÁΩ≤Âú® Zama ÁΩëÁªú
- ‚úÖ 100% ÂÆûÁé∞‰∫ÜÁúüÊ≠£ÁöÑÈöêÁßÅ‰øùÊä§
- ‚úÖ 80% ÊòØ DeFi Áõ∏ÂÖ≥È°πÁõÆ
- ‚úÖ 100% ÊúâÂÆåÊï¥ÁöÑ UI ÁïåÈù¢

#### 2024Âπ¥8ÊúàËé∑Â•ñÈ°πÁõÆ

| È°πÁõÆÂêçÁß∞ | Á±ªÂûã | ÊäÄÊúØ‰∫ÆÁÇπ | Â•ñÈáë |
|---------|------|---------|------|
| **Orion Finance** | DeFi | Portfolio management | $1,000 |
| **EmelMarket** | NFT | Confidential NFT auction | $1,000 |
| **FHEZmail** | Communication | Private email | $1,000 |
| **Number Verse** | Gaming | Private number guessing | $1,000 |
| **Lucky Spin** | Gaming | Private spinning wheel | $1,000 |

**Ë∂ãÂäøÂàÜÊûê**Ôºö
- üìà DeFi È°πÁõÆ‰ªçÂç†Â§öÊï∞Ôºà60%Ôºâ
- üìà Gaming È°πÁõÆÂºÄÂßãÂ¢ûÂ§öÔºà40%Ôºâ
- üìà Â∫îÁî®Âú∫ÊôØÂ§öÊ†∑ÂåñÔºàNFT, Email, GamesÔºâ

### 8.4 ËØÑÂÆ°Ê†áÂáÜÊé®Êµã

Ê†πÊçÆËé∑Â•ñÈ°πÁõÆÂèçÂêëÂàÜÊûêÔºåËØÑÂÆ°ÂèØËÉΩÁöÑËØÑÂàÜÊ†áÂáÜÔºö

#### ÊäÄÊúØÂÆûÁé∞Ôºà40ÂàÜÔºâ

```
- ÊòØÂê¶‰ΩøÁî®ÁúüÊ≠£ÁöÑ FHEVMÔºö10ÂàÜ
- FHE Âä†ÂØÜÂÆûÁé∞Ë¥®ÈáèÔºö10ÂàÜ
- Gateway ÈõÜÊàêÂÆåÊï¥ÊÄßÔºö10ÂàÜ
- ‰ª£Á†ÅË¥®ÈáèÂíåÊû∂ÊûÑÔºö10ÂàÜ
```

#### ÂÆûÁî®ÊÄß‰∏éÂàõÊñ∞ÊÄßÔºà30ÂàÜÔºâ

```
- Ëß£ÂÜ≥ÁúüÂÆûÈóÆÈ¢òÔºö15ÂàÜ
- Â∫îÁî®Âú∫ÊôØÂàõÊñ∞ÊÄßÔºö10ÂàÜ
- ÂïÜ‰∏ö‰ª∑ÂÄºÔºö5ÂàÜ
```

#### Áî®Êà∑‰ΩìÈ™åÔºà20ÂàÜÔºâ

```
- UI/UX ËÆæËÆ°Ôºö10ÂàÜ
- ÂäüËÉΩÂÆåÊï¥ÊÄßÔºö5ÂàÜ
- ÈîôËØØÂ§ÑÁêÜÔºö5ÂàÜ
```

#### ÊñáÊ°£‰∏éÂ±ïÁ§∫Ôºà10ÂàÜÔºâ

```
- README Ë¥®ÈáèÔºö5ÂàÜ
- ÊºîÁ§∫ËßÜÈ¢ëÔºö3ÂàÜ
- ‰ª£Á†ÅÊ≥®ÈáäÔºö2ÂàÜ
```

### 8.5 ‰∏∫‰ªÄ‰πà Mock ÁâàÊú¨‰∏çËÉΩËé∑Â•ñÔºü

#### ÊäÄÊúØËßíÂ∫¶

```solidity
// ‚ùå Mock ÁâàÊú¨ÔºàËØÑÂßîËßÜËßíÔºöËøô‰∏çÊòØ FHEÔºâ
contract DataMarketplaceMock {
    uint256[] private data;  // ÊòéÊñáÊï∞ÊçÆ
    
    function uploadDataset(uint256[] calldata dataArray) {
        // Ê≤°ÊúâÂä†ÂØÜ
    }
}

// ‚úÖ FHE ÁâàÊú¨ÔºàËØÑÂßîËßÜËßíÔºöËøôÊâçÊòØ FHEÔºâ
contract DataMarketplaceFHE is GatewayCaller {
    euint32[] private encryptedData;  // Âä†ÂØÜÊï∞ÊçÆ
    
    function uploadDataset(bytes[] calldata inputProofs) {
        for (uint i = 0; i < inputProofs.length; i++) {
            euint32 encrypted = TFHE.asEuint32(inputProofs[i]);
            encryptedData.push(encrypted);
        }
    }
}
```

#### ËØÑÂßîËßÜËßí

| ËØÑÂÆ°ÁÇπ | Mock ÁâàÊú¨ | FHE ÁâàÊú¨ |
|-------|----------|----------|
| ÊäÄÊúØÈöæÂ∫¶ | ‚ùå ‰Ωé | ‚úÖ È´ò |
| ÈöêÁßÅ‰øùÊä§ | ‚ùå Êó† | ‚úÖ Êúâ |
| FHE ‰ΩøÁî® | ‚ùå 0% | ‚úÖ 100% |
| ÂèÇËµõËµÑÊ†º | ‚ùå ‰∏çÁ¨¶Âêà | ‚úÖ Á¨¶Âêà |

**ÁªìËÆ∫**ÔºöMock ÁâàÊú¨‰ºöÂú®**Á¨¨‰∏ÄËΩÆÁ≠õÈÄâ**Â∞±Ë¢´Ê∑òÊ±∞ÔºÅ

---

## 9. ‰ªé Mock Âà∞ FHEVM ÁöÑÂçáÁ∫ßË∑ØÂæÑ

### 9.1 ÂçáÁ∫ßÂøÖË¶ÅÊÄßËØÑ‰º∞

#### ÂΩìÂâçÈ°πÁõÆÁä∂ÊÄÅ

| Ê®°Âùó | Mock ÁâàÊú¨ | FHE ÁâàÊú¨ | ÂçáÁ∫ßÈöæÂ∫¶ |
|-----|----------|----------|---------|
| ‰∏öÂä°ÈÄªËæë | ‚úÖ 100% | ‚úÖ 0% | üü¢ ‰Ωé |
| Êô∫ËÉΩÂêàÁ∫¶ | ‚úÖ Mock | ‚ùå ÈúÄË¶Å | üü° ‰∏≠ |
| ÂâçÁ´Ø UI | ‚úÖ 100% | ‚ùå ÈúÄË¶Å | üü¢ ‰Ωé |
| Èí±ÂåÖÈõÜÊàê | ‚úÖ ÂÆåÊàê | ‚úÖ ÂèØÂ§çÁî® | üü¢ ‰Ωé |
| ÊµãËØïË∞ÉËØï | ‚úÖ ÂÖÖÂàÜ | ‚ùå ÈúÄË¶Å | üü° ‰∏≠ |

**ËØÑ‰º∞ÁªìËÆ∫**Ôºö
- ‚úÖ **90%** ÁöÑÂ∑•‰ΩúÂ∑≤ÂÆåÊàê
- ‚ùå **10%** ÁöÑ FHE ÂÖ≥ÈîÆÂäüËÉΩÈúÄË¶ÅË°•ÂÖÖ
- ‚è∞ È¢ÑËÆ°ÂçáÁ∫ßÊó∂Èó¥Ôºö**7-10Â§©**

### 9.2 ÂçáÁ∫ßÊó∂Èó¥ËßÑÂàí

#### Phase 1: Â≠¶‰π†ÂáÜÂ§áÔºà2-3Â§©Ôºâ

```
Day 1: ÁêÜËÆ∫Â≠¶‰π†
‚îú‚îÄ ÈòÖËØª Zama ÂÆòÊñπÊñáÊ°£Ôºà4Â∞èÊó∂Ôºâ
‚îú‚îÄ ÁêÜËß£ FHE Âü∫Êú¨Ê¶ÇÂøµÔºà2Â∞èÊó∂Ôºâ
‚îú‚îÄ Â≠¶‰π† Gateway Â∑•‰ΩúÂéüÁêÜÔºà2Â∞èÊó∂Ôºâ
‚îî‚îÄ ÊÄªÁªìÂ≠¶‰π†Á¨îËÆ∞Ôºà1Â∞èÊó∂Ôºâ

Day 2: Ê∫êÁ†ÅÁ†îÁ©∂
‚îú‚îÄ Á†îÁ©∂ Lunarys Ê∫êÁ†ÅÔºà3Â∞èÊó∂Ôºâ
‚îú‚îÄ Á†îÁ©∂ OTC-FHE Ê∫êÁ†ÅÔºà3Â∞èÊó∂Ôºâ
‚îú‚îÄ ÁêÜËß£ËØ∑Ê±ÇÊò†Â∞ÑÁ≥ªÁªüÔºà2Â∞èÊó∂Ôºâ
‚îî‚îÄ Êï¥ÁêÜ‰ª£Á†ÅÊ®°ÊùøÔºà1Â∞èÊó∂Ôºâ

Day 3: SDK ÂÆûË∑µ
‚îú‚îÄ ÂÆâË£Ö @zama-fhe/relayer-sdkÔºà0.5Â∞èÊó∂Ôºâ
‚îú‚îÄ ÊµãËØïÂä†ÂØÜÂäüËÉΩÔºà2Â∞èÊó∂Ôºâ
‚îú‚îÄ ÊµãËØïËß£ÂØÜÊµÅÁ®ãÔºà2Â∞èÊó∂Ôºâ
‚îî‚îÄ ÁºñÂÜôÊµãËØï‰ª£Á†ÅÔºà2Â∞èÊó∂Ôºâ
```

#### Phase 2: ÂêàÁ∫¶ÊîπÈÄ†Ôºà1-2Â§©Ôºâ

```
Day 4: ÂàõÂª∫ FHE ÂêàÁ∫¶
‚îú‚îÄ ÂàõÂª∫ DataMarketplaceFHE.solÔºà1Â∞èÊó∂Ôºâ
‚îú‚îÄ Ê∑ªÂä†Áä∂ÊÄÅÊú∫ÂíåÊò†Â∞ÑÔºà2Â∞èÊó∂Ôºâ
‚îú‚îÄ ÂÆûÁé∞ FHE Êï∞ÊçÆ‰∏ä‰º†Ôºà2Â∞èÊó∂Ôºâ
‚îú‚îÄ ÂÆûÁé∞Êü•ËØ¢Âä†ÂØÜÔºà2Â∞èÊó∂Ôºâ
‚îî‚îÄ Ê∑ªÂä† Gateway ÂõûË∞ÉÔºà2Â∞èÊó∂Ôºâ

Day 5: ÊµãËØïÈÉ®ÁΩ≤
‚îú‚îÄ ÁºñÂÜôÈÉ®ÁΩ≤ËÑöÊú¨Ôºà1Â∞èÊó∂Ôºâ
‚îú‚îÄ Êú¨Âú∞ÊµãËØïÔºà2Â∞èÊó∂Ôºâ
‚îú‚îÄ ÈÉ®ÁΩ≤Âà∞ Zama DevnetÔºà1Â∞èÊó∂Ôºâ
‚îî‚îÄ È™åËØÅÂêàÁ∫¶ÂäüËÉΩÔºà2Â∞èÊó∂Ôºâ
```

#### Phase 3: ÂâçÁ´ØÈÄÇÈÖçÔºà1Â§©Ôºâ

```
Day 6: ÂâçÁ´ØÈõÜÊàê
‚îú‚îÄ ÈõÜÊàê relayer-sdkÔºà2Â∞èÊó∂Ôºâ
‚îú‚îÄ ÂÆûÁé∞Âä†ÂØÜ‰∏ä‰º†Ôºà2Â∞èÊó∂Ôºâ
‚îú‚îÄ ÂÆûÁé∞Ëß£ÂØÜËΩÆËØ¢Ôºà2Â∞èÊó∂Ôºâ
‚îî‚îÄ UI Áä∂ÊÄÅÊòæÁ§∫Ôºà2Â∞èÊó∂Ôºâ
```

#### Phase 4: ÊµãËØï‰ºòÂåñÔºà2-3Â§©Ôºâ

```
Day 7-9: Á´ØÂà∞Á´ØÊµãËØï
‚îú‚îÄ ÂÆåÊï¥ÊµÅÁ®ãÊµãËØï
‚îú‚îÄ Gateway Á®≥ÂÆöÊÄßÊµãËØï
‚îú‚îÄ ÈîôËØØÂ§ÑÁêÜÂÆåÂñÑ
‚îî‚îÄ ÊÄßËÉΩ‰ºòÂåñ
```

#### Phase 5: ÊñáÊ°£ÂáÜÂ§áÔºà1Â§©Ôºâ

```
Day 10: ÂèÇËµõÊùêÊñô
‚îú‚îÄ Êí∞ÂÜô READMEÔºà3Â∞èÊó∂Ôºâ
‚îú‚îÄ ÂΩïÂà∂ÊºîÁ§∫ËßÜÈ¢ëÔºà2Â∞èÊó∂Ôºâ
‚îú‚îÄ ÂáÜÂ§áÊû∂ÊûÑÂõæÔºà2Â∞èÊó∂Ôºâ
‚îî‚îÄ ÊúÄÁªàÊ£ÄÊü•Ôºà1Â∞èÊó∂Ôºâ
```

### 9.3 ËØ¶ÁªÜÂçáÁ∫ßÊ≠•È™§

#### Step 1: ÂàõÂª∫ FHE ÂêàÁ∫¶

**Êñá‰ª∂**: `contracts/DataMarketplaceFHE.sol`

```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.24;

import "fhevm/lib/TFHE.sol";
import "fhevm/gateway/GatewayCaller.sol";
import "@openzeppelin/contracts/access/Ownable.sol";
import "@openzeppelin/contracts/security/ReentrancyGuard.sol";

contract DataMarketplaceFHE is GatewayCaller, Ownable, ReentrancyGuard {
    
    // ==================== Áä∂ÊÄÅÊûö‰∏æ ====================
    enum QueryStatus {
        PENDING,
        PROCESSING,
        COMPLETED,
        FAILED,
        REFUNDED
    }
    
    enum QueryType {
        COMPUTE_MEAN,
        COMPUTE_VARIANCE,
        COUNT_ABOVE,
        COUNT_BELOW
    }
    
    // ==================== Êï∞ÊçÆÁªìÊûÑ ====================
    struct Dataset {
        uint256 id;
        address owner;
        string name;
        string description;
        euint32[] encryptedData;  // ‚Üê FHE Âä†ÂØÜÊï∞ÊçÆ
        uint256 dataSize;
        uint256 pricePerQuery;
        uint256 totalQueries;
        uint256 totalRevenue;
        uint256 createdAt;
        bool active;
    }
    
    struct Query {
        uint256 id;
        uint256 datasetId;
        address buyer;
        QueryType queryType;
        euint32 encryptedParameter;  // ‚Üê FHE Âä†ÂØÜÂèÇÊï∞
        uint32 decryptedResult;      // ‚Üê Gateway Ëß£ÂØÜÂêéÁöÑÁªìÊûú
        QueryStatus status;
        uint256 price;
        uint256 timestamp;
    }
    
    struct DecryptionRequest {
        uint256 queryId;
        address requester;
        uint256 timestamp;
        bool processed;
    }
    
    // ==================== Áä∂ÊÄÅÂèòÈáè ====================
    uint256 public datasetCount;
    uint256 public queryCount;
    uint256 public constant PLATFORM_FEE_PERCENT = 5;
    uint256 public constant CALLBACK_GAS_LIMIT = 500000;
    
    mapping(uint256 => Dataset) public datasets;
    mapping(uint256 => Query) public queries;
    mapping(uint256 => DecryptionRequest) public decryptionRequests;
    mapping(uint256 => uint256) public requestIdToQuery;  // Gateway requestId -> queryId
    
    // ==================== ‰∫ã‰ª∂ ====================
    event DatasetCreated(
        uint256 indexed datasetId,
        address indexed owner,
        string name,
        uint256 dataSize,
        uint256 pricePerQuery
    );
    
    event QueryExecuted(
        uint256 indexed queryId,
        uint256 indexed datasetId,
        address indexed buyer,
        QueryType queryType,
        uint256 price
    );
    
    event DecryptionRequested(
        uint256 indexed requestId,
        uint256 indexed queryId,
        uint256 timestamp
    );
    
    event QueryCompleted(
        uint256 indexed queryId,
        uint32 result
    );
    
    // ==================== Ê†∏ÂøÉÂäüËÉΩ ====================
    
    /**
     * @notice ‰∏ä‰º†Âä†ÂØÜÊï∞ÊçÆÈõÜ
     * @param name Êï∞ÊçÆÈõÜÂêçÁß∞
     * @param description Êï∞ÊçÆÈõÜÊèèËø∞
     * @param inputProofs FHE Âä†ÂØÜËØÅÊòéÊï∞ÁªÑ
     * @param pricePerQuery ÊØèÊ¨°Êü•ËØ¢‰ª∑Ê†ºÔºàWeiÔºâ
     */
    function uploadDataset(
        string memory name,
        string memory description,
        bytes[] calldata inputProofs,
        uint256 pricePerQuery
    ) external {
        require(inputProofs.length > 0, "Empty dataset");
        require(pricePerQuery > 0, "Invalid price");
        
        datasetCount++;
        Dataset storage dataset = datasets[datasetCount];
        
        dataset.id = datasetCount;
        dataset.owner = msg.sender;
        dataset.name = name;
        dataset.description = description;
        dataset.dataSize = inputProofs.length;
        dataset.pricePerQuery = pricePerQuery;
        dataset.createdAt = block.timestamp;
        dataset.active = true;
        
        // Âä†ÂØÜÊØè‰∏™Êï∞ÊçÆÁÇπ
        for (uint i = 0; i < inputProofs.length; i++) {
            euint32 encryptedValue = TFHE.asEuint32(inputProofs[i]);
            dataset.encryptedData.push(encryptedValue);
        }
        
        emit DatasetCreated(
            datasetCount,
            msg.sender,
            name,
            inputProofs.length,
            pricePerQuery
        );
    }
    
    /**
     * @notice ÊâßË°åÊü•ËØ¢ÔºàË¥≠‰π∞Âπ∂ËØ∑Ê±ÇËÆ°ÁÆóÔºâ
     * @param datasetId Êï∞ÊçÆÈõÜID
     * @param queryType Êü•ËØ¢Á±ªÂûã
     * @param parameterProof ÂèÇÊï∞ÁöÑÂä†ÂØÜËØÅÊòéÔºàÂ¶ÇÊûúÈúÄË¶ÅÔºâ
     */
    function executeQuery(
        uint256 datasetId,
        QueryType queryType,
        bytes calldata parameterProof
    ) external payable nonReentrant {
        Dataset storage dataset = datasets[datasetId];
        require(dataset.active, "Dataset not active");
        require(msg.value >= dataset.pricePerQuery, "Insufficient payment");
        
        queryCount++;
        Query storage query = queries[queryCount];
        
        query.id = queryCount;
        query.datasetId = datasetId;
        query.buyer = msg.sender;
        query.queryType = queryType;
        query.status = QueryStatus.PENDING;
        query.price = msg.value;
        query.timestamp = block.timestamp;
        
        // Â¶ÇÊûúÈúÄË¶ÅÂèÇÊï∞ÔºåÂä†ÂØÜÂÆÉ
        if (parameterProof.length > 0) {
            query.encryptedParameter = TFHE.asEuint32(parameterProof);
        }
        
        // Á´ãÂç≥ËÆ°ÁÆóÂä†ÂØÜÁªìÊûú
        euint32 encryptedResult = _computeEncryptedResult(
            dataset.encryptedData,
            queryType,
            query.encryptedParameter
        );
        
        // ËØ∑Ê±Ç Gateway Ëß£ÂØÜ
        uint256 requestId = Gateway.requestDecryption(
            CT(encryptedResult),
            this.callbackQueryResult.selector,
            0,
            block.timestamp + 100,
            false
        );
        
        // ËÆ∞ÂΩïËØ∑Ê±ÇÊò†Â∞Ñ
        requestIdToQuery[requestId] = queryCount;
        decryptionRequests[requestId] = DecryptionRequest({
            queryId: queryCount,
            requester: msg.sender,
            timestamp: block.timestamp,
            processed: false
        });
        
        query.status = QueryStatus.PROCESSING;
        
        emit QueryExecuted(
            queryCount,
            datasetId,
            msg.sender,
            queryType,
            msg.value
        );
        
        emit DecryptionRequested(
            requestId,
            queryCount,
            block.timestamp
        );
    }
    
    /**
     * @notice Gateway ÂõûË∞ÉÂáΩÊï∞ÔºàËß£ÂØÜÂÆåÊàêÂêéË∞ÉÁî®Ôºâ
     * @param requestId Gateway ËØ∑Ê±ÇID
     * @param decryptedResult Ëß£ÂØÜÂêéÁöÑÁªìÊûú
     */
    function callbackQueryResult(
        uint256 requestId,
        uint32 decryptedResult
    ) public onlyGateway {
        uint256 queryId = requestIdToQuery[requestId];
        require(queryId > 0, "Invalid request");
        
        Query storage query = queries[queryId];
        Dataset storage dataset = datasets[query.datasetId];
        
        require(!decryptionRequests[requestId].processed, "Already processed");
        
        // ËÆæÁΩÆËß£ÂØÜÁªìÊûú
        query.decryptedResult = decryptedResult;
        query.status = QueryStatus.COMPLETED;
        decryptionRequests[requestId].processed = true;
        
        // ÂàÜÈÖçÊî∂ÂÖ•
        uint256 platformFee = (query.price * PLATFORM_FEE_PERCENT) / 100;
        uint256 providerRevenue = query.price - platformFee;
        
        dataset.totalQueries++;
        dataset.totalRevenue += providerRevenue;
        
        // ËΩ¨Ë¥¶ÁªôÊï∞ÊçÆÊèê‰æõËÄÖ
        payable(dataset.owner).transfer(providerRevenue);
        
        emit QueryCompleted(queryId, decryptedResult);
    }
    
    /**
     * @notice ËÆ°ÁÆóÂä†ÂØÜÁªìÊûúÔºàFHE ËøêÁÆóÔºâ
     */
    function _computeEncryptedResult(
        euint32[] storage data,
        QueryType queryType,
        euint32 parameter
    ) internal view returns (euint32) {
        if (queryType == QueryType.COMPUTE_MEAN) {
            return _computeMean(data);
        } else if (queryType == QueryType.COMPUTE_VARIANCE) {
            return _computeVariance(data);
        } else if (queryType == QueryType.COUNT_ABOVE) {
            return _countAbove(data, parameter);
        } else {
            return _countBelow(data, parameter);
        }
    }
    
    function _computeMean(euint32[] storage data) internal view returns (euint32) {
        euint32 sum = TFHE.asEuint32(0);
        for (uint i = 0; i < data.length; i++) {
            sum = TFHE.add(sum, data[i]);
        }
        return TFHE.div(sum, uint32(data.length));
    }
    
    function _countAbove(euint32[] storage data, euint32 threshold) internal view returns (euint32) {
        euint32 count = TFHE.asEuint32(0);
        for (uint i = 0; i < data.length; i++) {
            ebool isAbove = TFHE.gt(data[i], threshold);
            count = TFHE.add(count, TFHE.asEuint32(isAbove));
        }
        return count;
    }
    
    // ... ÂÖ∂‰ªñËæÖÂä©ÂáΩÊï∞
}
```

**ÂÖ≥ÈîÆÊîπÂä®ÁÇπ**Ôºö
1. ‚úÖ `uint256[]` ‚Üí `euint32[]` ÔºàÂä†ÂØÜÊï∞ÊçÆÔºâ
2. ‚úÖ Ê∑ªÂä† `GatewayCaller` ÁªßÊâø
3. ‚úÖ ÂÆûÁé∞ `callbackQueryResult` ÂõûË∞É
4. ‚úÖ ‰ΩøÁî® `TFHE.add`, `TFHE.div` Á≠â FHE ËøêÁÆó
5. ‚úÖ Ê∑ªÂä†ËØ∑Ê±ÇÊò†Â∞ÑÁ≥ªÁªü

---

## 10. Gateway ‰∏çÁ®≥ÂÆöÈóÆÈ¢òÁöÑÂ∫îÂØπÁ≠ñÁï•

### 10.1 ÈóÆÈ¢òÁé∞Áä∂

#### ÂÆòÊñπÊâøËÆ§ÁöÑÈóÆÈ¢ò

Ê†πÊçÆ Zama ÂÆòÊñπÂíåÁ§æÂå∫ÂèçÈ¶àÔºö
- ‚ö†Ô∏è Gateway Devnet Á°ÆÂÆûÂ≠òÂú®Á®≥ÂÆöÊÄßÈóÆÈ¢ò
- ‚ö†Ô∏è Ëß£ÂØÜËØ∑Ê±ÇÂèØËÉΩË∂ÖÊó∂Ôºà> 30ÁßíÔºâ
- ‚ö†Ô∏è ÂõûË∞ÉÂèØËÉΩÂ§±Ë¥•
- ‚ö†Ô∏è È´òÂ≥∞ÊúüÊúçÂä°‰∏çÁ®≥ÂÆö

#### Ëé∑Â•ñÈ°πÁõÆÁöÑÂÖ±ÂêåÊåëÊàò

**ÊâÄÊúâËé∑Â•ñÈ°πÁõÆÈÉΩÈù¢‰∏¥ÂêåÊ†∑ÁöÑÈóÆÈ¢ò**Ôºå‰ΩÜ‰ªñ‰ª¨ÊâæÂà∞‰∫ÜËß£ÂÜ≥ÊñπÊ°àÔºÅ

### 10.2 Á≠ñÁï• AÔºöÊ∑∑ÂêàÊ®°ÂºèÔºàÊúÄÊé®ËçêÔºâ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê

#### Ê†∏ÂøÉÊÄùÊÉ≥

**Âè™Âä†ÂØÜÁúüÊ≠£ÊïèÊÑüÁöÑÊï∞ÊçÆÔºåÈùûÊïèÊÑü‰ø°ÊÅØ‰øùÊåÅÊòéÊñá**

#### ÂÆûÁé∞Á§∫‰æãÔºàÂèÇËÄÉ LunarysÔºâ

```solidity
struct Dataset {
    // ÂÖ¨ÂºÄ‰ø°ÊÅØÔºàÊòéÊñáÔºå‰∏çÈúÄË¶Å FHEÔºâ
    string name;            // ‚úÖ ÂèØ‰ª•ÂÖ¨ÂºÄ
    string description;     // ‚úÖ ÂèØ‰ª•ÂÖ¨ÂºÄ
    uint256 dataSize;       // ‚úÖ ÂèØ‰ª•ÂÖ¨ÂºÄ
    uint256 pricePerQuery;  // ‚úÖ ÂèØ‰ª•ÂÖ¨ÂºÄ
    address owner;          // ‚úÖ ÂèØ‰ª•ÂÖ¨ÂºÄ
    
    // ÊïèÊÑü‰ø°ÊÅØÔºàÂä†ÂØÜÔºå‰ΩøÁî® FHEÔºâ
    euint32[] encryptedData;  // üîí ÂøÖÈ°ªÂä†ÂØÜ
}
```

**‰ºòÁÇπ**Ôºö
- ‚úÖ ÂáèÂ∞ë 70% ÁöÑ Gateway Ë∞ÉÁî®
- ‚úÖ ÊèêÈ´òÁ≥ªÁªüÁ®≥ÂÆöÊÄß
- ‚úÖ ‰øùÊä§Ê†∏ÂøÉÊï∞ÊçÆÈöêÁßÅ
- ‚úÖ **‰ªçÁÑ∂Á¨¶ÂêàÂèÇËµõË¶ÅÊ±Ç**ÔºàÊúâÁúüÊ≠£ÁöÑ FHEÔºâ

### 10.3 Á≠ñÁï• BÔºöÂºÇÊ≠•Â§ÑÁêÜÔºàÂº∫ÁÉàÊé®ËçêÔºâ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê

#### Ê†∏ÂøÉÊÄùÊÉ≥

**Áî®Êà∑‰∏çÈúÄË¶ÅÂÆûÊó∂Á≠âÂæÖËß£ÂØÜÔºå‰ΩøÁî®ÂºÇÊ≠•+ÈÄöÁü•Ê®°Âºè**

#### ÂâçÁ´ØÂÆûÁé∞

```javascript
// ‚ùå ÊóßÊñπÂºèÔºöÂêåÊ≠•Á≠âÂæÖÔºàÁî®Êà∑‰ΩìÈ™åÂ∑ÆÔºâ
const executeQuery = async () => {
  const tx = await contract.executeQuery(...);
  // Áî®Êà∑ÂøÖÈ°ªÁ≠âÂæÖ30-60Áßí
  const result = await waitForDecryption(queryId);
  showResult(result);
};

// ‚úÖ Êñ∞ÊñπÂºèÔºöÂºÇÊ≠•Â§ÑÁêÜÔºàÁî®Êà∑‰ΩìÈ™åÂ•ΩÔºâ
const executeQuery = async () => {
  const tx = await contract.executeQuery(...);
  const queryId = getQueryIdFromEvent(tx);
  
  // Á´ãÂç≥ËøîÂõûÔºåÊòæÁ§∫ "Processing..."
  showProcessingStatus(queryId);
  
  // ÂêéÂè∞ËΩÆËØ¢
  pollQueryResult(queryId).then(result => {
    // ÂÆåÊàêÂêéÊòæÁ§∫ÈÄöÁü•
    showNotification("Query completed!", result);
  });
};
```

**‰ºòÁÇπ**Ôºö
- ‚úÖ Áî®Êà∑‰∏çÈúÄË¶ÅÁ≠âÂæÖ
- ‚úÖ ÂèØ‰ª•ÂêåÊó∂Â§ÑÁêÜÂ§ö‰∏™Êü•ËØ¢
- ‚úÖ Èôç‰ΩéÁî®Êà∑ÁÑ¶ËôëÊÑü
- ‚úÖ **ÊâÄÊúâËé∑Â•ñÈ°πÁõÆÈÉΩÁî®Ëøô‰∏™Á≠ñÁï•**

### 10.4 Á≠ñÁï• CÔºöË∂ÖÊó∂‰∏éÈáçËØïÊú∫Âà∂ÔºàÊé®ËçêÔºâ‚≠ê‚≠ê‚≠ê‚≠ê

#### ÂêàÁ∫¶Á´ØÂÆûÁé∞

```solidity
struct Query {
    // ... ÂÖ∂‰ªñÂ≠óÊÆµ
    uint256 requestTimestamp;
    uint8 retryCount;
    uint256 expiresAt;
}

function requestQueryRetry(uint256 queryId) external {
    Query storage query = queries[queryId];
    require(msg.sender == query.buyer, "Not owner");
    require(query.status == QueryStatus.PROCESSING, "Invalid status");
    require(query.retryCount < MAX_RETRIES, "Max retries exceeded");
    require(block.timestamp > query.expiresAt, "Not expired yet");
    
    // ÈáçÊñ∞ËØ∑Ê±ÇËß£ÂØÜ
    uint256 requestId = Gateway.requestDecryption(...);
    query.retryCount++;
    query.expiresAt = block.timestamp + TIMEOUT_DURATION;
}

function refundQuery(uint256 queryId) external nonReentrant {
    Query storage query = queries[queryId];
    require(msg.sender == query.buyer, "Not owner");
    require(query.status == QueryStatus.PROCESSING, "Invalid status");
    require(block.timestamp > query.expiresAt + GRACE_PERIOD, "Not expired");
    
    // Ë∂ÖÊó∂ÈÄÄÊ¨æ
    query.status = QueryStatus.REFUNDED;
    payable(query.buyer).transfer(query.price);
}
```

### 10.5 Á≠ñÁï• DÔºöÊú¨Âú∞ÁºìÂ≠òÔºàÂèØÈÄâÔºâ‚≠ê‚≠ê‚≠ê

```javascript
const resultCache = new Map();

const getQueryResult = async (queryId) => {
  // ÂÖàÊü•ÁºìÂ≠ò
  if (resultCache.has(queryId)) {
    return resultCache.get(queryId);
  }
  
  // ‰ªéÈìæ‰∏äËé∑Âèñ
  const result = await contract.getQuery(queryId);
  
  // Â¶ÇÊûúÂ∑≤ÂÆåÊàêÔºåÁºìÂ≠òÁªìÊûú
  if (result.status === QueryStatus.COMPLETED) {
    resultCache.set(queryId, result);
  }
  
  return result;
};
```

### 10.6 ÂèÇËµõÂª∫ËÆÆÁöÑÁ≠ñÁï•ÁªÑÂêà

#### ÊúÄ‰Ω≥ÂÆûË∑µÁªÑÂêà

```
1. Ê∑∑ÂêàÊ®°ÂºèÔºàÂáèÂ∞ë Gateway Ë∞ÉÁî®Ôºâ
   ‚Üì
2. ÂºÇÊ≠•Â§ÑÁêÜÔºàÊîπÂñÑÁî®Êà∑‰ΩìÈ™åÔºâ
   ‚Üì
3. Ë∂ÖÊó∂ÈáçËØïÔºàÂ§ÑÁêÜÂ§±Ë¥•ÊÉÖÂÜµÔºâ
   ‚Üì
4. Êú¨Âú∞ÁºìÂ≠òÔºàÊèêÈ´òÊÄßËÉΩÔºâ
```

#### Âú® README ‰∏≠ËØ¥Êòé

```markdown
## Gateway Á®≥ÂÆöÊÄßÂ§ÑÁêÜ

Êú¨È°πÁõÆÈááÁî®‰ª•‰∏ãÁ≠ñÁï•Â∫îÂØπ Gateway Devnet ÁöÑÁ®≥ÂÆöÊÄßÈóÆÈ¢òÔºö

1. **Ê∑∑ÂêàÂä†ÂØÜÊ®°Âºè**
   - Âè™Âä†ÂØÜÊ†∏ÂøÉÊïèÊÑüÊï∞ÊçÆÔºàÊï∞ÊçÆÂÄºÔºâ
   - ÂÖÉÊï∞ÊçÆ‰øùÊåÅÊòéÊñáÔºàÂêçÁß∞„ÄÅÊèèËø∞Á≠âÔºâ
   - ÂáèÂ∞ë 70% ÁöÑËß£ÂØÜËØ∑Ê±Ç

2. **ÂºÇÊ≠•Â§ÑÁêÜÊû∂ÊûÑ**
   - Áî®Êà∑Êèê‰∫§Êü•ËØ¢ÂêéÁ´ãÂç≥ËøîÂõû
   - ÂêéÂè∞ËΩÆËØ¢Ëß£ÂØÜÁªìÊûú
   - ÂÆåÊàêÂêéÈÄöÁü•Áî®Êà∑

3. **Ë∂ÖÊó∂‰∏éÈáçËØïÊú∫Âà∂**
   - 30ÂàÜÈíüË∂ÖÊó∂Ëá™Âä®ÈáçËØï
   - ÊúÄÂ§öÈáçËØï3Ê¨°
   - Ë∂ÖÊó∂ÂêéÂèØÁî≥ËØ∑ÈÄÄÊ¨æ

4. **‰ºòÈõÖÈôçÁ∫ß**
   - Gateway Á¶ªÁ∫øÊó∂ÊòæÁ§∫ÂèãÂ•ΩÊèêÁ§∫
   - ‰øùÂ≠òÊü•ËØ¢ÂéÜÂè≤‰æõÂêéÁª≠ÈáçËØï
   - ‰∏çÂΩ±ÂìçÂÖ∂‰ªñÂäüËÉΩ‰ΩøÁî®
```

**ËØÑÂßî‰ºöÊ¨£ËµèËøôÁßçÂä°ÂÆûÁöÑÂ∑•Á®ãÂÆûË∑µÔºÅ**

---

## 11. Ëé∑Â•ñÈ°πÁõÆÂàÜÊûê‰∏éÁªèÈ™åÊÄªÁªì

### 11.1 Lunarys È°πÁõÆÊ∑±Â∫¶ÂàÜÊûê

#### È°πÁõÆÁÆÄ‰ªã
- **Ëé∑Â•ñÊó∂Èó¥**: 2024Âπ¥9Êúà
- **Â•ñÈáë**: $2,000
- **Á±ªÂûã**: Privacy-first AMM
- **Ê∫êÁ†Å**: https://github.com/tomi204/privacy-pool-monorepo

#### Ê†∏ÂøÉÂàõÊñ∞

**Ê∑∑ÂêàÊû∂ÊûÑËÆæËÆ°**Ôºö
```solidity
// ÂÖ¨ÂºÄÊ±†ÔºöUSDCÔºàÊòéÊñáÔºâ
uint256 public usdcBalance;

// ÈöêÁßÅÊ±†ÔºöÁî®Êà∑‰ΩôÈ¢ùÔºàFHE Âä†ÂØÜÔºâ
mapping(address => euint32) private encryptedBalances;
```

**‰∏∫‰ªÄ‰πàËøôÊ†∑ËÆæËÆ°Ôºü**
1. ‚úÖ USDC ÊòØÂÖ¨ÂºÄÁöÑÔºàÊú¨Êù•Â∞±ÂÖ¨ÂºÄÔºâ
2. ‚úÖ Áî®Êà∑‰ΩôÈ¢ùÊòØÁßÅÂØÜÁöÑÔºàFHE ‰øùÊä§Ôºâ
3. ‚úÖ ÂáèÂ∞ë Gateway Ë∞ÉÁî®ÔºàÂè™Âú®ÂøÖË¶ÅÊó∂Ëß£ÂØÜÔºâ
4. ‚úÖ ‰øùÊåÅ AMM ÂäüËÉΩÂÆåÊï¥ÊÄß

#### ÂÄºÂæóÂ≠¶‰π†ÁöÑÁÇπ

1. **Âä°ÂÆûÁöÑÈöêÁßÅ‰øùÊä§**
   - ‰∏çÊòØÊâÄÊúâÊï∞ÊçÆÈÉΩÂä†ÂØÜ
   - Âè™Âä†ÂØÜÁúüÊ≠£ÈúÄË¶Å‰øùÂØÜÁöÑ

2. **Ê∏ÖÊô∞ÁöÑÊñáÊ°£**
   - README ÈùûÂ∏∏ËØ¶ÁªÜ
   - ÊúâÊû∂ÊûÑÂõæ
   - ÊúâÈÉ®ÁΩ≤ËØ¥Êòé

3. **ÂÆåÊï¥ÁöÑ UI**
   - ‰∏ì‰∏öÁöÑÁïåÈù¢
   - ÊµÅÁïÖÁöÑ‰∫§‰∫í
   - ÈîôËØØÊèêÁ§∫ÂèãÂ•Ω

### 11.2 OTC-FHE È°πÁõÆÊ∑±Â∫¶ÂàÜÊûê

#### È°πÁõÆÁÆÄ‰ªã
- **Ëé∑Â•ñÊó∂Èó¥**: 2024Âπ¥9Êúà
- **Â•ñÈáë**: $2,000
- **Á±ªÂûã**: Confidential OTC escrow
- **Ê∫êÁ†Å**: https://github.com/tasneemtoolba/OTC-with-FHE

#### Ê†∏ÂøÉÂàõÊñ∞

**ÊâòÁÆ°‰∫§ÊòìÊ®°Âºè**Ôºö
```solidity
struct Trade {
    address buyer;
    address seller;
    euint64 buyerAmount;   // ‰π∞ÂÆ∂ÈáëÈ¢ùÔºàÂä†ÂØÜÔºâ
    euint64 sellerAmount;  // ÂçñÂÆ∂ÈáëÈ¢ùÔºàÂä†ÂØÜÔºâ
    TradeStatus status;
}
```

**‰∏∫‰ªÄ‰πàËé∑Â•ñÔºü**
1. ‚úÖ Ëß£ÂÜ≥ÁúüÂÆûÁóõÁÇπÔºàOTC ‰∫§ÊòìÈöêÁßÅÔºâ
2. ‚úÖ ÊäÄÊúØÂÆûÁé∞ÂÆåÊï¥ÔºàGateway ÈõÜÊàêÔºâ
3. ‚úÖ ‰ΩøÁî® OpenZeppelin Confidential Contracts
4. ‚úÖ ‰ª£Á†ÅË¥®ÈáèÈ´ò

#### ÂÄºÂæóÂ≠¶‰π†ÁöÑÁÇπ

1. **ERC-7984 Ê†áÂáÜ**
   - ‰ΩøÁî®ÊúÄÊñ∞ÁöÑ‰øùÂØÜ‰ª£Â∏ÅÊ†áÂáÜ
   - ‰∏é Zama ÁîüÊÄÅÊ∑±Â∫¶ÈõÜÊàê

2. **Gateway ÈõÜÊàê**
   - ÂÆåÊï¥ÁöÑ Relayer SDK ‰ΩøÁî®
   - Â§ÑÁêÜ‰∫ÜË∂ÖÊó∂ÂíåÈáçËØï

3. **ÊµãËØïË¶ÜÁõñ**
   - ÂÖÖÂàÜÁöÑÂçïÂÖÉÊµãËØï
   - ÈõÜÊàêÊµãËØïÂÆåÊï¥

### 11.3 Belief Protocol È°πÁõÆÂàÜÊûê

#### È°πÁõÆÁÆÄ‰ªã
- **Ëé∑Â•ñÊó∂Èó¥**: 2024Âπ¥9Êúà
- **Â•ñÈáë**: $2,000
- **Á±ªÂûã**: Privacy-preserving conviction markets
- **Ê∫êÁ†Å**: https://github.com/dordunu1/Zamabelief

#### Ê†∏ÂøÉÂàõÊñ∞

**Conviction Voting + FHE**Ôºö
- Áî®Êà∑ÂèØ‰ª•Âä†ÂØÜÊäºÊ≥®Ëá™Â∑±ÁöÑËßÇÁÇπ
- ÂÖ∂‰ªñ‰∫∫Áúã‰∏çÂà∞‰Ω†Êäº‰∫ÜÂ§öÂ∞ë
- ÊúÄÁªàÁªìÊûúÂÖ¨ÂºÄÔºå‰ΩÜ‰∏™‰∫∫ÊäºÊ≥®‰øùÂØÜ

#### ‰∏∫‰ªÄ‰πàËé∑Â•ñÔºü

1. ‚úÖ ÂàõÊñ∞ÁöÑÂ∫îÁî®Âú∫ÊôØ
2. ‚úÖ FHE ‰ΩøÁî®ÊÅ∞Âà∞Â•ΩÂ§Ñ
3. ‚úÖ ÂÆåÊï¥ÁöÑÁªèÊµéÊ®°Âûã
4. ‚úÖ ËâØÂ•ΩÁöÑÁî®Êà∑‰ΩìÈ™å

### 11.4 Ëé∑Â•ñÈ°πÁõÆÂÖ±ÂêåÁâπÂæÅÊÄªÁªì

#### ÊäÄÊúØÂ±ÇÈù¢

| ÁâπÂæÅ | ÁôæÂàÜÊØî | ËØ¥Êòé |
|-----|--------|------|
| ‰ΩøÁî® FHEVM | 100% | ÊâÄÊúâÈ°πÁõÆÈÉΩÁî® |
| Gateway ÈõÜÊàê | 100% | ÂÆåÊï¥ÁöÑËß£ÂØÜÊµÅÁ®ã |
| ÈÉ®ÁΩ≤Âà∞ Zama | 100% | Devnet ÊàñÊµãËØïÁΩë |
| ‰ΩøÁî® euint32/euint64 | 100% | FHE Âä†ÂØÜÁ±ªÂûã |
| Ê∑∑ÂêàÊ®°Âºè | 80% | Âè™Âä†ÂØÜÂøÖË¶ÅÊï∞ÊçÆ |

#### ‰∫ßÂìÅÂ±ÇÈù¢

| ÁâπÂæÅ | ÁôæÂàÜÊØî | ËØ¥Êòé |
|-----|--------|------|
| ÊúâÂÆåÊï¥ UI | 100% | ‰∏çÊòØÁ∫ØÂêàÁ∫¶ |
| Êúâ README | 100% | ÊñáÊ°£ÂÆåÊï¥ |
| Ëß£ÂÜ≥ÁúüÂÆûÈóÆÈ¢ò | 100% | ‰∏çÊòØÁé©ÂÖ∑È°πÁõÆ |
| ÊúâÊºîÁ§∫ËßÜÈ¢ë | 80% | ËßÜËßâÂ±ïÁ§∫ |

#### ‰ª£Á†ÅË¥®Èáè

| ÁâπÂæÅ | ÁôæÂàÜÊØî | ËØ¥Êòé |
|-----|--------|------|
| ‰ª£Á†ÅÊ≥®ÈáäÂÆåÊï¥ | 90% | Êòì‰∫éÁêÜËß£ |
| ÊúâÊµãËØï‰ª£Á†Å | 70% | Ë¥®Èáè‰øùËØÅ |
| Ê®°ÂùóÂåñËÆæËÆ° | 100% | Êû∂ÊûÑÊ∏ÖÊô∞ |
| ÈîôËØØÂ§ÑÁêÜ | 90% | ÂÅ•Â£ÆÊÄßÂ•Ω |

### 11.5 ËØÑÂßîÊúÄÁúãÈáç‰ªÄ‰πàÔºü

Ê†πÊçÆËé∑Â•ñÈ°πÁõÆÂèçÂêëÂàÜÊûêÔºö

#### ü•á ÊúÄÈáçË¶ÅÔºàÂøÖÈ°ªÊúâÔºâ

1. **ÁúüÊ≠£‰ΩøÁî® FHE**
   - ‰∏çÊòØ Mock
   - Êúâ euint32/euint64
   - Êúâ Gateway ÈõÜÊàê

2. **Ëß£ÂÜ≥ÁúüÂÆûÈóÆÈ¢ò**
   - ‰∏çÊòØ‰∏∫‰∫Ü FHE ËÄå FHE
   - ÊúâÂÆûÈôÖÂ∫îÁî®Âú∫ÊôØ
   - ÊúâÂïÜ‰∏ö‰ª∑ÂÄº

3. **ÂäüËÉΩÂÆåÊï¥**
   - ‰∏çÊòØÂçäÊàêÂìÅ
   - Ê†∏ÂøÉÂäüËÉΩÂèØÁî®
   - ÊúâÂü∫Êú¨ÁöÑ UI

#### ü•à ÂæàÈáçË¶ÅÔºàÂä†ÂàÜÈ°πÔºâ

4. **ÊñáÊ°£Ê∏ÖÊô∞**
   - README ËØ¶ÁªÜ
   - ÊúâÈÉ®ÁΩ≤ËØ¥Êòé
   - ÊúâÊû∂ÊûÑÂõæ

5. **‰ª£Á†ÅË¥®Èáè**
   - Ê≥®ÈáäÂÆåÊï¥
   - ÁªìÊûÑÊ∏ÖÊô∞
   - Êòì‰∫éÁª¥Êä§

6. **Áî®Êà∑‰ΩìÈ™å**
   - UI ÁæéËßÇ
   - ‰∫§‰∫íÊµÅÁïÖ
   - ÈîôËØØÊèêÁ§∫ÂèãÂ•Ω

#### ü•â Âä†ÂàÜÈ°πÔºàÈî¶‰∏äÊ∑ªËä±Ôºâ

7. **ÂàõÊñ∞ÊÄß**
   - Áã¨ÁâπÁöÑÂ∫îÁî®Âú∫ÊôØ
   - Êñ∞È¢ñÁöÑÊäÄÊúØÁªÑÂêà

8. **ÂÆåÊï¥ÊÄß**
   - ÊúâÊµãËØï
   - ÊúâÊºîÁ§∫ËßÜÈ¢ë
   - ÊúâËØ¶ÁªÜÊñáÊ°£

### 11.6 ÈÅøÂùëÊåáÂçó

#### ‚ùå Â∏∏ËßÅÂ§±Ë¥•ÂéüÂõ†

1. **Ê≤°ÊúâÁúüÊ≠£ÁöÑ FHE**
   - Âè™ÊòØ Mock ÁâàÊú¨
   - ËØÑÂßîÁ¨¨‰∏ÄËΩÆÂ∞±Ê∑òÊ±∞

2. **ÂäüËÉΩ‰∏çÂÆåÊï¥**
   - Âè™ÊúâÂêàÁ∫¶Ê≤°Êúâ UI
   - Ê†∏ÂøÉÂäüËÉΩÊó†Ê≥ïÊºîÁ§∫

3. **Gateway ÈõÜÊàêÂ§±Ë¥•**
   - Ëß£ÂØÜ‰∏çÂ∑•‰Ωú
   - Ê≤°ÊúâÂ§ÑÁêÜË∂ÖÊó∂

4. **ÊñáÊ°£Áº∫Â§±**
   - README Â§™ÁÆÄÂçï
   - Êó†Ê≥ïÂ§çÁé∞

5. **Â∫îÁî®Âú∫ÊôØ‰∏çÊ∏ÖÊô∞**
   - ‰∏çÁü•ÈÅìËß£ÂÜ≥‰ªÄ‰πàÈóÆÈ¢ò
   - ÁúãËµ∑Êù•ÂÉè‰Ωú‰∏ö

#### ‚úÖ ÊàêÂäüÂÖ≥ÈîÆÂõ†Á¥†

1. **ÊòéÁ°ÆÁöÑ‰ª∑ÂÄº‰∏ªÂº†**
   ```markdown
   ## Problem
   Current data marketplaces expose sensitive information.
   
   ## Solution
   Our platform uses FHE to keep data encrypted while
   enabling statistical analysis.
   
   ## Impact
   Healthcare providers can share patient data for research
   without violating privacy regulations.
   ```

2. **ÂÆåÊï¥ÁöÑÊºîÁ§∫**
   - 3-5ÂàÜÈíüËßÜÈ¢ë
   - Â±ïÁ§∫Ê†∏ÂøÉÂäüËÉΩ
   - Á™ÅÂá∫ FHE ‰ΩøÁî®

3. **Âä°ÂÆûÁöÑÊäÄÊúØÈÄâÊã©**
   - Ê∑∑ÂêàÊ®°ÂºèÔºà‰∏çÊòØÂÖ®Âä†ÂØÜÔºâ
   - ÂºÇÊ≠•Â§ÑÁêÜÔºàÁî®Êà∑‰ΩìÈ™åÔºâ
   - ÈîôËØØÂ§ÑÁêÜÔºàÂÅ•Â£ÆÊÄßÔºâ

---

## üìö ÂèÇËÄÉËµÑÊ∫ê

### ÂÆòÊñπÊñáÊ°£
- Zama FHEVM ÊñáÊ°£: https://docs.zama.ai/fhevm
- Gateway ÊåáÂçó: https://docs.zama.ai/fhevm/guides/gateway
- Relayer SDK: https://github.com/zama-ai/relayer-sdk
- Developer Program: https://www.zama.ai/programs/developer-program

### Ëé∑Â•ñÈ°πÁõÆÊ∫êÁ†ÅÔºàÂøÖËØªÔºâ
- Lunarys: https://github.com/tomi204/privacy-pool-monorepo
- OTC-FHE: https://github.com/tasneemtoolba/OTC-with-FHE
- UNIversal Hook: https://github.com/Nilay27/UNIVersalPrivacyHook
- Belief Protocol: https://github.com/dordunu1/Zamabelief

### Â∑•ÂÖ∑
- Hardhat: https://hardhat.org/
- ethers.js v6: https://docs.ethers.org/v6/
- Vite: https://vitejs.dev/

---

## üéØ Âø´ÈÄüÂºÄÂßã

```bash
# 1. ÂÖãÈöÜÊ®°Êùø
git clone <your-template-repo>
cd fhevm-project

# 2. ÂÆâË£Ö‰æùËµñ
npm install
cd frontend && npm install

# 3. ÈÖçÁΩÆÁéØÂ¢É
cp .env.example .env
# ÁºñËæë .env Êñá‰ª∂

# 4. Êú¨Âú∞ÂºÄÂèë
npm run dev

# 5. ÈÉ®ÁΩ≤
npm run deploy:sepolia
```

---

## 12. Ê∏êËøõÂºè FHEVM ÂºÄÂèëÁ≠ñÁï•

> **ÂÆûÊàòÁªèÈ™åÊÄªÁªì**Ôºö‰ªé Mock Âà∞ FHE ÁöÑÂÆåÊï¥ÂºÄÂèëË∑ØÂæÑ  
> **È°πÁõÆÊ°à‰æã**ÔºöConfidential Data Marketplace  
> **Êó∂Èó¥**Ôºö2025-10-30  
> **ÂÆåÊï¥ÊñáÊ°£**Ôºö`üéì-‰ªéMockÂà∞FHEÁöÑÂÆåÊï¥ÂºÄÂèëÁªèÈ™å.md`

### 12.1 Ê†∏ÂøÉÁ≠ñÁï•ÔºöÊ∏êËøõÂºèÂºÄÂèë

```
Phase 1: Mock ÁâàÊú¨ (ÊòéÊñáËÆ°ÁÆó)
    ‚Üì
    È™åËØÅÊ†∏ÂøÉÈÄªËæë„ÄÅÁî®Êà∑‰ΩìÈ™å„ÄÅÂêàÁ∫¶ÂÆâÂÖ®
    ‚Üì
Phase 2: FHE ÂêàÁ∫¶ (Âä†ÂØÜËÆ°ÁÆó)
    ‚Üì
    ÁúüÊ≠£ÁöÑ FHEVM Á±ªÂûã„ÄÅGateway ÈõÜÊàê
    ‚Üì
Phase 3: ÂèåÂêàÁ∫¶Êû∂ÊûÑ (Ëá™Áî±ÂàáÊç¢)
    ‚Üì
    Âêå‰∏ÄÂâçÁ´ØÔºåÊ†πÊçÆÈÖçÁΩÆ‰ΩøÁî® Mock Êàñ FHE
```

**‰ºòÂäø**Ôºö
- ‚úÖ Âø´ÈÄüÈ™åËØÅ‰∫ßÂìÅÈÄªËæë
- ‚úÖ Èôç‰ΩéÊäÄÊúØÈ£éÈô©
- ‚úÖ ‰øùËØÅÊºîÁ§∫ÂèØÁî®ÊÄß
- ‚úÖ ‰∏∫ÁúüÊ≠£ÁöÑ FHE ÂÅöÂ•ΩÂáÜÂ§á

### 12.2 ÂèåÂêàÁ∫¶Êû∂ÊûÑËÆæËÆ°

```
Frontend (React + Vite)
    ‚Üì
useContractMode Hook (Ê®°ÂºèÊ£ÄÊµã)
    ‚îú‚îÄ Mock Mode ‚Üí useContract.js ‚Üí DataMarketplaceMock.sol
    ‚îî‚îÄ FHE Mode  ‚Üí useContractFHE.js ‚Üí DataMarketplaceFHE.sol
                        ‚Üì
                   FHEVM SDK (fhevmjs / @zama-fhe/relayer-sdk)
                        ‚Üì
                   Zama Gateway (Ëß£ÂØÜ)
```

### 12.3 ÂÖ≥ÈîÆÂÆûÁé∞Ë¶ÅÁÇπ

#### A. ÈÖçÁΩÆÁÆ°ÁêÜ

```javascript
// frontend/src/config.js

// ‚úÖ ÂèåÂêàÁ∫¶Âú∞ÂùÄ
export const CONTRACT_ADDRESS_MOCK = "0x9e138064...";
export const CONTRACT_ADDRESS_FHE = "0x39adb326...";

// ‚úÖ Ê®°ÂºèÊéßÂà∂ÔºàÂº∫Âà∂ MockÔºâ
export const FHEVM_ENABLED = false;

export const CONTRACT_ADDRESS = FHEVM_ENABLED 
  ? CONTRACT_ADDRESS_FHE 
  : CONTRACT_ADDRESS_MOCK;

// ‚úÖ Âä®ÊÄÅ ABI
export function getContractABI(isFHEVM) {
  if (isFHEVM) {
    return [
      // FHE ÁâàÊú¨ÔºàÂèÇÊï∞Á±ªÂûã‰∏çÂêåÔºâ
      "function uploadDataset(string, string, bytes32[], bytes[], uint256)",
      "function executeQuery(uint256, uint8, bytes32, bytes)",
    ];
  } else {
    return [
      // Mock ÁâàÊú¨
      "function uploadDataset(string, string, uint256[], uint256)",
      "function executeQuery(uint256, uint8, uint256)",
    ];
  }
}
```

#### B. Ê®°ÂºèÂàáÊç¢ Hook

```javascript
// frontend/src/hooks/useContractMode.js

export default function useContractMode(signer, chainId) {
  // ‚úÖ ÂÆåÂÖ®Áî±ÈÖçÁΩÆÊéßÂà∂Ôºå‰∏çËá™Âä®Ê£ÄÊµãÁΩëÁªú
  const shouldUseFHE = useMemo(() => {
    console.log('üîç Ê®°ÂºèÊ£ÄÊµã:', { FHEVM_ENABLED, chainId });
    return FHEVM_ENABLED;
  }, [chainId]);

  const mockHook = useContract(signer, chainId);
  const fheHook = useContractFHE();
  
  return useMemo(() => {
    if (shouldUseFHE) {
      console.log('üîê ‰ΩøÁî® FHE Ê®°Âºè');
      return { ...fheHook, mode: 'FHE', isFHEMode: true };
    } else {
      console.log('üìù ‰ΩøÁî® Mock Ê®°Âºè');
      return { ...mockHook, mode: 'Mock', isFHEMode: false };
    }
  }, [shouldUseFHE, mockHook, fheHook]);
}
```

#### C. FHE ÂêàÁ∫¶ÂÖ≥ÈîÆÂ∑ÆÂºÇ

```solidity
// contracts/DataMarketplaceFHE.sol

// ‚úÖ ÂøÖÈ°ªÁªßÊâø SepoliaZamaFHEVMConfig
contract DataMarketplaceFHE is 
    SepoliaZamaFHEVMConfig,  // ‚ö†Ô∏è Sepolia ÊîØÊåÅÔºÅ
    GatewayCaller,
    Ownable,
    ReentrancyGuard
{
    // ‚úÖ ‰ΩøÁî® FHE Á±ªÂûã
    struct Dataset {
        euint32[] encryptedData;  // ËÄå‰∏çÊòØ uint256[]
        // ...
    }
    
    // ‚úÖ ‰∏ä‰º†Êó∂ÈúÄË¶Å handles Âíå proofs
    function uploadDataset(
        string memory name,
        string memory description,
        einput[] calldata inputHandles,   // ‚ö†Ô∏è API ÂèòÂåñÔºÅ
        bytes[] calldata inputProofs,     // ‚ö†Ô∏è API ÂèòÂåñÔºÅ
        uint256 pricePerQuery
    ) external returns (uint256) {
        for (uint256 i = 0; i < inputHandles.length; i++) {
            encryptedData[i] = TFHE.asEuint32(
                inputHandles[i], 
                inputProofs[i]
            );
        }
        // ...
    }
    
    // ‚úÖ FHE ËÆ°ÁÆóÂáΩÊï∞‰∏çËÉΩÊòØ view
    function _computeMean(euint32[] memory data) 
        internal 
        returns (euint32)  // ‚ö†Ô∏è ‰∏çÊòØ viewÔºÅ
    {
        euint32 sum = TFHE.asEuint32(0);
        for (uint256 i = 0; i < data.length; i++) {
            sum = TFHE.add(sum, data[i]);
        }
        return TFHE.div(sum, uint32(data.length));
    }
    
    // ‚úÖ Gateway ÂõûË∞É
    function callbackQueryResult(
        uint256 requestId,
        bool success,
        bytes memory decryptedCts
    ) public onlyGateway {
        uint32 result = abi.decode(decryptedCts, (uint32));
        // Êõ¥Êñ∞Êü•ËØ¢Áä∂ÊÄÅÂíåÂàÜÈÖçÊî∂ÂÖ•...
    }
}
```

### 12.4 Â∏∏ËßÅÈóÆÈ¢òÈÄüÊü•

| ÈóÆÈ¢ò | ÂéüÂõ† | Ëß£ÂÜ≥ÊñπÊ°à |
|------|------|---------|
| **TFHE.asEuint32 API ÈîôËØØ** | ÈúÄË¶Å `einput` Âíå `bytes` | `TFHE.asEuint32(handle, proof)` |
| **FHE ÂáΩÊï∞‰∏çËÉΩ view** | FHE Êìç‰Ωú‰øÆÊîπÁä∂ÊÄÅ | ÁßªÈô§ `view` ÂÖ≥ÈîÆÂ≠ó |
| **Mock Âíå FHE Ê®°ÂºèÂÜ≤Á™Å** | Ëá™Âä®ÁΩëÁªúÊ£ÄÊµã | Âè™Áî± `FHEVM_ENABLED` ÊéßÂà∂ |
| **FHEVM SDK ÂàùÂßãÂåñÂ§±Ë¥•** | API ‰∏çÂåπÈÖç | ‰ºòÈõÖÈôçÁ∫ßÔºåËøîÂõû null |
| **OKX Èí±ÂåÖ‰∏çÂºπÁ™ó** | ethers.js ÂÖºÂÆπÊÄß | ‰ΩøÁî® `window.ethereum.request` |
| **‰∫§ÊòìÁ°ÆËÆ§‰∏çÂèØÈù†** | Èí±ÂåÖ provider ÈóÆÈ¢ò | ‰ΩøÁî®ÂÖ¨ÂÖ± RPC ËΩÆËØ¢ |

### 12.5 ÈÉ®ÁΩ≤Ê£ÄÊü•Ê∏ÖÂçï

#### Mock ÁâàÊú¨ÈÉ®ÁΩ≤

```bash
# ‚úÖ 1. ÁºñËØë
npx hardhat compile

# ‚úÖ 2. ÈÉ®ÁΩ≤Âà∞ Sepolia
npx hardhat run scripts/deploy.js --network sepolia

# ‚úÖ 3. Êõ¥Êñ∞ÂâçÁ´ØÈÖçÁΩÆ
# frontend/src/config.js
export const CONTRACT_ADDRESS_MOCK = "0x9e138064...";
export const FHEVM_ENABLED = false;

# ‚úÖ 4. ÂêØÂä®ÂâçÁ´Ø
cd frontend && npm run dev

# ‚úÖ 5. ÊµãËØïÂÆåÊï¥ÊµÅÁ®ã
# - ËøûÊé•Èí±ÂåÖ
# - ‰∏ä‰º†Êï∞ÊçÆÈõÜ
# - ÊâßË°åÊü•ËØ¢
# - Êü•ÁúãÁªìÊûú
```

#### FHE ÁâàÊú¨ÈÉ®ÁΩ≤

```bash
# ‚úÖ 1. ÂêØÁî® FHEVM ÁºñËØë
export FHEVM_MODE=true

# ‚úÖ 2. ÁºñËØë FHE ÂêàÁ∫¶
npx hardhat compile

# ‚úÖ 3. ÈÉ®ÁΩ≤Âà∞ Sepolia
npx hardhat run scripts/deploy-fhe.js --network sepolia

# ‚úÖ 4. ËÆ∞ÂΩïÂêàÁ∫¶Âú∞ÂùÄ
# ËæìÂá∫: 0x39adb32637D1E16C1Cd7159EE3a24C13c161FE69

# ‚úÖ 5. Êõ¥Êñ∞ÂâçÁ´ØÈÖçÁΩÆ
export const CONTRACT_ADDRESS_FHE = "0x39adb326...";

# ‚ö†Ô∏è 6. SDK ÈõÜÊàêÔºàÂæÖÂÆåÂñÑÔºâ
# - Á†îÁ©∂ @zama-fhe/relayer-sdk
# - ÈÖçÁΩÆ Gateway URL
# - ÊµãËØïÂä†ÂØÜ‰∏ä‰º†
```

### 12.6 ÊºîÁ§∫‰∏éÁ´ûËµõÁ≠ñÁï•

#### ‚úÖ Êé®ËçêÁ≠ñÁï•Ôºö‰ΩøÁî® Mock Ê®°ÂºèÊºîÁ§∫

**ÂéüÂõ†**Ôºö
- ÂäüËÉΩÂÆåÊï¥ÂèØÁî®
- Êó† Gateway Âª∂Ëøü
- ÊºîÁ§∫ÊµÅÁïÖÁ®≥ÂÆö
- Áî®Êà∑‰ΩìÈ™åÊúÄ‰Ω≥

**ÂêåÊó∂Â±ïÁ§∫**Ôºö
- ‚úÖ ÂÆåÊï¥ÁöÑ FHE ÂêàÁ∫¶‰ª£Á†Å
- ‚úÖ ÂèåÂêàÁ∫¶Êû∂ÊûÑËÆæËÆ°
- ‚úÖ Â∑≤ÈÉ®ÁΩ≤ÁöÑ FHE ÂêàÁ∫¶Âú∞ÂùÄ
- ‚úÖ Êú™Êù•ÂçáÁ∫ßËÆ°Âàí

#### ‚úÖ ÊñáÊ°£ÈáçÁÇπ

1. **README.md**
```markdown
## üèóÔ∏è Êû∂ÊûÑ‰∫ÆÁÇπ
- ‚úÖ Mock ÁâàÊú¨ÔºàÊºîÁ§∫Áî®ÔºåÂäüËÉΩÂÆåÊï¥Ôºâ
- ‚úÖ FHE ÂêàÁ∫¶ÔºàÂ∑≤ÈÉ®ÁΩ≤Âà∞ SepoliaÔºâ
- ‚úÖ ÂèåÂêàÁ∫¶Êû∂ÊûÑÔºàÁÅµÊ¥ªÂàáÊç¢Ôºâ
- ‚ö†Ô∏è Gateway ÈõÜÊàêÔºàÂæÖÂÆåÂñÑÔºâ

## üì¶ ÈÉ®ÁΩ≤Âú∞ÂùÄ
- Mock Contract: 0x9e138064... (Sepolia)
- FHE Contract: 0x39adb326... (Sepolia)
- Frontend: https://your-app.netlify.app

## üéØ ÊäÄÊúØÂàõÊñ∞
- SepoliaZamaFHEVMConfig ÈõÜÊàê
- ÂÆåÊï¥ÁöÑ FHE ËÆ°ÁÆóÈÄªËæëÔºàÂùáÂÄº„ÄÅÊñπÂ∑Æ„ÄÅÁªüËÆ°Ôºâ
- Gateway ÂõûË∞ÉÊú∫Âà∂
- ‰ºòÈõÖÈôçÁ∫ßÁ≠ñÁï•
```

2. **ÊäÄÊúØÊñáÊ°£**
- FHE ÂêàÁ∫¶ÂÆåÊï¥ÂÆûÁé∞
- ÂèåÂêàÁ∫¶Êû∂ÊûÑÂõæ
- ÂâçÁ´ØÊ®°ÂºèÂàáÊç¢ÈÄªËæë
- ÈóÆÈ¢ò‰∏éËß£ÂÜ≥ÊñπÊ°à

#### ‚úÖ ÊºîÁ§∫ËßÜÈ¢ëËÑöÊú¨ (3-5ÂàÜÈíü)

```
00:00-00:30  ÂºÄÂú∫
  - ÈóÆÈ¢òÔºöÊï∞ÊçÆ‰∫§Êòì vs ÈöêÁßÅ‰øùÊä§ÁöÑÁüõÁõæ
  - Ëß£ÂÜ≥ÊñπÊ°àÔºöFHE Âä†ÂØÜËÆ°ÁÆó

00:30-02:30  ÂäüËÉΩÊºîÁ§∫ (Mock Ê®°Âºè)
  - ËøûÊé•Èí±ÂåÖ
  - ‰∏ä‰º†Êï∞ÊçÆÈõÜ (100, 200, 150, 300, 250)
  - ÊµèËßàÂ∏ÇÂú∫
  - ÊâßË°åÊü•ËØ¢ (Calculate Mean = 200)
  - Êü•ÁúãÁªìÊûúÂíåÊîØ‰ªò

02:30-03:30  ÊäÄÊúØÂ±ïÁ§∫
  - Â±ïÁ§∫ FHE ÂêàÁ∫¶‰ª£Á†Å
  - ËØ¥Êòé euint32 Á±ªÂûãÂíå TFHE Êìç‰Ωú
  - ÊºîÁ§∫ Gateway ÂõûË∞ÉÊú∫Âà∂
  - Â±ïÁ§∫ÂèåÂêàÁ∫¶Êû∂ÊûÑËÆæËÆ°

03:30-04:00  Êú™Êù•Ë∑ØÁ∫ø
  - FHEVM SDK ÂÆåÂñÑ
  - Gateway ËΩÆËØ¢‰ºòÂåñ
  - Zama Devnet ËøÅÁßª
  - ÂÆûÈôÖÂ∫îÁî®Âú∫ÊôØ

04:00-05:00  ÊÄªÁªì
  - ÊäÄÊúØÂàõÊñ∞ÁÇπ
  - Á´ûËµõ‰ºòÂäø
  - ËÅîÁ≥ªÊñπÂºè
```

### 12.7 Êú™Êù•ÂçáÁ∫ßË∑ØÂæÑ

#### Áü≠Êúü (1-2 Âë®)

1. **ÂÆåÂñÑ FHEVM SDK**
   - Á†îÁ©∂ `@zama-fhe/relayer-sdk` ÂÆòÊñπÊñáÊ°£
   - ÊõøÊç¢ÊàñÈÖçÁΩÆ `fhevmjs`
   - È™åËØÅ Sepolia ÈÖçÁΩÆ

2. **Gateway ËΩÆËØ¢**
   ```javascript
   async function pollDecryption(requestId) {
     for (let i = 0; i < 60; i++) {
       const response = await fetch(gatewayUrl, {
         method: 'POST',
         body: JSON.stringify({ requestId, contractAddress, chainId })
       });
       
       if (response.ok) return await response.json();
       await sleep(5000);
     }
     throw new Error('Timeout');
   }
   ```

#### ‰∏≠Êúü (1-2 ‰∏™Êúà)

3. **Êú¨Âú∞ FHEVM ÁéØÂ¢É**
   ```bash
   docker pull zama/fhevm-node
   docker run -p 8545:8545 zama/fhevm-node
   npx hardhat run scripts/deploy-fhe.js --network localhost
   ```

4. **E2E ÊµãËØï**
   - Mock Ê®°Âºè: Sepolia ‚úÖ
   - FHE Ê®°Âºè: Local üöß
   - FHE Ê®°Âºè: Sepolia üöß

#### ÈïøÊúü (Á≠âÂæÖ Zama)

5. **Zama Devnet ËøÅÁßª**
   - È¢ÑËÆ° 2025 Q1-Q2
   - Êõ¥Êñ∞ÁΩëÁªúÈÖçÁΩÆ
   - ÊµãËØï Gateway Á®≥ÂÆöÊÄß

### 12.8 Ê†∏ÂøÉÁªèÈ™åÊÄªÁªì

#### ‚úÖ ÂºÄÂèëÂéüÂàô

1. **Ê∏êËøõÂºèÂºÄÂèë** > ‰∏ÄÊ≠•Âà∞‰Ωç
2. **‰ºòÈõÖÈôçÁ∫ß** > ÂÆåÁæéÂÆûÁé∞
3. **ÂÆûÈôÖÂèØÁî®** > ÊäÄÊúØÁÇ´ÊäÄ
4. **ÊñáÊ°£ÂÆåÂñÑ** > ‰ª£Á†ÅÂÆåÁæé

#### ‚úÖ Êû∂ÊûÑÂéüÂàô

1. **Mock ÂÖàË°å**ÔºöÈ™åËØÅÈÄªËæë
2. **ÂèåÂêàÁ∫¶Êû∂ÊûÑ**ÔºöÁÅµÊ¥ªÂàáÊç¢
3. **ÈÖçÁΩÆÈ©±Âä®**ÔºöÊòì‰∫éÂçáÁ∫ß
4. **‰ºòÈõÖÈôçÁ∫ß**ÔºöÁ°Æ‰øùÂèØÁî®

#### ‚úÖ ÂÆûÁé∞Ë¶ÅÁÇπ

1. **ÂêàÁ∫¶ÂºÄÂèë**
   - ‚ö†Ô∏è `einput` Âíå `bytes` ÂèÇÊï∞
   - ‚ö†Ô∏è FHE ÂáΩÊï∞‰∏çËÉΩ `view`
   - ‚ö†Ô∏è ÂøÖÈ°ªÁªßÊâø `SepoliaZamaFHEVMConfig`

2. **ÂâçÁ´ØÂºÄÂèë**
   - ‚ö†Ô∏è OKX Èí±ÂåÖ‰ΩøÁî® `window.ethereum.request`
   - ‚ö†Ô∏è ‰∫§ÊòìÁ°ÆËÆ§‰ΩøÁî®ÂÖ¨ÂÖ± RPC
   - ‚ö†Ô∏è ÈÅøÂÖçÁªÑ‰ª∂È¢ëÁπÅ re-mount

3. **Ë∞ÉËØïÊäÄÂ∑ß**
   - ‚úÖ ÂÆåÊï¥ÁöÑÊéßÂà∂Âè∞Êó•Âøó
   - ‚úÖ Ê≠•È™§ÂåñÈîôËØØËøΩË∏™
   - ‚úÖ ÁΩëÁªúËøûÊé•ËØäÊñ≠

### 12.9 ÂèÇËÄÉËµÑÊ∫ê

- **ÂÆåÊï¥ÁªèÈ™åÊñáÊ°£**: `confidential-data-marketplace/üéì-‰ªéMockÂà∞FHEÁöÑÂÆåÊï¥ÂºÄÂèëÁªèÈ™å.md`
- **Zama ÂÆòÊñπÊñáÊ°£**: https://docs.zama.ai/fhevm
- **Gateway ÊåáÂçó**: https://docs.zama.ai/fhevm/guides/gateway
- **Developer Program**: https://www.zama.ai/programs/developer-program
- **React Ê®°Êùø**: https://github.com/zama-ai/fhevm-react-template

---

**ÊúÄÂêéÊõ¥Êñ∞Ôºö** 2025-10-30  
**Áª¥Êä§ËÄÖÔºö** FHEVM ÂºÄÂèëÂõ¢Èòü  
**ÁâàÊú¨Ôºö** 6.0  
**Êõ¥Êñ∞ÂÜÖÂÆπÔºö** Ê∑ªÂä†Á¨¨ 12 Á´† - Ê∏êËøõÂºè FHEVM ÂºÄÂèëÁ≠ñÁï•Ôºà‰ªé Mock Âà∞ FHE ÁöÑÂÆåÊï¥ÂÆûÊàòÁªèÈ™åÔºâ

üéâ **Á•ùÊÇ®ÁöÑ FHEVM È°πÁõÆÂºÄÂèëÈ°∫Âà©ÔºÅÂèÇÂä† Zama Developer Program ÂèñÂæóÂ•ΩÊàêÁª©ÔºÅ** üèÜ

